<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Control Polygon Reduction â€¢ cpr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Control Polygon Reduction">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cpr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/cpr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/cnr.html">Tensor Products of B-Splines, Control Nets, and Control Net Reduction</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dewittpe/cpr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Control Polygon Reduction</h1>
                        <h4 data-toc-skip class="author">Peter E.
DeWitt</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dewittpe/cpr/blob/main/vignettes/cpr.Rmd" class="external-link"><code>vignettes/cpr.Rmd</code></a></small>
      <div class="d-none name"><code>cpr.Rmd</code></div>
    </div>

    
    
<style type="text/css">
window.MathJax = {
   tex: {
     tags: 'ams'
   }
};
</style>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dewittpe/cpr/" class="external-link">cpr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"cpr"</span><span class="op">)</span></span>
<span><span class="co">## [1] '0.4.0.9000'</span></span></code></pre></div>
<p>The purpose of this vignette is to illustrate how the Control Polygon
Reduction (CPR) method can be used to select a set of knots defining
B-spline to get a low degree of freedom and smooth fit to data. We start
with a primer on B-splines and control polygons then the development and
use of CPR.</p>
<div class="section level2">
<h2 id="b-splines-and-control-polygons">B-splines and Control Polygons<a class="anchor" aria-label="anchor" href="#b-splines-and-control-polygons"></a>
</h2>
<p>The term â€œsplineâ€ is likely derived from shipwright or draftsmen
splines, thin wood strips, held in place by weights, used to define
curves. These splines naturally minimize strain energy and the use of
additional weights at strategic locations on the spline are needed to
achieve specific curvatures. Cubic B-splines are not dissimilar.</p>
<p>Splines are piecewise polynomial curves that are differentiable up to
a prescribed order. B-splines are based on a <em>basis</em> of
polynomial functions.</p>
<p>Definitions and notation for uni-variable and multi-variable
B-splines and the associated control polygons and control nets are
presented in the following. Two very good references for splines are
<span class="citation">de Boor (2001)</span> and <span class="citation">Prautzsch, Boehm, and Paluszny (2002)</span> if you
wish to dig into the details.</p>
<div class="section level3">
<h3 id="b-splines">B-splines<a class="anchor" aria-label="anchor" href="#b-splines"></a>
</h3>
<p>A curve defined by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f\left(x\right)</annotation></semantics></math>
is a spline of order
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
(degree
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k
-1</annotation></semantics></math>), with knots
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¾</mi><mn>1</mn></msub><mo>,</mo><msub><mi>Î¾</mi><mn>2</mn></msub><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>Î¾</mi><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">\xi_1, \xi_2, \ldots, \xi_m</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¾</mi><mi>j</mi></msub><mo>â‰¤</mo><msub><mi>x</mi><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\xi_j \leq x_{j+1}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¾</mi><mi>j</mi></msub><mo>&lt;</mo><msub><mi>Î¾</mi><mrow><mi>j</mi><mo>+</mo><mi>k</mi></mrow></msub><mo>âˆ€</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">\xi_{j} &lt; \xi_{j + k} \forall j</annotation></semantics></math>
if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f\left(x\right)</annotation></semantics></math>
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>âˆ’</mo><mi>r</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k-r-1</annotation></semantics></math>
times differentiable at any
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>-fold
knot, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f\left(x\right)</annotation></semantics></math>
is a polynomial of order
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â‰¤</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">\leq k</annotation></semantics></math>
over each interval
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>âˆˆ</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Î¾</mi><mi>j</mi></msub><mo>,</mo><msub><mi>Î¾</mi><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">x \in \left[\xi_j, \xi_{j+1}\right]</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>0</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><mi>m</mi><mo>âˆ’</mo><mn>1</mn><mi>.</mi></mrow><annotation encoding="application/x-tex">j = 0, \ldots, m - 1.</annotation></semantics></math></p>
<p>In particular, B-splines, are defined as an affine combination:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>âˆ‘</mo><mi>j</mi></munder><msub><mi>Î¸</mi><mi>j</mi></msub><msub><mi>B</mi><mrow><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>ğ</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub></mrow><annotation encoding="application/x-tex">\begin{equation}
  f \left( x \right) =
  \sum_{j} \theta_j B_{j,k,\boldsymbol{\xi}}\left(x\right) =
  \boldsymbol{B}_{k, \boldsymbol{\xi}} \left(x\right) \boldsymbol{\theta}_{\boldsymbol{\xi}}
  \label{eq:f}
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">B_{j,k,\boldsymbol{\xi}}\left(x\right)</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>j</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">j^{th}</annotation></semantics></math>
basis spline function,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›</mi><annotation encoding="application/x-tex">\boldsymbol{\xi}</annotation></semantics></math>
is a sequence of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>
interior knots and a total of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>k</mi></mrow><annotation encoding="application/x-tex">2k</annotation></semantics></math>
boundary knots, i.e., the cardinality of the knot sequence is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">|</mo><mi>ğ›</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>=</mo><mn>2</mn><mi>k</mi><mo>+</mo><mi>l</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">\left\lvert \boldsymbol{\xi} \right\rvert = 2k + l.</annotation></semantics></math>
The value of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
boundary knots is arbitrary, but a common choice is to use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-fold
knots on the boundary:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¾</mi><mn>1</mn></msub><mo>=</mo><msub><mi>Î¾</mi><mn>2</mn></msub><mo>=</mo><mi>â‹¯</mi><mo>=</mo><msub><mi>Î¾</mi><mi>k</mi></msub><mo>&lt;</mo><msub><mi>Î¾</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>â‰¤</mo><mi>â‹¯</mi><mo>â‰¤</mo><msub><mi>Î¾</mi><mrow><mi>k</mi><mo>+</mo><mi>l</mi></mrow></msub><mo>=</mo><msub><mi>Î¾</mi><mrow><mi>k</mi><mo>+</mo><mi>l</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>â‹¯</mi><mo>=</mo><msub><mi>Î¾</mi><mrow><mn>2</mn><mi>k</mi><mo>+</mo><mi>l</mi></mrow></msub><mi>.</mi></mrow><annotation encoding="application/x-tex"> \xi_1 = \xi_2 = \cdots = \xi_k &lt; \xi_{k+1} \leq \cdots \leq \xi_{k + l} =
\xi_{k + l + 1} = \cdots = \xi_{2k + l}.</annotation></semantics></math></p>
<p>Alternative boundary knots can be used so long as the sequence
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›</mi><annotation encoding="application/x-tex">\boldsymbol{\xi}</annotation></semantics></math>
is non-decreasing. More on the implications of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-fold
boundary knots follow in the next section.</p>
<p>The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>j</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">j^{th}</annotation></semantics></math>
B-spline is defined as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Ï‰</mi><mrow><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>B</mi><mrow><mi>j</mi><mo>,</mo><mi>k</mi><mo>âˆ’</mo><mn>1</mn><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>Ï‰</mi><mrow><mi>j</mi><mo>+</mo><mn>1</mn><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>B</mi><mrow><mi>j</mi><mo>+</mo><mn>1</mn><mo>,</mo><mi>k</mi><mo>âˆ’</mo><mn>1</mn><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation}
B_{j,k,\boldsymbol{\xi}}\left(x\right) =
 \omega_{j,k,\boldsymbol{\xi}} \left(x\right)
 B_{j,k-1,\boldsymbol{\xi}}\left(x\right) +
 \left(1 - \omega_{j+1,k,\boldsymbol{\xi}} \right)
 B_{j+1,k-1,\boldsymbol{\xi}}\left(x\right),
\end{equation}</annotation></semantics></math> where
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn><mspace width="1.0em"></mspace><mtext mathvariant="normal">for</mtext><mspace width="1.0em"></mspace><mi>x</mi><mo>âˆ‰</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Î¾</mi><mi>j</mi></msub><mo>,</mo><msub><mi>Î¾</mi><mrow><mi>j</mi><mo>+</mo><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mspace width="1.0em"></mspace><msub><mi>B</mi><mrow><mi>j</mi><mo>,</mo><mn>1</mn><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn></mtd><mtd columnalign="left" style="text-align: left"><mi>x</mi><mo>âˆˆ</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Î¾</mi><mi>j</mi></msub><mo>,</mo><msub><mi>Î¾</mi><mrow><mi>j</mi><mo>+</mo><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>0</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">otherwise</mtext><mo>,</mo></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
B_{j,k,\boldsymbol{\xi}}\left(x\right) = 0 \quad \text{for} \quad x \notin
\left[\xi_j, \xi_{j+k} \right), \quad \quad
B_{j,1,\boldsymbol{\xi}}\left(x\right) = \begin{cases}
1 &amp; x \in \left[\xi_j, \xi_{j+k}\right) \\ 0 &amp; \text{otherwise},
\end{cases}
\end{equation}</annotation></semantics></math> and
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ï‰</mi><mrow><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>0</mn></mtd><mtd columnalign="left" style="text-align: left"><mi>x</mi><mo>â‰¤</mo><msub><mi>Î¾</mi><mi>j</mi></msub></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mfrac><mrow><mi>x</mi><mo>âˆ’</mo><msub><mi>Î¾</mi><mi>j</mi></msub></mrow><mrow><msub><mi>Î¾</mi><mrow><mi>j</mi><mo>+</mo><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>âˆ’</mo><msub><mi>Î¾</mi><mi>j</mi></msub></mrow></mfrac></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>Î¾</mi><mi>j</mi></msub><mo>&lt;</mo><mi>x</mi><mo>&lt;</mo><msub><mi>Î¾</mi><mrow><mi>j</mi><mo>+</mo><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>Î¾</mi><mrow><mi>j</mi><mo>+</mo><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>â‰¤</mo><mi>x</mi><mi>.</mi></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
\omega_{j,k,\boldsymbol{\xi}}\left(x\right) = \begin{cases}
0 &amp; x \leq \xi_j \\ \frac{x-\xi_j}{\xi_{j+k-1} - \xi_{j}} &amp; \xi_j &lt; x &lt; \xi_{j+k-1} \\
1 &amp; \xi_{j+k-1} \leq x.
\end{cases}
\end{equation}</annotation></semantics></math></p>
<p>For a set of observations,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ±</mi><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>x</mi><mi>n</mi></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">\boldsymbol{x} = x_1, \ldots, x_n,</annotation></semantics></math>
the basis functions defined above generalize to a matrix:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>B</mi><mrow><mn>1</mn><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>B</mi><mrow><mn>2</mn><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="center" style="text-align: center"><mi>â€¦</mi></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>B</mi><mrow><mi>k</mi><mo>+</mo><mi>l</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>â‹®</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>â‹®</mi></mtd><mtd columnalign="center" style="text-align: center"><mo>â‹±</mo></mtd><mtd columnalign="center" style="text-align: center"><mi>â‹®</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>B</mi><mrow><mn>1</mn><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>B</mi><mrow><mn>2</mn><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="center" style="text-align: center"><mi>â€¦</mi></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>B</mi><mrow><mi>k</mi><mo>+</mo><mi>l</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
  \boldsymbol{B}_{k, \boldsymbol{\xi}} \left(\boldsymbol{x}\right) =
  \begin{pmatrix}
    B_{1, k, \boldsymbol{\xi}} \left(x_1\right) &amp;
    B_{2, k, \boldsymbol{\xi}} \left(x_1\right) &amp;
    \ldots &amp;
    B_{k + l, k, \boldsymbol{\xi}} \left(x_1\right) \\
    \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
    B_{1, k, \boldsymbol{\xi}} \left(x_n\right) &amp;
    B_{2, k, \boldsymbol{\xi}} \left(x_n\right) &amp;
    \ldots &amp;
    B_{k + l, k, \boldsymbol{\xi}} \left(x_n\right).
  \end{pmatrix}
\end{equation}</annotation></semantics></math></p>
<p>Within the cpr package we can generate a basis matrix thusly:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5.9999</span>, length.out <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span>
<span><span class="va">bmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2.3</span>, <span class="fl">4</span>, <span class="fl">4.5</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bmat</span></span>
<span><span class="co">## Basis matrix dims: [5,000 x 9]</span></span>
<span><span class="co">## Order: 4</span></span>
<span><span class="co">## Number of internal knots: 5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## First 6 rows:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##           [,1]        [,2]         [,3]         [,4] [,5] [,6] [,7] [,8] [,9]</span></span>
<span><span class="co">## [1,] 1.0000000 0.000000000 0.000000e+00 0.000000e+00    0    0    0    0    0</span></span>
<span><span class="co">## [2,] 0.9964037 0.003593461 2.878634e-06 5.011451e-10    0    0    0    0    0</span></span>
<span><span class="co">## [3,] 0.9928160 0.007172539 1.150485e-05 4.009161e-09    0    0    0    0    0</span></span>
<span><span class="co">## [4,] 0.9892369 0.010737255 2.586411e-05 1.353092e-08    0    0    0    0    0</span></span>
<span><span class="co">## [5,] 0.9856664 0.014287632 4.594188e-05 3.207329e-08    0    0    0    0    0</span></span>
<span><span class="co">## [6,] 0.9821045 0.017823691 7.172363e-05 6.264314e-08    0    0    0    0    0</span></span></code></pre></div>
<p>Note: the default order for <code>bsplines</code> is 4, and the
default for the boundary knots is the range of <code>x</code>. However,
relying on the default boundary knots can lead to unexpected behavior
as, by definition the splines on the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-fold
upper boundary is 0.</p>
<p>We can quickly view the plot of each of these spline functions as
well.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bmat</span>, show_xi <span class="op">=</span> <span class="cn">TRUE</span>, show_x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/plot_bmat-1.png" width="672"></p>
<p>A few of many important properties of the basis functions:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mrow><mi>ğ±</mi><mi>ğ¢</mi></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>âˆˆ</mo><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mo>âˆ€</mo><mi>x</mi><mo>âˆˆ</mo><mi>â„</mi><mo>;</mo></mrow><annotation encoding="application/x-tex">B_{j,k,\boldsymbol{xi}} \left(x\right) \in \left[0, 1\right], \forall x \in \mathbb{R};</annotation></semantics></math></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">bmat</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">bmat</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre></div>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mrow><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><mn>0</mn><mspace width="1.0em"></mspace><mtext mathvariant="normal">for</mtext><mspace width="1.0em"></mspace><mi>x</mi><mo>âˆˆ</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¾</mi><mi>j</mi></msub><mo>,</mo><msub><mi>Î¾</mi><mrow><mi>j</mi><mo>+</mo><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>;</mo></mrow><annotation encoding="application/x-tex">B_{j,k,\boldsymbol{\xi}} \left(x\right) &gt; 0 \quad \text{for} \quad x \in \left(\xi_{j}, \xi_{j+k}\right);</annotation></semantics></math></p>
<p>and</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mo>âˆ‘</mo><mi>j</mi></munder><msub><mi>B</mi><mrow><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mrow><mi>ğ±</mi><mi>ğ¢</mi></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn></mtd><mtd columnalign="left" style="text-align: left"><mi>x</mi><mo>âˆˆ</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Î¾</mi><mn>1</mn></msub><mo>,</mo><msub><mi>Î¾</mi><mrow><mn>2</mn><mi>k</mi><mo>+</mo><mi>l</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>0</mn></mtd><mtd columnalign="left" style="text-align: left"><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi><mi>.</mi></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\sum_j B_{j,k,\boldsymbol{xi}} \left(x\right) = \begin{cases} 1 &amp; x \in
\left[\xi_1, \xi_{2k+l}\right) \\ 0 &amp; otherwise. \end{cases}</annotation></semantics></math></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">bmat</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bmat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre></div>
<div class="section level4">
<h4 id="cprbsplines-vs-splinesbs">cpr::bsplines vs splines::bs<a class="anchor" aria-label="anchor" href="#cprbsplines-vs-splinesbs"></a>
</h4>
<p>Part of the base R distribution is the splines package which build
B-splines by calling <code>bs</code>. There are three areas where the
functions differ: 1. input arguments, 2. attributes of the returned
matrix, and 3. behavior at the right boundary knot.</p>
<div class="section level5">
<h5 id="input-arguments">Input Arguments<a class="anchor" aria-label="anchor" href="#input-arguments"></a>
</h5>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">bsplines</span><span class="op">)</span></span>
<span><span class="co">## function (x, iknots = NULL, df = NULL, bknots = range(x), order = 4L) </span></span>
<span><span class="co">## NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="fu">splines</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></span><span class="op">)</span></span>
<span><span class="co">## function (x, df = NULL, knots = NULL, degree = 3, intercept = FALSE, </span></span>
<span><span class="co">##     Boundary.knots = range(x), warn.outside = TRUE) </span></span>
<span><span class="co">## NULL</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="33%">
<col width="44%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="left">cpr::bsplines</th>
<th align="left">splines::bs</th>
<th align="left">Notes</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">x</td>
<td align="left">x</td>
<td align="left">numeric vector; the predictor variable</td>
</tr>
<tr class="even">
<td align="left">iknots</td>
<td align="left">knots</td>
<td align="left">internal knots</td>
</tr>
<tr class="odd">
<td align="left">bknots</td>
<td align="left">Boundary.knots</td>
<td align="left">boundary knots</td>
</tr>
<tr class="even">
<td align="left">order</td>
<td align="left">degree</td>
<td align="left">polynomial order = polynomial degree + 1</td>
</tr>
<tr class="odd">
<td align="left">df</td>
<td align="left">df</td>
<td align="left">degrees of freedom</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">intercept</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">warn.outside</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><code>bsplines</code> does not have the <code>intercept</code> nor
the <code>warn.outside</code> arguments because the matrix generated by
<code>bsplines</code> effectively <em>always</em> has
<code>intercept = TRUE</code> and <code>warn.outside = TRUE</code>. How
values of <code>x</code> at the right boundary, and outside the boundary
are treated also differ between the two functions.</p>
</div>
<div class="section level5">
<h5 id="attributes-of-the-returned-matrices">Attributes of the returned matrices<a class="anchor" aria-label="anchor" href="#attributes-of-the-returned-matrices"></a>
</h5>
<p>The default call for both B-spline functions returns a basis matrix
for a order 4 (degree 3; cubic) B-spline with boundary knots placed at
<code>range(x)</code>. However, the returns are not the same.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bs_mat</span> <span class="op">&lt;-</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></span><span class="op">(</span><span class="va">x</span>, knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bmat</span>, <span class="st">"iknots"</span><span class="op">)</span>, Boundary.knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bmat</span>, <span class="st">"bknots"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">bmat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## List of 10</span></span>
<span><span class="co">##  $ dim        : int [1:2] 5000 9</span></span>
<span><span class="co">##  $ order      : num 4</span></span>
<span><span class="co">##  $ df         : num 9</span></span>
<span><span class="co">##  $ iknots     : num [1:5] 1 1.5 2.3 4 4.5</span></span>
<span><span class="co">##  $ bknots     : num [1:2] 0 6</span></span>
<span><span class="co">##  $ xi         : num [1:13] 0 0 0 0 1 1.5 2.3 4 4.5 6 ...</span></span>
<span><span class="co">##  $ xi_star    : num [1:9] 0 0.333 0.833 1.6 2.6 ...</span></span>
<span><span class="co">##  $ class      : chr [1:2] "cpr_bs" "matrix"</span></span>
<span><span class="co">##  $ call       : language bsplines(x = x, iknots = c(1, 1.5, 2.3, 4, 4.5), bknots = c(0, 6))</span></span>
<span><span class="co">##  $ environment:&lt;environment: R_GlobalEnv&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">bs_mat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## List of 7</span></span>
<span><span class="co">##  $ dim           : int [1:2] 5000 8</span></span>
<span><span class="co">##  $ dimnames      :List of 2</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : chr [1:8] "1" "2" "3" "4" ...</span></span>
<span><span class="co">##  $ degree        : int 3</span></span>
<span><span class="co">##  $ knots         : num [1:5] 1 1.5 2.3 4 4.5</span></span>
<span><span class="co">##  $ Boundary.knots: num [1:2] 0 6</span></span>
<span><span class="co">##  $ intercept     : logi FALSE</span></span>
<span><span class="co">##  $ class         : chr [1:3] "bs" "basis" "matrix"</span></span></code></pre></div>
<p>The <code>bspline_mat</code> has additional attributes related to the
control polygons.</p>
<p>The major difference is the in the dimension of the matrices. By
default <code><a href="https://rdrr.io/r/splines/bs.html" class="external-link">splines::bs</a></code> omits one column from the basis matrix
such that when using using the function is a regression formula the
resulting design matrix is not rank deficient. Using
<code>bsplines</code> would suggest using a <code>+0</code> or
<code>-1</code> in the regression formula to omit the intercept (is
nuance is handled in calls to <code>cp</code> so the end user need not
worry about it).</p>
</div>
<div class="section level5">
<h5 id="right-continuity">Right Continuity<a class="anchor" aria-label="anchor" href="#right-continuity"></a>
</h5>
<p>By definition, the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ</mi><mrow><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{B}_{j,k,\boldsymbol{\xi}}\left(x\right)</annotation></semantics></math>
are non-negative right-continuous functions. <code>bsplines</code>
adheres to the definition strictly, whereas <code><a href="https://rdrr.io/r/splines/bs.html" class="external-link">splines::bs</a></code>
uses a pivoting method to allow for non-zero extrapolations outside the
support.</p>
<p>Example: for the <code><a href="../reference/bsplines.html">cpr::bsplines</a></code> call, notice that the
first, third, and fifth rows, corresponding to values outside the
support are all zeros as are the row sums. Compare that to the
<code><a href="https://rdrr.io/r/splines/bs.html" class="external-link">splines::bs</a></code> which returns negative values and in the
matrix, and all rows sum to 1.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bspline_eg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Warning in bsplines(c(0, 1, 2, 5, 6), bknots = c(1, 5)): At least one x value &lt;</span></span>
<span><span class="co">## min(bknots)</span></span>
<span><span class="co">## Warning in bsplines(c(0, 1, 2, 5, 6), bknots = c(1, 5)): At least one x value</span></span>
<span><span class="co">## &gt;= max(bknots)</span></span>
<span><span class="va">bs_eg</span>      <span class="op">&lt;-</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>, Boundary.knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, intercept <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span>
<span><span class="co">## Warning in splines::bs(c(0, 1, 2, 5, 6), Boundary.knots = c(1, 5), intercept =</span></span>
<span><span class="co">## TRUE): some 'x' values beyond boundary knots may cause ill-conditioned bases</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bspline_eg</span><span class="op">)</span></span>
<span><span class="co">##          [,1]     [,2]     [,3]     [,4]</span></span>
<span><span class="co">## [1,] 0.000000 0.000000 0.000000 0.000000</span></span>
<span><span class="co">## [2,] 1.000000 0.000000 0.000000 0.000000</span></span>
<span><span class="co">## [3,] 0.421875 0.421875 0.140625 0.015625</span></span>
<span><span class="co">## [4,] 0.000000 0.000000 0.000000 0.000000</span></span>
<span><span class="co">## [5,] 0.000000 0.000000 0.000000 0.000000</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">bspline_eg</span><span class="op">)</span></span>
<span><span class="co">## [1] 0 1 1 0 0</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bs_eg</span><span class="op">)</span></span>
<span><span class="co">##              1         2         3         4</span></span>
<span><span class="co">## [1,]  1.953125 -1.171875  0.234375 -0.015625</span></span>
<span><span class="co">## [2,]  1.000000  0.000000  0.000000  0.000000</span></span>
<span><span class="co">## [3,]  0.421875  0.421875  0.140625  0.015625</span></span>
<span><span class="co">## [4,]  0.000000  0.000000  0.000000  1.000000</span></span>
<span><span class="co">## [5,] -0.015625  0.234375 -1.171875  1.953125</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">bs_eg</span><span class="op">)</span></span>
<span><span class="co">## [1] 1 1 1 1 1</span></span></code></pre></div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="control-polygons">Control Polygons<a class="anchor" aria-label="anchor" href="#control-polygons"></a>
</h2>
<p>The spline
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>ğ</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ±</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f\left(\boldsymbol{x}\right) = \boldsymbol{B}_{k,\boldsymbol{\xi}}\left(\boldsymbol{x}\right)</annotation></semantics></math>
is a convex sum of the coefficients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{\theta}_{\boldsymbol{\xi}}.</annotation></semantics></math>
A meaningful geometric relationship between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›</mi><annotation encoding="application/x-tex">\boldsymbol{\xi}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\theta}_{\boldsymbol{\xi}}</annotation></semantics></math>
exist in the form of a <strong>control polygon</strong>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>P</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi><mo>,</mo><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub></mrow></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">CP_{k,\boldsymbol{\xi},\boldsymbol{\theta}_{\boldsymbol{\xi}}},</annotation></semantics></math>
a strong convex hull for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{B}_{k,\boldsymbol{\xi}}\left(\boldsymbol{x}\right)
\boldsymbol{\theta}_{\boldsymbol{\xi}}.</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>P</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi><mo>,</mo><msub><mi>ğ›‰</mi><mi>Î¾</mi></msub></mrow></msub><mo>=</mo><msubsup><mrow><mo stretchy="true" form="prefix">{</mo><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>Î¾</mi><mi>j</mi><mo>*</mo></msubsup><mo>,</mo><msub><mi>Î¸</mi><mrow><mi>j</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub><mo stretchy="true" form="postfix">|</mo></mrow></msubsup><mo>;</mo><mspace width="1.0em"></mspace><mspace width="1.0em"></mspace><msubsup><mi>Î¾</mi><mi>j</mi><mo>*</mo></msubsup><mo>=</mo><mfrac><mn>1</mn><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></munderover><msub><mi>Î¾</mi><mrow><mi>j</mi><mo>+</mo><mi>i</mi></mrow></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
CP_{k,\boldsymbol{\xi},\boldsymbol{\theta}_{\xi}} =
\left\{ \left( \xi_{j}^{*}, \theta_{j,\boldsymbol{\xi}} \right) \right
\}_{j=1}^{\left\lvert\boldsymbol{\theta}_{\boldsymbol{\xi}}\right\rvert};
\quad \quad
\xi_{j}^{*} = \frac{1}{k-1} \sum_{i = 1}^{k-1} \xi_{j + i}.
\end{equation}</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>P</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi><mo>,</mo><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub></mrow></msub></mrow><annotation encoding="application/x-tex">CP_{k,\boldsymbol{\xi},\boldsymbol{\theta}_{\boldsymbol{\xi}}}</annotation></semantics></math>
is a sequence of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub><mo stretchy="true" form="postfix">|</mo></mrow><mo>=</mo><mi>k</mi><mo>+</mo><mi>l</mi></mrow><annotation encoding="application/x-tex">\left\lvert \boldsymbol{\theta}_{\boldsymbol{\xi}} \right\rvert
= k + l</annotation></semantics></math> control vertices. The control
polygon can be thought of as a piecewise linear function approximating
the spline function. Changes in convexity and other subtle
characteristics of the spline function are exaggerated by the control
polygon.</p>
<p>For example, using the basis matrix defined above and the following
coefficients we can easily define a spline function and control
polygon.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3.5</span>, <span class="fl">4.2</span>, <span class="fl">3.7</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.7</span>, <span class="fl">2</span>, <span class="fl">1.5</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">cp0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">bmat</span>, <span class="va">theta</span><span class="op">)</span></span></code></pre></div>
<p>Plotting the control polygon and the corresponding spline:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cp0</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/plot_cp-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="knot-influence">Knot Influence<a class="anchor" aria-label="anchor" href="#knot-influence"></a>
</h2>
<div class="section level3">
<h3 id="spline-spaces-and-inserting-a-knot">Spline Spaces and Inserting a Knot<a class="anchor" aria-label="anchor" href="#spline-spaces-and-inserting-a-knot"></a>
</h3>
<p>Consider two knot sequences
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›</mi><annotation encoding="application/x-tex">\boldsymbol{\xi}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›</mi><mo>âˆª</mo><mi>ğ›</mi><mi>â€²</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{\xi} \cup
\boldsymbol{\xi}'.</annotation></semantics></math> Then, for a given
polynomial order
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">k,</annotation></semantics></math>
the spline space
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ•Š</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mo>âŠ‚</mo><msub><mi>ğ•Š</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi><mo>âˆª</mo><mi>ğ›</mi><mi>â€²</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathbb{S}_{k,\boldsymbol{\xi}} \subset \mathbb{S}_{k,\boldsymbol{\xi} \cup
\boldsymbol{\xi}'}</annotation></semantics></math><span class="citation">(de Boor 2001, pg135)</span>. Given this relationship
between spline spaces, and the convex sums generating spline functions,
<span class="citation">Boehm (1980)</span> presented a method for
inserting a knots into the knot sequence such that the spline function
is unchanged. Specifically, for
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›</mi><mi>â€²</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mrow><msub><mi>Î¾</mi><mi>j</mi></msub><mi>â€²</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>min</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><msub><mi>Î¾</mi><mi>j</mi></msub><mo>&lt;</mo><mo>max</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mo>âˆ€</mo><mi>j</mi><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\boldsymbol{\xi}' = \left\{\left. \xi_{j}' \right|
\min\left(\boldsymbol{\xi}\right) &lt; \xi_j &lt;
\max\left(\boldsymbol{\xi}\right) \quad \forall j\right\},
</annotation></semantics></math> then there exist a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›‰</mi><mrow><mi>ğ›</mi><mo>âˆª</mo><mi>ğ›</mi><mi>â€²</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\theta}_{\boldsymbol{\xi} \cup
\boldsymbol{\xi}'}</annotation></semantics></math> such that
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub><mo>=</mo><msub><mi>ğ</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi><mo>âˆª</mo><mi>ğ›</mi><mi>â€²</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>ğ›‰</mi><mrow><mi>ğ›</mi><mo>âˆª</mo><mi>ğ›</mi><mi>â€²</mi></mrow></msub><mspace width="1.0em"></mspace><mo>âˆ€</mo><mi>x</mi><mo>âˆˆ</mo><mrow><mo stretchy="true" form="prefix">[</mo><mo>min</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mo>max</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\boldsymbol{B}_{k,\boldsymbol{\xi}} \left(x\right)\boldsymbol{\theta}_{\boldsymbol{\xi}} =
\boldsymbol{B}_{k,\boldsymbol{\xi}\cup\boldsymbol{\xi}'}\left(x\right) \boldsymbol{\theta}_{\boldsymbol{\xi} \cup \boldsymbol{\xi}'}
\quad \forall x \in \left[\min\left(\boldsymbol{\xi}\right), \max\left(\boldsymbol{\xi} \right) \right].
</annotation></semantics></math></p>
<p>When inserting a singleton
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¾</mi><mi>â€²</mi></mrow><annotation encoding="application/x-tex">\xi'</annotation></semantics></math>
into
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">\boldsymbol{\xi},</annotation></semantics></math>
then
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ›‰</mi><mrow><mi>ğ›</mi><mo>âˆª</mo><mi>Î¾</mi><mi>â€²</mi></mrow></msub><mo>=</mo><msub><mi>ğ–</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¾</mi><mi>â€²</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub></mrow><annotation encoding="application/x-tex">
\boldsymbol{\theta}_{\boldsymbol{\xi} \cup \xi'} = \boldsymbol{W}_{k,
\boldsymbol{\xi}}\left(\xi'\right) \boldsymbol{\theta}_{\boldsymbol{\xi}}
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ–</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¾</mi><mi>â€²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{W}_{k,\boldsymbol{\xi}}\left(\xi'\right)</annotation></semantics></math>
is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">|</mo><mi>ğ›‰</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>Ã—</mo><mrow><mo stretchy="true" form="prefix">|</mo><mi>ğ›‰</mi><mo stretchy="true" form="postfix">|</mo></mrow></mrow><annotation encoding="application/x-tex">\left(
\left\lvert \boldsymbol{\theta} \right\rvert + 1\right) \times \left\lvert
\boldsymbol{\theta} \right\rvert</annotation></semantics></math> lower
bi-diagonal matrix
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ–</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¾</mi><mi>â€²</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>â‹¯</mi></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn><mo>âˆ’</mo><msub><mi>Ï‰</mi><mrow><mn>1</mn><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¾</mi><mi>â€²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>Ï‰</mi><mrow><mn>1</mn><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¾</mi><mi>â€²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="center" style="text-align: center"><mi>â‹¯</mi></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn><mo>âˆ’</mo><msub><mi>Ï‰</mi><mrow><mn>2</mn><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¾</mi><mi>â€²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="center" style="text-align: center"><mi>â‹¯</mi><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>â‹®</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>â‹®</mi></mtd><mtd columnalign="center" style="text-align: center"><mo>â‹±</mo></mtd><mtd columnalign="center" style="text-align: center"><mi>â‹®</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn><mo>âˆ’</mo><msub><mi>Ï‰</mi><mrow><mrow><mo stretchy="true" form="prefix">|</mo><mi>ğ›‰</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>âˆ’</mo><mn>1</mn><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¾</mi><mi>â€²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>Ï‰</mi><mrow><mrow><mo stretchy="true" form="prefix">|</mo><mi>ğ›‰</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>âˆ’</mo><mn>1</mn><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¾</mi><mi>â€²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\boldsymbol{W}_{k,\boldsymbol{\xi}}\left(\xi'\right) =
\begin{pmatrix}
1 &amp; 0 &amp; \cdots &amp; 0 \\
1 - \omega_{1, k, \boldsymbol{\xi}}\left(\xi'\right) &amp; \omega_{1, k, \boldsymbol{\xi}} \left(\xi'\right) &amp; \cdots &amp; 0 \\
0 &amp; 1 - \omega_{2, k, \boldsymbol{\xi}}\left(\xi'\right) &amp; \cdots 0 \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; 1 - \omega_{\left\lvert \boldsymbol{\theta} \right\rvert - 1, k, \boldsymbol{\xi}} \left(\xi'\right) &amp; \omega_{\left\lvert \boldsymbol{\theta} \right\rvert - 1, k, \boldsymbol{\xi}} \left(\xi'\right) \\
0 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix},
</annotation></semantics></math> with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ï‰</mi><mrow><mi>j</mi><mo>,</mo><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\omega_{j,k,\boldsymbol{\xi}}\left(x\right)</annotation></semantics></math>
as defined above in the de~Boor recursive algorithm. Through recursion
we can insert as many knots into
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›</mi><annotation encoding="application/x-tex">\boldsymbol{\xi}</annotation></semantics></math>
without changing the value of the spline function.</p>
<p>For an example, insert a knot
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¾</mi><mi>â€²</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">\xi' = 3</annotation></semantics></math>
into the control polygon defined above.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/insert_a_knot.html">insert_a_knot</a></span><span class="op">(</span><span class="va">cp0</span>, xi_prime <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cp0</span>, <span class="va">cp1</span>, color <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/insert_xi_prime3-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="assessing-influence-of-xi_j">Assessing influence of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¾</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\xi_j</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#assessing-influence-of-xi_j"></a>
</h3>
<p>Here we derive a metric for assessing how much influence
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¾</mi><mi>j</mi></msub><mo>âˆˆ</mo><mi>ğ›</mi></mrow><annotation encoding="application/x-tex">\xi_j \in
\boldsymbol{\xi}</annotation></semantics></math> has on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{B}_{k,\boldsymbol{\xi}}
\left(x\right)\boldsymbol{\theta}_{\boldsymbol{\xi}}.</annotation></semantics></math>
Using the relationship defined by <span class="citation">Boehm
(1980)</span>, we can derive a metric for the influence of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¾</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\xi_j</annotation></semantics></math>
on the spline function.</p>
<p>Start with an defined
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">k, \boldsymbol{\xi},</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ›‰</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{\theta}_{k,\boldsymbol{\xi}}.</annotation></semantics></math>
The relationship
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub><mo>=</mo><msub><mi>ğ–</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi><mo>âˆ–</mo><msub><mi>Î¾</mi><mi>j</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¾</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>ğ›‰</mi><mrow><mi>ğ›</mi><mo>âˆ–</mo><msub><mi>Î¾</mi><mi>j</mi></msub></mrow></msub></mrow><annotation encoding="application/x-tex">
\boldsymbol{\theta}_{\boldsymbol{\xi}} =
\boldsymbol{W}_{k,\boldsymbol{\xi}\backslash\xi_{j}}\left(\xi_{j}\right)
\boldsymbol{\theta}_{\boldsymbol{\xi}\backslash\xi_{j}}
</annotation></semantics></math> holds if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¾</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\xi_j</annotation></semantics></math>
has zero influence. However, in practice, we would expect that the
relationship is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub><mo>=</mo><msub><mi>ğ–</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi><mo>âˆ–</mo><msub><mi>Î¾</mi><mi>j</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¾</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>ğ›‰</mi><mrow><mi>ğ›</mi><mo>âˆ–</mo><msub><mi>Î¾</mi><mi>j</mi></msub></mrow></msub><mo>+</mo><mi>ğ</mi></mrow><annotation encoding="application/x-tex">
\boldsymbol{\theta}_{\boldsymbol{\xi}} =
\boldsymbol{W}_{k,\boldsymbol{\xi}\backslash\xi_{j}}\left(\xi_{j}\right)
\boldsymbol{\theta}_{\boldsymbol{\xi}\backslash\xi_{j}} + \boldsymbol{d}
</annotation></semantics></math> for a set of deviations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ</mi><annotation encoding="application/x-tex">\boldsymbol{d}</annotation></semantics></math>
which would be equal to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>ğŸ</mn><annotation encoding="application/x-tex">\boldsymbol{0}</annotation></semantics></math>
if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¾</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\xi_j</annotation></semantics></math>
has no influence on the spline.</p>
<p>We can estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ</mi><annotation encoding="application/x-tex">\boldsymbol{d}</annotation></semantics></math>
via least squares. To simplify the notation in the following we drop
some of the subscripts and parenthesis, that is, let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ–</mi><mo>=</mo><msub><mi>ğ–</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi><mo>âˆ–</mo><msub><mi>Î¾</mi><mi>j</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¾</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{W} =
\boldsymbol{W}_{k,\boldsymbol{\xi}\backslash\xi_{j}}\left(\xi_{j}\right).</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>ğ</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub><mo>âˆ’</mo><mi>ğ–</mi><msub><mi>ğ›‰</mi><mrow><mi>ğ›</mi><mo>âˆ–</mo><msub><mi>Î¾</mi><mi>j</mi></msub></mrow></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub><mo>âˆ’</mo><mi>ğ–</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>ğ–</mi><mi>T</mi></msup><mi>ğ–</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><msup><mi>ğ–</mi><mi>T</mi></msup><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğˆ</mi><mo>âˆ’</mo><mi>ğ–</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>ğ–</mi><mi>T</mi></msup><mi>ğ–</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><msup><mi>ğ–</mi><mi>T</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align}
\boldsymbol{d} &amp;= \boldsymbol{\theta}_{\boldsymbol{\xi}} - \boldsymbol{W} \boldsymbol{\theta}_{\boldsymbol{\xi}\backslash\xi_{j}} \\
               &amp;= \boldsymbol{\theta}_{\boldsymbol{\xi}} - \boldsymbol{W} \left(\boldsymbol{W}^{T}\boldsymbol{W}\right)^{-1}\boldsymbol{W}^{T}        \boldsymbol{\theta}_{\boldsymbol{\xi}} \\
               &amp;= \left(\boldsymbol{I}                   - \boldsymbol{W} \left(\boldsymbol{W}^{T}\boldsymbol{W}\right)^{-1}\boldsymbol{W}^{T}\right) \boldsymbol{\theta}_{\boldsymbol{\xi}} \\
\end{align}
</annotation></semantics></math></p>
<p>Finally, we define the influence of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¾</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\xi_j</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>P</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi><mo>,</mo><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub></mrow></msub></mrow><annotation encoding="application/x-tex">CP_{k,\boldsymbol{\xi},\boldsymbol{\theta}_{\boldsymbol{\xi}}}</annotation></semantics></math>
as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>j</mi></msub><mo>=</mo><msubsup><mrow><mo stretchy="true" form="prefix">âˆ¥</mo><mi>ğ</mi><mo stretchy="true" form="postfix">âˆ¥</mo></mrow><mn>2</mn><mn>2</mn></msubsup><mi>.</mi></mrow><annotation encoding="application/x-tex"> w_j = \left\lVert \boldsymbol{d} \right\rVert_{2}^{2}. </annotation></semantics></math></p>
<p>The influence of knots on the spline used in the above section.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="va">cp0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">##   j iknot  influence influence_rank chisq chisq_rank p_value os_p_value</span></span>
<span><span class="co">## 1 5   1.0 1.64661178              5    NA         NA      NA         NA</span></span>
<span><span class="co">## 2 6   1.5 0.29066719              2    NA         NA      NA         NA</span></span>
<span><span class="co">## 3 7   2.3 0.31205029              3    NA         NA      NA         NA</span></span>
<span><span class="co">## 4 8   4.0 0.07702981              1    NA         NA      NA         NA</span></span>
<span><span class="co">## 5 9   4.5 0.41987740              4    NA         NA      NA         NA</span></span></code></pre></div>
<p>Letâ€™s look at the following plots to explore the influence of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¾</mi><mn>7</mn></msub><annotation encoding="application/x-tex">\xi_{7}</annotation></semantics></math>
(the third interior knot in a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">k=4</annotation></semantics></math>
order spline) on the spline. In panel (a) we see the original control
polygon and spline along with the coarsened control polygon and spline.
Note that the there are fewer control points, and the spline deviates
from the original. In panel (b) we see that the restored control polygon
is the result of inserting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¾</mi><mn>7</mn></msub><annotation encoding="application/x-tex">\xi_7</annotation></semantics></math>
into the coarsened control polygon of panel (a). These plots are also a
good example of the local support and strong convexity of the control
polygons as there are only
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">k + 1 = 5</annotation></semantics></math>
control points which are impacted by the removal and re-insertion of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¾</mi><mn>7</mn></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">\xi_7.</annotation></semantics></math>
Lastly, in panel (c) we see all three control polygons plotted
together.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>  <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, j <span class="op">=</span> <span class="fl">3</span>, coarsened <span class="op">=</span> <span class="cn">TRUE</span>, restored <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>    , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, j <span class="op">=</span> <span class="fl">3</span>, coarsened <span class="op">=</span> <span class="cn">FALSE</span>, restored <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>    , labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(a)"</span>, <span class="st">"(b)"</span><span class="op">)</span></span>
<span>    , nrow <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span>  , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, j <span class="op">=</span> <span class="fl">3</span>, coarsened <span class="op">=</span> <span class="cn">TRUE</span>, restored <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span>  , labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"(c)"</span><span class="op">)</span></span>
<span>  , nrow <span class="op">=</span> <span class="fl">2</span></span>
<span>  , ncol <span class="op">=</span> <span class="fl">1</span></span>
<span>  , heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>Next, consider the influence of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¾</mi><mn>8</mn></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">\xi_8,</annotation></semantics></math>
the fourth interior knot. By the influence metric defined above, this is
the least influential knot in the sequence. This can be seen easily as
the spline between the original and the coarsened spline are very
similar, this is despite the apparent large difference in the magnitude
of the control point ordinates between the original and coarsened
control polygons. However, when re-inserting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¾</mi><mn>8</mn></msub><annotation encoding="application/x-tex">\xi_8</annotation></semantics></math>
the recovered control polygon is very similar to the original, hence the
low influence of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¾</mi><mn>8</mn></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">\xi_8.</annotation></semantics></math></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>  <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, j <span class="op">=</span> <span class="fl">4</span>, coarsened <span class="op">=</span> <span class="cn">TRUE</span>, restored <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>    , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, j <span class="op">=</span> <span class="fl">4</span>, coarsened <span class="op">=</span> <span class="cn">FALSE</span>, restored <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>    , labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(a)"</span>, <span class="st">"(b)"</span><span class="op">)</span></span>
<span>    , nrow <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span>  , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, j <span class="op">=</span> <span class="fl">4</span>, coarsened <span class="op">=</span> <span class="cn">TRUE</span>, restored <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span>  , labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"(c)"</span><span class="op">)</span></span>
<span>  , nrow <span class="op">=</span> <span class="fl">2</span></span>
<span>  , ncol <span class="op">=</span> <span class="fl">1</span></span>
<span>  , heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>If you were required to omit an internal knot, it would be preferable
to omit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¾</mi><mn>8</mn></msub><annotation encoding="application/x-tex">\xi_8</annotation></semantics></math>
over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¾</mi><mn>5</mn></msub><mo>,</mo><msub><mi>Î¾</mi><mn>6</mn></msub><mo>,</mo><msub><mi>Î¾</mi><mn>7</mn></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">\xi_5, \xi_6, \xi_7,</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¾</mi><mn>9</mn></msub><annotation encoding="application/x-tex">\xi_9</annotation></semantics></math>
as that will have the least impact on the spline approximation of the
original functional form.</p>
</div>
</div>
<div class="section level2">
<h2 id="fitting-b-splines-to-noisy-data">Fitting B-splines to noisy data<a class="anchor" aria-label="anchor" href="#fitting-b-splines-to-noisy-data"></a>
</h2>
<p>Start with the spline we have been using and add some noise to
it.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5.99999</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">bmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2.3</span>, <span class="fl">4</span>, <span class="fl">4.5</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3.5</span>, <span class="fl">4.2</span>, <span class="fl">3.7</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.7</span>, <span class="fl">2</span>, <span class="fl">1.5</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">DF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, truth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bmat</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">DF</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bmat</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bmat</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">original_data_ggplot_layers</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">DF</span></span>
<span>                        , mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span>                        , inherit.aes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>                        , color <span class="op">=</span> <span class="st">"#6F263D"</span></span>
<span>                        , alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span>    ,</span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">DF</span></span>
<span>                       , mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">truth</span><span class="op">)</span></span>
<span>                       , inherit.aes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>                       , color <span class="op">=</span> <span class="st">"#6F263D"</span></span>
<span>                       , alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">DF</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="va">original_data_ggplot_layers</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>To fit a spline and control polygon to the noisy data use a formula
statement in the <code>cp</code> call. In this example we will use the
known internal knots and add one extra.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_cp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2.3</span>, <span class="fl">3.0</span>, <span class="fl">4</span>, <span class="fl">4.5</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span>     , data <span class="op">=</span> <span class="va">DF</span></span>
<span>     , keep_fit <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># default is FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">initial_cp</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="va">original_data_ggplot_layers</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>The plot above shows the fitted spline is does well at approximating
the true spline function. Just to make it perfectly clear, the
regression coefficients are the estimates of the ordinates for the
control polygon:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_cp</span><span class="op">$</span><span class="va">fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##  [1]  1.0032390  0.6730762  3.0035459  4.4136192  3.5386419  1.7539897</span></span>
<span><span class="co">##  [7] -0.4708520 -0.7312097  2.1631310  1.3575369</span></span>
<span><span class="va">initial_cp</span><span class="op">$</span><span class="va">cp</span><span class="op">$</span><span class="va">theta</span></span>
<span><span class="co">##  [1]  1.0032390  0.6730762  3.0035459  4.4136192  3.5386419  1.7539897</span></span>
<span><span class="co">##  [7] -0.4708520 -0.7312097  2.1631310  1.3575369</span></span></code></pre></div>
<p>Letâ€™s now look at the influence of the internal knots on the fit</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##    j iknot  influence influence_rank     chisq chisq_rank   p_value os_p_value</span></span>
<span><span class="co">## 1  5   1.0 0.16235075              5 0.9100724          5 0.3400952 0.66205444</span></span>
<span><span class="co">## 2  6   1.5 0.05785223              3 0.4331666          2 0.5104392 0.11947108</span></span>
<span><span class="co">## 3  7   2.3 0.05128404              2 0.5061398          3 0.4768147 0.30134562</span></span>
<span><span class="co">## 4  8   3.0 0.08264093              4 0.8363492          4 0.3604430 0.37410640</span></span>
<span><span class="co">## 5  9   4.0 0.02585915              1 0.2230694          1 0.6367111 0.06662766</span></span>
<span><span class="co">## 6 10   4.5 0.39575696              6 2.6821030          6 0.1014816 0.47378677</span></span></code></pre></div>
<p>The least influential knot is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¾</mi><mn>8</mn></msub><mo>=</mo><mn>3.0</mn><mo>,</mo></mrow><annotation encoding="application/x-tex">\xi_8 = 3.0,</annotation></semantics></math>
the extra knot inserted. Good, we this is the expected result.</p>
<p>How would someone determine if the influence was significant? That
is, how can we test the null hypothesis
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>w</mi><mi>j</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">H_0: w_{j} = 0</annotation></semantics></math></p>
<p>Under the null hypothesis that the knot has zero influence and under
standard ordinary least squares regression assumptions the regression
coefficients, (the ordinates of the control polygon are the regression
coefficients), are realizations of a Gaussian random variable. Then</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>j</mi></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğˆ</mi><mo>âˆ’</mo><mi>ğ‡</mi><mo stretchy="true" form="postfix">)</mo></mrow><mover><mi>ğ›‰</mi><mo accent="true">Ì‚</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi></msup><msup><mrow><mo stretchy="true" form="prefix">[</mo><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğˆ</mi><mo>âˆ’</mo><mi>ğ‡</mi><mo stretchy="true" form="postfix">)</mo></mrow><mover><mi>ğ›‰</mi><mo accent="true">Ì‚</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mi>ğšº</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğˆ</mi><mo>âˆ’</mo><mi>ğ‡</mi><mo stretchy="true" form="postfix">)</mo></mrow><mover><mi>ğ›‰</mi><mo accent="true">Ì‚</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi></msup><mo stretchy="true" form="postfix">]</mo></mrow><mo>+</mo></msup><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğˆ</mi><mo>âˆ’</mo><mi>ğ‡</mi><mo stretchy="true" form="postfix">)</mo></mrow><mover><mi>ğ›‰</mi><mo accent="true">Ì‚</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
w_j =
\left(\left(\boldsymbol{I} - \boldsymbol{H}\right)\hat{\boldsymbol{\theta}} \right)^{T}
\left[
  \left(\left(\boldsymbol{I} - \boldsymbol{H}\right)\hat{\boldsymbol{\theta}} \right)
  \boldsymbol{\Sigma}
  \left(\left(\boldsymbol{I} - \boldsymbol{H}\right)\hat{\boldsymbol{\theta}} \right)^{T}
\right]^{+}
\left(\left(\boldsymbol{I} - \boldsymbol{H}\right)\hat{\boldsymbol{\theta}} \right)
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ‡</mi><mo>=</mo><mi>W</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>W</mi><mi>T</mi></msup><mi>W</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><msup><mi>W</mi><mi>T</mi></msup><mo>,</mo></mrow><annotation encoding="application/x-tex">\boldsymbol{H} = W (W^{T}W)^{-1} W^{T},</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğšº</mi><annotation encoding="application/x-tex">\boldsymbol{\Sigma}</annotation></semantics></math>
is the variance-covariance matrix for the regression coefficients, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>+</mo><annotation encoding="application/x-tex">+</annotation></semantics></math>
denotes the Moore-Penrose inverse of the matrix. By construction,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğˆ</mi><mo>âˆ’</mo><mi>ğ‡</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>ğšº</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğˆ</mi><mo>âˆ’</mo><mi>ğ‡</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">\left(\boldsymbol{I} - \boldsymbol{H}\right) \boldsymbol{\Sigma} \left(\boldsymbol{I} - \boldsymbol{H}\right)^{T}</annotation></semantics></math>
is singular and thus the standard inverse does not exist and a
generalized inverse is necessary. This yields the test statistic
following an F distribution with 1, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î½</mi><mn>2</mn></msub><annotation encoding="application/x-tex">\nu_2</annotation></semantics></math>
degrees of freedom,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>j</mi></msub><mo>âˆ¼</mo><msub><mi>F</mi><mrow><mn>1</mn><mo>,</mo><msub><mi>Î½</mi><mn>2</mn></msub></mrow></msub><mi>.</mi></mrow><annotation encoding="application/x-tex"> w_j \sim F_{1,\nu_2}.</annotation></semantics></math>
The second degree of freedom is dependent on the sample size, the number
of regression parameters, and the type of regression used to estimate
the ordinates.</p>
<p>To simplify the work, and generalize the approach, we will use the
fact that the limiting distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><mn>1</mn><mo>,</mo><msub><mi>Î½</mi><mn>2</mn></msub></mrow></msub><annotation encoding="application/x-tex">F_{1, \nu_2}</annotation></semantics></math>
as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î½</mi><mn>2</mn></msub><mo>â†’</mo><mi>âˆ</mi></mrow><annotation encoding="application/x-tex">\nu_2 \rightarrow \infty</annotation></semantics></math>
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>Ï‡</mi><mn>1</mn><mn>2</mn></msubsup><mo>,</mo></mrow><annotation encoding="application/x-tex">\chi_{1}^{2},</annotation></semantics></math>
that is,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>j</mi></msub><mo>âˆ¼</mo><msubsup><mi>Ï‡</mi><mn>1</mn><mn>2</mn></msubsup><mi>.</mi></mrow><annotation encoding="application/x-tex"> w_j \sim \chi_{1}^{2}.</annotation></semantics></math></p>
<p>Now, if we are interested in removing the knot with the lowest
influence we are interested in the minimum. So the hypothesis test we
are actually interested in is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>w</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex"> H_0: w_{(1)} = 0 </annotation></semantics></math>
which follows the distribution
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>w</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msub><mo>&gt;</mo><mi>w</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>k</mi><mo>+</mo><mi>l</mi></mrow></munderover><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mrow><mi>n</mi><mo>+</mo><mi>l</mi></mrow><mi>j</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>F</mi><msubsup><mi>Ï‡</mi><mn>1</mn><mn>2</mn></msubsup></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mi>j</mi></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>F</mi><msubsup><mi>Ï‡</mi><mn>1</mn><mn>2</mn></msubsup></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>k</mi><mo>+</mo><mi>l</mi><mo>âˆ’</mo><mi>j</mi></mrow></msup></mrow><annotation encoding="application/x-tex"> \Pr \left[ w_{(1)} &gt; w \right] = \sum_{j = 1}^{k+l} \binom{n+l}{j}
\left(F_{\chi_{1}^{2}}\left(w\right)\right)^{j} \left( 1 -
F_{\chi_{1}^{2}}\left(w\right) \right)^{k+l-j}</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><msubsup><mi>Ï‡</mi><mn>1</mn><mn>2</mn></msubsup></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F_{\chi_{1}^{2}}\left(w\right)</annotation></semantics></math>
is the distribution function of the chi-square distribution with one
degree of freedom.</p>
<p>The results generated by calling <code>influence_of_iknots</code>.
report two sets of p-values. The first is the p-value is the probability
of observed chisq value greater than reported, and the second p-value is
the probability of the rank order statistic exceeding the observed
value.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="3%">
<col width="7%">
<col width="12%">
<col width="18%">
<col width="12%">
<col width="13%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">j</th>
<th align="right">iknot</th>
<th align="right">influence</th>
<th align="right">influence_rank</th>
<th align="right">chisq</th>
<th align="right">chisq_rank</th>
<th align="right">p_value</th>
<th align="right">os_p_value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">5</td>
<td align="right">1.0</td>
<td align="right">0.1623508</td>
<td align="right">5</td>
<td align="right">0.9100724</td>
<td align="right">5</td>
<td align="right">0.3400952</td>
<td align="right">0.6620544</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">6</td>
<td align="right">1.5</td>
<td align="right">0.0578522</td>
<td align="right">3</td>
<td align="right">0.4331666</td>
<td align="right">2</td>
<td align="right">0.5104392</td>
<td align="right">0.1194711</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">7</td>
<td align="right">2.3</td>
<td align="right">0.0512840</td>
<td align="right">2</td>
<td align="right">0.5061398</td>
<td align="right">3</td>
<td align="right">0.4768147</td>
<td align="right">0.3013456</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">8</td>
<td align="right">3.0</td>
<td align="right">0.0826409</td>
<td align="right">4</td>
<td align="right">0.8363492</td>
<td align="right">4</td>
<td align="right">0.3604430</td>
<td align="right">0.3741064</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">9</td>
<td align="right">4.0</td>
<td align="right">0.0258592</td>
<td align="right">1</td>
<td align="right">0.2230694</td>
<td align="right">1</td>
<td align="right">0.6367111</td>
<td align="right">0.0666277</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="right">10</td>
<td align="right">4.5</td>
<td align="right">0.3957570</td>
<td align="right">6</td>
<td align="right">2.6821030</td>
<td align="right">6</td>
<td align="right">0.1014816</td>
<td align="right">0.4737868</td>
</tr>
</tbody>
</table>
<p>It is worth remembering how fraught binary classification of
statistical (non)significance can be. Just because the p-value is low
does not mean that the knot is influential, just as a high p-value dose
not mean that the knot is not influential. Sample size, over-fitting,
and other factors can/will lead to poor selection of a model if you only
consider these p-values.</p>
<p>That said, consider
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¾</mi><mn>9</mn></msub><mo>=</mo><mn>4.0</mn></mrow><annotation encoding="application/x-tex">\xi_9 = 4.0</annotation></semantics></math>
which has the lowest influence weight. Letâ€™s omit that knot and refit
the model.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_reduction_cp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2.3</span>, <span class="fl">3</span>, <span class="fl">4.5</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="va">first_reduction_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="3%">
<col width="7%">
<col width="12%">
<col width="18%">
<col width="13%">
<col width="13%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">j</th>
<th align="right">iknot</th>
<th align="right">influence</th>
<th align="right">influence_rank</th>
<th align="right">chisq</th>
<th align="right">chisq_rank</th>
<th align="right">p_value</th>
<th align="right">os_p_value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">5</td>
<td align="right">1.0</td>
<td align="right">0.1957262</td>
<td align="right">4</td>
<td align="right">1.1517249</td>
<td align="right">4</td>
<td align="right">0.2831884</td>
<td align="right">0.4369320</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">6</td>
<td align="right">1.5</td>
<td align="right">0.0345902</td>
<td align="right">2</td>
<td align="right">0.2881794</td>
<td align="right">1</td>
<td align="right">0.5913896</td>
<td align="right">0.0723383</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">7</td>
<td align="right">2.3</td>
<td align="right">0.0238548</td>
<td align="right">1</td>
<td align="right">0.2900566</td>
<td align="right">2</td>
<td align="right">0.5901843</td>
<td align="right">0.3202087</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">8</td>
<td align="right">3.0</td>
<td align="right">0.0782231</td>
<td align="right">3</td>
<td align="right">0.8844555</td>
<td align="right">3</td>
<td align="right">0.3469842</td>
<td align="right">0.2305056</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">9</td>
<td align="right">4.5</td>
<td align="right">5.9074903</td>
<td align="right">5</td>
<td align="right">46.2296402</td>
<td align="right">5</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
<p>After omitting one knot and refitting the model we see that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¾</mi><mo>=</mo><mn>2.3</mn></mrow><annotation encoding="application/x-tex">\xi = 2.3</annotation></semantics></math>
is the least influential. Just for fun, letâ€™s omit that knot, and refit.
Letâ€™s continue that process all the way down to zero knots.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">second_reduction_cp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">4.5</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="va">second_reduction_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="3%">
<col width="7%">
<col width="12%">
<col width="18%">
<col width="13%">
<col width="13%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">j</th>
<th align="right">iknot</th>
<th align="right">influence</th>
<th align="right">influence_rank</th>
<th align="right">chisq</th>
<th align="right">chisq_rank</th>
<th align="right">p_value</th>
<th align="right">os_p_value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">5</td>
<td align="right">1.0</td>
<td align="right">0.4805752</td>
<td align="right">3</td>
<td align="right">3.8031184</td>
<td align="right">3</td>
<td align="right">0.0511572</td>
<td align="right">0.0146519</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">6</td>
<td align="right">1.5</td>
<td align="right">0.0019515</td>
<td align="right">1</td>
<td align="right">0.0186252</td>
<td align="right">1</td>
<td align="right">0.8914463</td>
<td align="right">0.6315108</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">7</td>
<td align="right">3.0</td>
<td align="right">0.1381508</td>
<td align="right">2</td>
<td align="right">1.3834860</td>
<td align="right">2</td>
<td align="right">0.2395083</td>
<td align="right">0.0450848</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">8</td>
<td align="right">4.5</td>
<td align="right">6.2382229</td>
<td align="right">4</td>
<td align="right">59.9559534</td>
<td align="right">4</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
<p>The least influential knot in the second reduction is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¾</mi><mo>=</mo><mn>1.5</mn></mrow><annotation encoding="application/x-tex">\xi = 1.5</annotation></semantics></math>
and that will be omitted for the third reduction.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">third_reduction_cp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4.5</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="va">third_reduction_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="3%">
<col width="7%">
<col width="12%">
<col width="18%">
<col width="12%">
<col width="13%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">j</th>
<th align="right">iknot</th>
<th align="right">influence</th>
<th align="right">influence_rank</th>
<th align="right">chisq</th>
<th align="right">chisq_rank</th>
<th align="right">p_value</th>
<th align="right">os_p_value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">5</td>
<td align="right">1.0</td>
<td align="right">3.0669773</td>
<td align="right">2</td>
<td align="right">41.672311</td>
<td align="right">2</td>
<td align="right">0.0000000</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">6</td>
<td align="right">3.0</td>
<td align="right">0.4304104</td>
<td align="right">1</td>
<td align="right">3.986697</td>
<td align="right">1</td>
<td align="right">0.0458609</td>
<td align="right">9.65e-05</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">7</td>
<td align="right">4.5</td>
<td align="right">6.6872293</td>
<td align="right">3</td>
<td align="right">73.937519</td>
<td align="right">3</td>
<td align="right">0.0000000</td>
<td align="right">0.00e+00</td>
</tr>
</tbody>
</table>
<p>Within the third reduction, the least influential knot is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¾</mi><mo>=</mo><mn>3.0</mn></mrow><annotation encoding="application/x-tex">\xi = 3.0</annotation></semantics></math>
and that knot will be omitted for the fourth reduction.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fourth_reduction_cp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4.5</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="va">fourth_reduction_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="3%">
<col width="7%">
<col width="13%">
<col width="19%">
<col width="11%">
<col width="14%">
<col width="10%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">j</th>
<th align="right">iknot</th>
<th align="right">influence</th>
<th align="right">influence_rank</th>
<th align="right">chisq</th>
<th align="right">chisq_rank</th>
<th align="right">p_value</th>
<th align="right">os_p_value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">5</td>
<td align="right">1.0</td>
<td align="right">5.952998</td>
<td align="right">1</td>
<td align="right">107.2956</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">6</td>
<td align="right">4.5</td>
<td align="right">9.517375</td>
<td align="right">2</td>
<td align="right">142.2148</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Of the two remaining internal knots,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¾</mi><mo>âˆ’</mo><mn>1.0</mn></mrow><annotation encoding="application/x-tex">\xi - 1.0</annotation></semantics></math>
is the least influential and will be omitted for the fifth
reduction.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fifth_reduction_cp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fl">4.5</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="va">fifth_reduction_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="3%">
<col width="7%">
<col width="13%">
<col width="19%">
<col width="11%">
<col width="14%">
<col width="10%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">j</th>
<th align="right">iknot</th>
<th align="right">influence</th>
<th align="right">influence_rank</th>
<th align="right">chisq</th>
<th align="right">chisq_rank</th>
<th align="right">p_value</th>
<th align="right">os_p_value</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">1</td>
<td align="right">5</td>
<td align="right">4.5</td>
<td align="right">4.103958</td>
<td align="right">1</td>
<td align="right">31.66441</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr></tbody>
</table>
<p>Only one knot can be omitted from the fifth to the sixth reduction.
Having the sixth reduction, where there are zero internal knots, lets us
compare model fits to a model with just a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">k=4</annotation></semantics></math>
order polynomial.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sixth_reduction_cp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="va">sixth_reduction_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##   j iknot influence influence_rank chisq chisq_rank p_value os_p_value</span></span>
<span><span class="co">## 1 4    NA        NA             NA    NA         NA      NA         NA</span></span></code></pre></div>
<p>Letâ€™s compare all the fits. We will start by looking at the control
polygons and splines.</p>
<p><img src="cpr_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
<p>The control polygons, panel (a), we see that the sixth, fifth, and
fourth reductions are different from the initial, first, second, and
third reductions, and for the splines, the fifth and sixth reductions
are easily identified as different.</p>
<p>Next, the graphic below will let us compare these models to the
truth, and the observed data.</p>
<p><img src="cpr_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>The dashed black line is the spline fitted to the data (light
burgundy dots) and the true value of the target function is the burgundy
line. In the fifth reduction there is an easily noticeable difference
between the fitted spline and the target function. Between the initial
control polygon and the first three reductions it is difficult to
visually discern any meaningful difference between the fits.</p>
<p>Thus, I would argue that the third reduction is the preferable model
as it has the fewest degrees of freedom while providing a good quality
of fit. This conclusion is supported by looking at the residual standard
error (rse)
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>s</mi><mi>e</mi><mo>=</mo><msqrt><mrow><mfrac><mn>1</mn><mrow><mi>d</mi><mi>f</mi></mrow></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow></msqrt><mo>,</mo></mrow><annotation encoding="application/x-tex"> rse = \sqrt{ \frac{1}{df} \sum_{i=1}^{n} \left(y_i - f\left(x_i\right)\right)^2 },</annotation></semantics></math>
where the degrees of freedom,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>f</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">df,</annotation></semantics></math>
is the sample size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
minus the number of regression parameters.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>  <span class="va">initial_cp</span> , <span class="va">first_reduction_cp</span> , <span class="va">second_reduction_cp</span> , <span class="va">third_reduction_cp</span></span>
<span>     , <span class="va">fourth_reduction_cp</span> , <span class="va">fifth_reduction_cp</span> , <span class="va">sixth_reduction_cp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span>what <span class="op">=</span> <span class="va">rbind</span>, args <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>reduction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">0</span>, by <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="4%">
<col width="10%">
<col width="15%">
<col width="11%">
<col width="11%">
<col width="11%">
<col width="11%">
<col width="5%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">dfs</th>
<th align="right">n_iknots</th>
<th align="left">iknots</th>
<th align="right">loglik</th>
<th align="right">rss</th>
<th align="right">rse</th>
<th align="right">wiggle</th>
<th align="right">fdsc</th>
<th align="right">reduction</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="left"></td>
<td align="right">-74.52286</td>
<td align="right">25.991002</td>
<td align="right">0.5203264</td>
<td align="right">46.86602</td>
<td align="right">2</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="left">4.5</td>
<td align="right">-60.13965</td>
<td align="right">19.493599</td>
<td align="right">0.4529854</td>
<td align="right">46.12997</td>
<td align="right">2</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">6</td>
<td align="right">2</td>
<td align="left">1, 4.5</td>
<td align="right">-22.06566</td>
<td align="right">9.103022</td>
<td align="right">0.3111923</td>
<td align="right">113.09010</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">7</td>
<td align="right">3</td>
<td align="left">1, 3, 4.5</td>
<td align="right">-19.96695</td>
<td align="right">8.728836</td>
<td align="right">0.3063633</td>
<td align="right">99.30959</td>
<td align="right">4</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">8</td>
<td align="right">4</td>
<td align="left">1, 1.5, â€¦.</td>
<td align="right">-19.95683</td>
<td align="right">8.727070</td>
<td align="right">0.3079926</td>
<td align="right">95.81790</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="right">9</td>
<td align="right">5</td>
<td align="left">1, 1.5, â€¦.</td>
<td align="right">-19.79771</td>
<td align="right">8.699341</td>
<td align="right">0.3091879</td>
<td align="right">92.04602</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="right">10</td>
<td align="right">6</td>
<td align="left">1, 1.5, â€¦.</td>
<td align="right">-19.67393</td>
<td align="right">8.677833</td>
<td align="right">0.3105163</td>
<td align="right">87.38456</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The <code>wiggle</code> is one measure of wiggliness defined as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>âˆ«</mo><mrow><mo>min</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mo>max</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msubsup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msup><mi>d</mi><mn>2</mn></msup><mrow><mi>d</mi><msup><mi>x</mi><mn>2</mn></msup></mrow></mfrac><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mi>d</mi><mi>x</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">
\int_{\min\left(\boldsymbol{\xi}\right)}^{\max\left(\boldsymbol{\xi}\right)}
\left( \frac{d^2}{dx^2} f\left(x\right) \right)^2 dx.
</annotation></semantics></math><code>fdsc</code> reports the number of
times the first derivative has a sign change.</p>
</div>
<div class="section level2">
<h2 id="control-polygon-reduction">Control Polygon Reduction<a class="anchor" aria-label="anchor" href="#control-polygon-reduction"></a>
</h2>
<p>The exercise above of manually identifying and omitting the knot with
the smallest influence in each model would be tedious when working with
a large set of initial knots. Fortunately, the process has been
automated. Calling <code>cpr</code> on a <code>cpr_cp</code> object
defined by a function will automatically omit the internal knot with the
lowest influence.</p>
<div class="section level3">
<h3 id="example-with-known-knots">Example with known knots<a class="anchor" aria-label="anchor" href="#example-with-known-knots"></a>
</h3>
<p>Apply CPR to the <code>initial_cp</code> from the above example.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cpr0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cpr.html">cpr</a></span><span class="op">(</span><span class="va">initial_cp</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cpr0</span></span>
<span><span class="co">## A list of control polygons</span></span>
<span><span class="co">## List of 7</span></span>
<span><span class="co">##  - attr(*, "ioik")=List of 7</span></span>
<span><span class="co">##  - attr(*, "class")= chr [1:2] "cpr_cpr" "list"</span></span></code></pre></div>
<p>There are 7 control polygons within the <code>cpr_cpr</code> object,
<code>length(initial_cp$iknots) + 1</code>. The indexing is set such at
that the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">i^{th}</annotation></semantics></math>
element has
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i-1</annotation></semantics></math>
internal knots.</p>
<p>Before exploring the results, letâ€™s just verify that the results of
the call to <code>cpr</code> are the same as the manual results found
about. There are some differences in the metadata of the objects, but
the important parts, like the control polygons, are the same.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">cpr0</span><span class="op">[[</span><span class="st">"cps"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"cp"</span><span class="op">]</span><span class="op">]</span>,  <span class="va">initial_cp</span><span class="op">[[</span><span class="st">"cp"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] "target is NULL, current is data.frame"</span></span>
<span></span>
<span><span class="co"># some attributes are different with the last cp due to how the automation</span></span>
<span><span class="co"># creates the call vs how the call was created manually.</span></span>
<span><span class="va">call_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cpr0</span><span class="op">[[</span><span class="st">"cps"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="st">"call"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">cpr0</span><span class="op">[[</span><span class="st">"cps"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span>, <span class="va">first_reduction_cp</span> <span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] "target is NULL, current is list"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">cpr0</span><span class="op">[[</span><span class="st">"cps"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span>, <span class="va">second_reduction_cp</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] "target is NULL, current is list"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">cpr0</span><span class="op">[[</span><span class="st">"cps"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span>, <span class="va">third_reduction_cp</span> <span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] "target is NULL, current is list"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">cpr0</span><span class="op">[[</span><span class="st">"cps"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span>, <span class="va">fourth_reduction_cp</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] "target is NULL, current is list"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">cpr0</span><span class="op">[[</span><span class="st">"cps"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span>, <span class="va">fifth_reduction_cp</span> <span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] "target is NULL, current is list"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">cpr0</span><span class="op">[[</span><span class="st">"cps"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span>, <span class="va">sixth_reduction_cp</span> <span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## [1] "target is NULL, current is list"</span></span></code></pre></div>
<p>In the manual process we identified <code>third_reduction_cp</code>
as the preferable model. For the <code>cpr0</code> object we can quickly
see a similar result as we did for the manual process.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cpr0</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">s0</span>, row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="3%">
<col width="4%">
<col width="10%">
<col width="15%">
<col width="11%">
<col width="11%">
<col width="11%">
<col width="11%">
<col width="5%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">dfs</th>
<th align="right">n_iknots</th>
<th align="left">iknots</th>
<th align="right">loglik</th>
<th align="right">rss</th>
<th align="right">rse</th>
<th align="right">wiggle</th>
<th align="right">fdsc</th>
<th align="right">Pr(&gt;w_(1))</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="left"></td>
<td align="right">-74.52286</td>
<td align="right">25.991002</td>
<td align="right">0.5203264</td>
<td align="right">46.86602</td>
<td align="right">2</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="left">4.5</td>
<td align="right">-60.13965</td>
<td align="right">19.493599</td>
<td align="right">0.4529854</td>
<td align="right">46.12997</td>
<td align="right">2</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">6</td>
<td align="right">2</td>
<td align="left">1, 4.5</td>
<td align="right">-22.06566</td>
<td align="right">9.103022</td>
<td align="right">0.3111923</td>
<td align="right">113.09010</td>
<td align="right">4</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">7</td>
<td align="right">3</td>
<td align="left">1, 3, 4.5</td>
<td align="right">-19.96695</td>
<td align="right">8.728836</td>
<td align="right">0.3063633</td>
<td align="right">99.30959</td>
<td align="right">4</td>
<td align="right">0.0000965</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">8</td>
<td align="right">4</td>
<td align="left">1, 1.5, â€¦.</td>
<td align="right">-19.95683</td>
<td align="right">8.727070</td>
<td align="right">0.3079926</td>
<td align="right">95.81790</td>
<td align="right">4</td>
<td align="right">0.6315108</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="right">9</td>
<td align="right">5</td>
<td align="left">1, 1.5, â€¦.</td>
<td align="right">-19.79771</td>
<td align="right">8.699341</td>
<td align="right">0.3091879</td>
<td align="right">92.04602</td>
<td align="right">4</td>
<td align="right">0.0723383</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="right">10</td>
<td align="right">6</td>
<td align="left">1, 1.5, â€¦.</td>
<td align="right">-19.67393</td>
<td align="right">8.677833</td>
<td align="right">0.3105163</td>
<td align="right">87.38456</td>
<td align="right">4</td>
<td align="right">0.0666277</td>
</tr>
</tbody>
</table>
<p>The additional columns in this summary, <code>loglik_elbow</code> and
<code>rse_elbow</code>, indicate a location in the plot for either the
loglik or rse by model index (degrees of freedom) where the trade-off
between additional degrees of freedom and improvement in the fix
statistic is negligible. See plot below. This is determined by finding
the breakpoint such that a continuous, but not differentiable at
breakpoint, quadratic spline fits the plot with minimal residual
standard error.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>  <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr0</span>, color <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr0</span>, show_cp <span class="op">=</span> <span class="cn">FALSE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    , ncol <span class="op">=</span> <span class="fl">1</span></span>
<span>    , common.legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  ,</span>
<span>  <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s0</span>, type <span class="op">=</span> <span class="st">"rse"</span><span class="op">)</span></span>
<span>    , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s0</span>, type <span class="op">=</span> <span class="st">"rss"</span><span class="op">)</span></span>
<span>    , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s0</span>, type <span class="op">=</span> <span class="st">"loglik"</span><span class="op">)</span></span>
<span>    , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s0</span>, type <span class="op">=</span> <span class="st">"wiggle"</span><span class="op">)</span></span>
<span>    , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s0</span>, type <span class="op">=</span> <span class="st">"fdsc"</span><span class="op">)</span></span>
<span>    , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s0</span>, type <span class="op">=</span> <span class="st">"Pr(&gt;w_(1))"</span><span class="op">)</span></span>
<span>  , common.legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  , widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_point()`).</span></span>
<span><span class="co">## Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_line()`).</span></span>
<span><span class="co">## Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_point()`).</span></span>
<span><span class="co">## Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_line()`).</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-28-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="example-when-knots-are-unknown">Example when knots are unknown<a class="anchor" aria-label="anchor" href="#example-when-knots-are-unknown"></a>
</h3>
<p>In practice it is be extremely unlikely to know where knots should be
placed. Analytic solutions are difficult, if not impossible to derive
<span class="citation">(Jupp 1978)</span>. However, an optimal solution
may not be necessary.</p>
<p>From <span class="citation">de Boor (2001)</span> (page 106) <quote>
â€œâ€¦a B-spline doesnâ€™t change much if one changes its
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math>
knots a little bit. Therefore, if one has multiple knots, then it is
very easy to find B-spline almost like with simple knots: Simply replace
knot of multiplicity
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r &gt; 1</annotation></semantics></math>
by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
simple knots nearby.â€ </quote></p>
<p>That is,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ</mi><mrow><mi>k</mi><mo>,</mo><mi>ğ›</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>ğ›‰</mi><mi>ğ›</mi></msub><mo>â‰ˆ</mo><msub><mi>ğ</mi><mrow><mi>k</mi><mo>,</mo><mrow><mi>ğ›</mi><mi mathvariant="bold">â€²</mi></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>ğ›‰</mi><mrow><mi>ğ›</mi><mi mathvariant="bold">â€²</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
  \boldsymbol{B}_{k, \boldsymbol{\xi}}\left(x\right) \boldsymbol{\theta}_{\boldsymbol{\xi}} \approx
  \boldsymbol{B}_{k, \boldsymbol{\xi'}}\left(x\right) \boldsymbol{\theta}_{\boldsymbol{\xi'}}
</annotation></semantics></math> where
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>Î¾</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>Î¾</mi><mi>j</mi></msub><mi>â€²</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>&lt;</mo><mi>Î´</mi><mspace width="1.0em"></mspace><mtext mathvariant="normal">for small</mtext><mspace width="1.0em"></mspace><mi>Î´</mi><mo>&gt;</mo><mn>0</mn><mi>.</mi></mrow><annotation encoding="application/x-tex">
\left\lvert \xi_j - \xi_j' \right\rvert &lt; \delta \quad \text{for small} \quad \delta &gt; 0.
</annotation></semantics></math></p>
<p>So, in the case when we are looking for a good set of knots (a good
set of knots should be parsimonious, and provide a good model fit) we
start with an initial knot sequence with a high cardinality, this is not
without precedent <span class="citation">Eilers and Marx (2010)</span>.
We then apply the CPR algorithm to find a good set of knots.</p>
<p>For example we will use 50 internal knots. Not surprisingly we have a
fit that is more â€œconnect-the-dotsâ€ than a smooth fit.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_cp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, df <span class="op">=</span> <span class="fl">54</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">initial_cp</span>, show_cp <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="va">original_data_ggplot_layers</span></span>
<span>  ,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">initial_cp</span>, show_cp <span class="op">=</span> <span class="cn">FALSE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="va">original_data_ggplot_layers</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-29-1.png" width="672"></p>
<p>Apply CPR to the <code>initial_cp</code> and look at the summary.
Only the first 10 of 51 rows are provided here.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cpr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cpr.html">cpr</a></span><span class="op">(</span><span class="va">initial_cp</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cpr1</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="4%">
<col width="10%">
<col width="15%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="13%">
<col width="6%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="right">dfs</th>
<th align="right">n_iknots</th>
<th align="left">iknots</th>
<th align="right">loglik</th>
<th align="right">rss</th>
<th align="right">rse</th>
<th align="right">wiggle</th>
<th align="right">fdsc</th>
<th align="right">Pr(&gt;w_(1))</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">4</td>
<td align="right">0</td>
<td align="left"></td>
<td align="right">-74.52286</td>
<td align="right">25.991002</td>
<td align="right">0.5203264</td>
<td align="right">46.86602</td>
<td align="right">2</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">4.440871â€¦.</td>
<td align="right">-60.80852</td>
<td align="right">19.756126</td>
<td align="right">0.4560255</td>
<td align="right">44.96627</td>
<td align="right">2</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="right">2</td>
<td align="left">0.752226â€¦.</td>
<td align="right">-26.01135</td>
<td align="right">9.850479</td>
<td align="right">0.3237164</td>
<td align="right">246.23540</td>
<td align="right">4</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">3</td>
<td align="left">0.636956â€¦.</td>
<td align="right">-24.77752</td>
<td align="right">9.610379</td>
<td align="right">0.3214614</td>
<td align="right">104.90530</td>
<td align="right">4</td>
<td align="right">0.0020696</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">4</td>
<td align="left">0.636956â€¦.</td>
<td align="right">-19.81416</td>
<td align="right">8.702204</td>
<td align="right">0.3075535</td>
<td align="right">639.20789</td>
<td align="right">4</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="right">5</td>
<td align="left">0.521686â€¦.</td>
<td align="right">-19.38824</td>
<td align="right">8.628390</td>
<td align="right">0.3079245</td>
<td align="right">774.74506</td>
<td align="right">6</td>
<td align="right">0.0076769</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">6</td>
<td align="left">0.175876â€¦.</td>
<td align="right">-18.77810</td>
<td align="right">8.523739</td>
<td align="right">0.3077470</td>
<td align="right">3232.38887</td>
<td align="right">6</td>
<td align="right">0.0006350</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="right">7</td>
<td align="left">0.175876â€¦.</td>
<td align="right">-18.72815</td>
<td align="right">8.515228</td>
<td align="right">0.3093165</td>
<td align="right">4256.85750</td>
<td align="right">6</td>
<td align="right">0.1540572</td>
</tr>
<tr class="odd">
<td align="right">12</td>
<td align="right">8</td>
<td align="left">0.175876â€¦.</td>
<td align="right">-18.22634</td>
<td align="right">8.430195</td>
<td align="right">0.3095120</td>
<td align="right">9158.80131</td>
<td align="right">8</td>
<td align="right">0.0002060</td>
</tr>
<tr class="even">
<td align="right">13</td>
<td align="right">9</td>
<td align="left">0.175876â€¦.</td>
<td align="right">-18.22608</td>
<td align="right">8.430151</td>
<td align="right">0.3112849</td>
<td align="right">9215.39496</td>
<td align="right">8</td>
<td align="right">0.8567697</td>
</tr>
</tbody>
</table>
<p>From this, the preferable model is suggested to be index 5, the model
with four internal knots. Inspection of the rse by index plot, I would
argue from a manual selection that index 5 is preferable overall.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, type <span class="op">=</span> <span class="st">"rse"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<p>Letâ€™s compare the models in indices 3, 4, and 5.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr1</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">cpr1</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, <span class="va">cpr1</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>, show_cp <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  ,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr1</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">cpr1</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, <span class="va">cpr1</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>, show_cp <span class="op">=</span> <span class="cn">FALSE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  ,</span>
<span>  common.legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-33-1.png" width="672"></p>
<p>The noticeable differences are, for the most part, located on the
left side of the support between between 0 and 1. For the fifth index,
there is change in convexity of the spline. Knowing that the models at
index 3 and 4 are good fits too, then it would be easy not select index
5 due to extra â€œwiggleâ€ in the spline.</p>
<p>In practice I would likely pick the model in index 4 to have a smooth
(small wiggle) and low rse. Compare the selected model to the original
data.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr1</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, show_cp <span class="op">=</span> <span class="cn">FALSE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Model Index 3"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">original_data_ggplot_layers</span></span>
<span>  , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr1</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, show_cp <span class="op">=</span> <span class="cn">FALSE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Model Index 4"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">original_data_ggplot_layers</span></span>
<span>  , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr1</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>, show_cp <span class="op">=</span> <span class="cn">FALSE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Model Index 5"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">original_data_ggplot_layers</span></span>
<span>  , nrow <span class="op">=</span> <span class="fl">1</span></span>
<span>  , legend <span class="op">=</span> <span class="st">"none"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-34-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="extensions-to-higher-dimensions">Extensions to higher dimensions<a class="anchor" aria-label="anchor" href="#extensions-to-higher-dimensions"></a>
</h2>
<p>CPR works for uni-variable B-splines. By taking tensor products of
B-splines, and building a control-net, the higher-dimensional analog of
a control polygon, we can apply similar methods to estimate a surface.
Details on the Control Net Reduction method are presented in</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="st">"cnr"</span>, package <span class="op">=</span> <span class="st">"cpr"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-boehm1980" class="csl-entry">
Boehm, Wolfgang. 1980. <span>â€œInserting New Knots into b-Spline
Curves.â€</span> <em>Computer-Aided Design</em> 12 (4): 199â€“201.
</div>
<div id="ref-deboor2001" class="csl-entry">
de Boor, Carl. 2001. <em>A Practical Guide to Splines, Revised Edition,
Vol. 27 of Applied Mathematical Sciences</em>. Springer-Verlag, Berlin.
</div>
<div id="ref-eilers1996" class="csl-entry">
Eilers, Paul HC, and Brian D Marx. 1996. <span>â€œFlexible Smoothing with
b-Splines and Penalties.â€</span> <em>Statistical Science</em>, 89â€“102.
</div>
<div id="ref-eilers2010" class="csl-entry">
â€”â€”â€”. 2010. <span>â€œSplines, Knots, and Penalties.â€</span> <em>Wiley
Interdisciplinary Reviews: Computational Statistics</em> 2 (6): 637â€“53.
</div>
<div id="ref-jupp1978approximation" class="csl-entry">
Jupp, David LB. 1978. <span>â€œApproximation to Data by Splines with Free
Knots.â€</span> <em>SIAM Journal on Numerical Analysis</em> 15 (2):
328â€“43.
</div>
<div id="ref-prautzsch2002" class="csl-entry">
Prautzsch, Hartmut, Wolfgang Boehm, and Marco Paluszny. 2002.
<em>B<span>Ã©</span>zier and b-Spline Techniques</em>. Springer Science
&amp; Business Media.
</div>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] cpr_0.4.0.9000 qwraps2_0.6.0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] sass_0.4.9        utf8_1.2.4        generics_0.1.3    tidyr_1.3.1      </span></span>
<span><span class="co">##  [5] rstatix_0.7.2     lattice_0.22-6    lme4_1.1-35.5     digest_0.6.36    </span></span>
<span><span class="co">##  [9] magrittr_2.0.3    evaluate_0.24.0   grid_4.4.1        fastmap_1.2.0    </span></span>
<span><span class="co">## [13] Matrix_1.7-0      jsonlite_1.8.8    backports_1.5.0   gridExtra_2.3    </span></span>
<span><span class="co">## [17] purrr_1.0.2       fansi_1.0.6       scales_1.3.0      textshaping_0.4.0</span></span>
<span><span class="co">## [21] jquerylib_0.1.4   abind_1.4-5       cli_3.6.3         rlang_1.1.4      </span></span>
<span><span class="co">## [25] cowplot_1.1.3     munsell_0.5.1     splines_4.4.1     withr_3.0.0      </span></span>
<span><span class="co">## [29] cachem_1.1.0      yaml_2.3.10       tools_4.4.1       nloptr_2.1.1     </span></span>
<span><span class="co">## [33] ggsignif_0.6.4    minqa_1.2.7       dplyr_1.1.4       colorspace_2.1-1 </span></span>
<span><span class="co">## [37] ggplot2_3.5.1     ggpubr_0.6.0      boot_1.3-30       broom_1.0.6      </span></span>
<span><span class="co">## [41] vctrs_0.6.5       R6_2.5.1          lifecycle_1.0.4   car_3.1-2        </span></span>
<span><span class="co">## [45] fs_1.6.4          htmlwidgets_1.6.4 MASS_7.3-60.2     ragg_1.3.2       </span></span>
<span><span class="co">## [49] pkgconfig_2.0.3   desc_1.4.3        pkgdown_2.1.0     pillar_1.9.0     </span></span>
<span><span class="co">## [53] bslib_0.7.0       gtable_0.3.5      glue_1.7.0        Rcpp_1.0.13      </span></span>
<span><span class="co">## [57] systemfonts_1.1.0 xfun_0.46         tibble_3.2.1      tidyselect_1.2.1 </span></span>
<span><span class="co">## [61] highr_0.11        knitr_1.48        farver_2.1.2      nlme_3.1-164     </span></span>
<span><span class="co">## [65] htmltools_0.5.8.1 carData_3.0-5     rmarkdown_2.27    labeling_0.4.3   </span></span>
<span><span class="co">## [69] compiler_4.4.1</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Peter DeWitt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
