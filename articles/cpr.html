<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="cpr">
<title>Control Polygon Reduction • cpr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Control Polygon Reduction">
<meta property="og:description" content="cpr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cpr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/cpr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/cnr.html">Tensor Products of B-Splines, Control Nets, and Control Net Reduction</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dewittpe/cpr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Control Polygon Reduction</h1>
                        <h4 data-toc-skip class="author">Peter E.
DeWitt</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dewittpe/cpr/blob/HEAD/vignettes/cpr.Rmd" class="external-link"><code>vignettes/cpr.Rmd</code></a></small>
      <div class="d-none name"><code>cpr.Rmd</code></div>
    </div>

    
    
<style type="text/css">
window.MathJax = {
   tex: {
     tags: 'ams'
   }
};
</style>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dewittpe/cpr/" class="external-link">cpr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"cpr"</span><span class="op">)</span></span>
<span><span class="co">## [1] '0.3.0.9000'</span></span></code></pre></div>
<p>The purpose of this vignette is to illustrate how the Control Polygon
Reduction (CPR) method can be used to select a set of knots defining
B-spline to get a low degree of freedom and smooth fit to data. We start
with a primer on B-splines and control polygons then the development and
use of CPR.</p>
<div class="section level2">
<h2 id="b-splines-and-control-polygons">B-splines and Control Polygons<a class="anchor" aria-label="anchor" href="#b-splines-and-control-polygons"></a>
</h2>
<p>The term “spline” is likely derived from shipwright or draftsmen
splines, thin wood strips, held in place by weights, used to define
curves. These splines naturally minimize strain energy and the use of
additional weights at strategic locations on the spline are needed to
achieve specific curvatures. Cubic B-splines are not dissimilar.</p>
<p>Splines are piecewise polynomial curves that are differentiable up to
a prescribed order. B-splines are based on a <em>basis</em> of
polynomial functions.</p>
<p>Definitions and notation for uni-variable and multi-variable
B-splines and the associated control polygons and control nets are
presented in the following. Two very good references for splines are
<span class="citation">de Boor (2001)</span> and <span class="citation">Prautzsch, Boehm, and Paluszny (2002)</span> if you
wish to dig into the details.</p>
<div class="section level3">
<h3 id="b-splines">B-splines<a class="anchor" aria-label="anchor" href="#b-splines"></a>
</h3>
<p>A curve defined by <span class="math inline">\(f\left(x\right)\)</span> is a spline of order
<span class="math inline">\(k\)</span> (degree <span class="math inline">\(k -1\)</span>), with knots <span class="math inline">\(\xi_1, \xi_2, \ldots, \xi_m\)</span> where <span class="math inline">\(\xi_j \leq x_{j+1}\)</span> and <span class="math inline">\(\xi_{j} &lt; \xi_{j + k} \forall i\)</span> if
<span class="math inline">\(f\left(x\right)\)</span> is <span class="math inline">\(k-r-1\)</span> times differentiable at any <span class="math inline">\(r\)</span>-fold knot, and <span class="math inline">\(f\left(x\right)\)</span> is a polynomial of order
<span class="math inline">\(\leq k\)</span> over each interval <span class="math inline">\(x \in \left[\xi_j, \xi_{j+1}\right]\)</span> for
<span class="math inline">\(j = 0, \ldots, m - 1.\)</span></p>
<p>In particular, B-splines, are defined as an affine combination:</p>
<p><span class="math display">\[\begin{equation}
  f \left( x \right) =
  \sum_{j} \theta_j B_{j,k,\boldsymbol{\xi}}\left(x\right) =
  \boldsymbol{B}_{k, \boldsymbol{\xi}} \left(x\right)
\boldsymbol{\theta}_{\boldsymbol{\xi}}
  \label{eq:f}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(B_{j,k,\boldsymbol{\xi}}\left(x\right)\)</span> is
the <span class="math inline">\(j^{th}\)</span> basis spline function,
<span class="math inline">\(\boldsymbol{\xi}\)</span> is a sequence of
<span class="math inline">\(l\)</span> interior knots and a total of
<span class="math inline">\(2k\)</span> boundary knots, i.e., the
cardinality of the knot sequence is <span class="math inline">\(\left\lvert \boldsymbol{\xi} \right\rvert = 2k +
l.\)</span> The value of the <span class="math inline">\(k\)</span>
boundary knots is arbitrary, but a common choice is to use <span class="math inline">\(k\)</span>-fold knots on the boundary:</p>
<p><span class="math display">\[ \xi_1 = \xi_2 = \cdots = \xi_k &lt;
\xi_{k+1} \leq \cdots \leq \xi_{k + l} =
\xi_{k + l + 1} = \cdots = \xi_{2k + l}.\]</span></p>
<p>Alternative boundary knots can be used so long as the sequence <span class="math inline">\(\boldsymbol{\xi}\)</span> is non-decreasing. More
on the implications of <span class="math inline">\(k\)</span>-fold
boundary knots follow in the next section.</p>
<p>The <span class="math inline">\(j^{th}\)</span> B-spline is defined
as:</p>
<p><span class="math display">\[\begin{equation}
B_{j,k,\boldsymbol{\xi}}\left(x\right) =
\omega_{j,k,\boldsymbol{\xi}} \left(x\right)
B_{j,k-1,\boldsymbol{\xi}}\left(x\right) +
\left(1 - \omega_{j+1,k,\boldsymbol{\xi}} \right)
B_{j+1,k-1,\boldsymbol{\xi}}\left(x\right),
\end{equation}\]</span> where <span class="math display">\[\begin{equation}
B_{j,k,\boldsymbol{\xi}}\left(x\right) = 0 \quad \text{for} \quad x
\notin
\left[\xi_j, \xi_{j+k} \right), \quad \quad
B_{j,1,\boldsymbol{\xi}}\left(x\right) = \begin{cases}
1 &amp; x \in \left[\xi_j, \xi_{j+k}\right) \\ 0 &amp; \text{otherwise},
\end{cases}
\end{equation}\]</span> and <span class="math display">\[\begin{equation}
\omega_{j,k,\boldsymbol{\xi}}\left(x\right) = \begin{cases}
0 &amp; x \leq \xi_j \\ \frac{x-\xi_j}{\xi_{j+k-1} - \xi_{j}} &amp;
\xi_j &lt; x &lt; \xi_{j+k-1} \\
1 &amp; \xi_{j+k-1} \leq x.
\end{cases}
\end{equation}\]</span></p>
<p>For a set of observations, <span class="math inline">\(\boldsymbol{x}
= x_1, \ldots, x_n,\)</span> the basis functions defined above
generalize to a matrix:</p>
<p><span class="math display">\[\begin{equation}
  \boldsymbol{B}_{k, \boldsymbol{\xi}} \left(\boldsymbol{x}\right) =
  \begin{pmatrix}
    B_{1, k, \boldsymbol{\xi}} \left(x_1\right) &amp;
    B_{2, k, \boldsymbol{\xi}} \left(x_1\right) &amp;
    \ldots &amp;
    B_{k + l, k, \boldsymbol{\xi}} \left(x_1\right) \\
    \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
    B_{1, k, \boldsymbol{\xi}} \left(x_n\right) &amp;
    B_{2, k, \boldsymbol{\xi}} \left(x_n\right) &amp;
    \ldots &amp;
    B_{k + l, k, \boldsymbol{\xi}} \left(x_n\right).
  \end{pmatrix}
\end{equation}\]</span></p>
<p>Within the cpr package we can generate a basis matrix thusly:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5.9999</span>, length.out <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span>
<span><span class="va">bmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2.3</span>, <span class="fl">4</span>, <span class="fl">4.5</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bmat</span></span>
<span><span class="co">## Basis matrix dims: [5,000 x 9]</span></span>
<span><span class="co">## Order: 4</span></span>
<span><span class="co">## Number of internal knots: 5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## First 6 rows:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##           [,1]        [,2]         [,3]         [,4] [,5] [,6] [,7] [,8] [,9]</span></span>
<span><span class="co">## [1,] 1.0000000 0.000000000 0.000000e+00 0.000000e+00    0    0    0    0    0</span></span>
<span><span class="co">## [2,] 0.9964037 0.003593461 2.878634e-06 5.011451e-10    0    0    0    0    0</span></span>
<span><span class="co">## [3,] 0.9928160 0.007172539 1.150485e-05 4.009161e-09    0    0    0    0    0</span></span>
<span><span class="co">## [4,] 0.9892369 0.010737255 2.586411e-05 1.353092e-08    0    0    0    0    0</span></span>
<span><span class="co">## [5,] 0.9856664 0.014287632 4.594188e-05 3.207329e-08    0    0    0    0    0</span></span>
<span><span class="co">## [6,] 0.9821045 0.017823691 7.172363e-05 6.264314e-08    0    0    0    0    0</span></span></code></pre></div>
<p>Note: the default order for <code>bsplines</code> is 4, and the
default for the boundary knots is the range of <code>x</code>. However,
relying on the default boundary knots can lead to unexpected behavior
as, by definition the splines on the <span class="math inline">\(k\)</span>-fold upper boundary is 0.</p>
<p>We can quickly view the plot of each of these spline functions as
well.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bmat</span>, show_xi <span class="op">=</span> <span class="cn">TRUE</span>, show_x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/plot%20bmat-1.png" width="672"></p>
<p>A few of many important properties of the basis functions:</p>
<p><span class="math display">\[B_{j,k,\boldsymbol{xi}} \left(x\right)
\in \left[0, 1\right], \forall x \in \mathbb{R};\]</span></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">bmat</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">bmat</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre></div>
<p><span class="math display">\[B_{j,k,\boldsymbol{\xi}} \left(x\right)
&gt; 0 \quad \text{for} \quad x \in \left(\xi_{j},
\xi_{j+k}\right);\]</span></p>
<p>and</p>
<p><span class="math display">\[\sum_j B_{j,k,\boldsymbol{xi}}
\left(x\right) = \begin{cases} 1 &amp; x \in
\left[\xi_1, \xi_{2k+l}\right) \\ 0 &amp; otherwise.
\end{cases}\]</span></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">bmat</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bmat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre></div>
<div class="section level4">
<h4 id="cprbsplines-vs-splinesbs">cpr::bsplines vs splines::bs<a class="anchor" aria-label="anchor" href="#cprbsplines-vs-splinesbs"></a>
</h4>
<p>Part of the base R distribution is the splines package which build
B-splines by calling <code>bs</code>. There are three areas where the
functions differ: 1. input arguments, 2. attributes of the returned
matrix, and 3. behavior at the right boundary knot.</p>
<div class="section level5">
<h5 id="input-arguments">Input Arguments<a class="anchor" aria-label="anchor" href="#input-arguments"></a>
</h5>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">bsplines</span><span class="op">)</span></span>
<span><span class="co">## function (x, iknots = NULL, df = NULL, bknots = range(x), order = 4L) </span></span>
<span><span class="co">## NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="fu">splines</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></span><span class="op">)</span></span>
<span><span class="co">## function (x, df = NULL, knots = NULL, degree = 3, intercept = FALSE, </span></span>
<span><span class="co">##     Boundary.knots = range(x), warn.outside = TRUE) </span></span>
<span><span class="co">## NULL</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="33%">
<col width="44%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="left">cpr::bsplines</th>
<th align="left">splines::bs</th>
<th align="left">Notes</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">x</td>
<td align="left">x</td>
<td align="left">numeric vector; the predictor variable</td>
</tr>
<tr class="even">
<td align="left">iknots</td>
<td align="left">knots</td>
<td align="left">internal knots</td>
</tr>
<tr class="odd">
<td align="left">bknots</td>
<td align="left">Boundary.knots</td>
<td align="left">boundary knots</td>
</tr>
<tr class="even">
<td align="left">order</td>
<td align="left">degree</td>
<td align="left">polynomial order = polynomial degree + 1</td>
</tr>
<tr class="odd">
<td align="left">df</td>
<td align="left">df</td>
<td align="left">degrees of freedom</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">intercept</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">warn.outside</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><code>bsplines</code> does not have the <code>intercept</code> nor
the <code>warn.outside</code> arguments because the matrix generated by
<code>bsplines</code> effectively <em>always</em> has
<code>intercept = TRUE</code> and <code>warn.outside = TRUE</code>. How
values of <code>x</code> at the right boundary, and outside the boundary
are treated also differ between the two functions.</p>
</div>
<div class="section level5">
<h5 id="attributes-of-the-returned-matrices">Attributes of the returned matrices<a class="anchor" aria-label="anchor" href="#attributes-of-the-returned-matrices"></a>
</h5>
<p>The default call for both B-spline functions returns a basis matrix
for a order 4 (degree 3; cubic) B-spline with boundary knots placed at
<code>range(x)</code>. However, the returns are not the same.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bs_mat</span> <span class="op">&lt;-</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></span><span class="op">(</span><span class="va">x</span>, knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bmat</span>, <span class="st">"iknots"</span><span class="op">)</span>, Boundary.knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bmat</span>, <span class="st">"bknots"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">bmat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## List of 10</span></span>
<span><span class="co">##  $ dim        : int [1:2] 5000 9</span></span>
<span><span class="co">##  $ order      : num 4</span></span>
<span><span class="co">##  $ df         : num 9</span></span>
<span><span class="co">##  $ iknots     : num [1:5] 1 1.5 2.3 4 4.5</span></span>
<span><span class="co">##  $ bknots     : num [1:2] 0 6</span></span>
<span><span class="co">##  $ xi         : num [1:13] 0 0 0 0 1 1.5 2.3 4 4.5 6 ...</span></span>
<span><span class="co">##  $ xi_star    : num [1:9] 0 0.333 0.833 1.6 2.6 ...</span></span>
<span><span class="co">##  $ class      : chr [1:2] "cpr_bs" "matrix"</span></span>
<span><span class="co">##  $ call       : language bsplines(x = x, iknots = c(1, 1.5, 2.3, 4, 4.5), bknots = c(0, 6))</span></span>
<span><span class="co">##  $ environment:&lt;environment: R_GlobalEnv&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">bs_mat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## List of 7</span></span>
<span><span class="co">##  $ dim           : int [1:2] 5000 8</span></span>
<span><span class="co">##  $ dimnames      :List of 2</span></span>
<span><span class="co">##   ..$ : NULL</span></span>
<span><span class="co">##   ..$ : chr [1:8] "1" "2" "3" "4" ...</span></span>
<span><span class="co">##  $ degree        : int 3</span></span>
<span><span class="co">##  $ knots         : num [1:5] 1 1.5 2.3 4 4.5</span></span>
<span><span class="co">##  $ Boundary.knots: num [1:2] 0 6</span></span>
<span><span class="co">##  $ intercept     : logi FALSE</span></span>
<span><span class="co">##  $ class         : chr [1:3] "bs" "basis" "matrix"</span></span></code></pre></div>
<p>The <code>bspline_mat</code> has additional attributes related to the
control polygons.</p>
<p>The major difference is the in the dimension of the matrices. By
default <code><a href="https://rdrr.io/r/splines/bs.html" class="external-link">splines::bs</a></code> omits one column from the basis matrix
such that when using using the function is a regression formula the
resulting design matrix is not rank deficient. Using
<code>bsplines</code> would suggest using a <code>+0</code> or
<code>-1</code> in the regression formula to omit the intercept (is
nuance is handled in calls to <code>cp</code> so the end user need not
worry about it).</p>
</div>
<div class="section level5">
<h5 id="right-continuity">Right Continuity<a class="anchor" aria-label="anchor" href="#right-continuity"></a>
</h5>
<p>By definition, the <span class="math inline">\(\boldsymbol{B}_{j,k,\boldsymbol{\xi}}\left(x\right)\)</span>
are non-negative right-continuous functions. <code>bsplines</code>
adheres to the definition strictly, whereas <code><a href="https://rdrr.io/r/splines/bs.html" class="external-link">splines::bs</a></code>
uses a pivoting method to allow for non-zero extrapolations outside the
support.</p>
<p>Example: for the <code><a href="../reference/bsplines.html">cpr::bsplines</a></code> call, notice that the
first, third, and fifth rows, corresponding to values outside the
support are all zeros as are the row sums. Compare that to the
<code><a href="https://rdrr.io/r/splines/bs.html" class="external-link">splines::bs</a></code> which returns negative values and in the
matrix, and all rows sum to 1.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bspline_eg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Warning in bsplines(c(0, 1, 2, 5, 6), bknots = c(1, 5)): At least one x value &lt;</span></span>
<span><span class="co">## min(bknots)</span></span>
<span><span class="co">## Warning in bsplines(c(0, 1, 2, 5, 6), bknots = c(1, 5)): At least one x value</span></span>
<span><span class="co">## &gt;= max(bknots)</span></span>
<span><span class="va">bs_eg</span>      <span class="op">&lt;-</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>, Boundary.knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, intercept <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span>
<span><span class="co">## Warning in splines::bs(c(0, 1, 2, 5, 6), Boundary.knots = c(1, 5), intercept =</span></span>
<span><span class="co">## TRUE): some 'x' values beyond boundary knots may cause ill-conditioned bases</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bspline_eg</span><span class="op">)</span></span>
<span><span class="co">##          [,1]     [,2]     [,3]     [,4]</span></span>
<span><span class="co">## [1,] 0.000000 0.000000 0.000000 0.000000</span></span>
<span><span class="co">## [2,] 1.000000 0.000000 0.000000 0.000000</span></span>
<span><span class="co">## [3,] 0.421875 0.421875 0.140625 0.015625</span></span>
<span><span class="co">## [4,] 0.000000 0.000000 0.000000 0.000000</span></span>
<span><span class="co">## [5,] 0.000000 0.000000 0.000000 0.000000</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">bspline_eg</span><span class="op">)</span></span>
<span><span class="co">## [1] 0 1 1 0 0</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bs_eg</span><span class="op">)</span></span>
<span><span class="co">##              1         2         3         4</span></span>
<span><span class="co">## [1,]  1.953125 -1.171875  0.234375 -0.015625</span></span>
<span><span class="co">## [2,]  1.000000  0.000000  0.000000  0.000000</span></span>
<span><span class="co">## [3,]  0.421875  0.421875  0.140625  0.015625</span></span>
<span><span class="co">## [4,]  0.000000  0.000000  0.000000  1.000000</span></span>
<span><span class="co">## [5,] -0.015625  0.234375 -1.171875  1.953125</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">bs_eg</span><span class="op">)</span></span>
<span><span class="co">## [1] 1 1 1 1 1</span></span></code></pre></div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="control-polygons">Control Polygons<a class="anchor" aria-label="anchor" href="#control-polygons"></a>
</h2>
<p>The spline <span class="math inline">\(f\left(\boldsymbol{x}\right) =
\boldsymbol{B}_{k,\boldsymbol{\xi}}\left(\boldsymbol{x}\right)\)</span>
is a convex sum of the coefficients <span class="math inline">\(\boldsymbol{\theta}_{\boldsymbol{\xi}}.\)</span> A
meaningful geometric relationship between <span class="math inline">\(\boldsymbol{\xi}\)</span> and <span class="math inline">\(\boldsymbol{\theta}_{\boldsymbol{\xi}}\)</span>
exist in the form of a <strong>control polygon</strong>, <span class="math inline">\(CP_{k,\boldsymbol{\xi},\boldsymbol{\theta}_{\boldsymbol{\xi}}},\)</span>
a strong convex hull for <span class="math inline">\(\boldsymbol{B}_{k,\boldsymbol{\xi}}\left(\boldsymbol{x}\right)
\boldsymbol{\theta}_{\boldsymbol{\xi}}.\)</span></p>
<p><span class="math display">\[\begin{equation}
CP_{k,\boldsymbol{\xi},\boldsymbol{\theta}_{\xi}} =
\left\{ \left( \xi_{j}^{*}, \theta_{j,\boldsymbol{\xi}} \right) \right
\}_{j=1}^{\left\lvert\boldsymbol{\theta}_{\boldsymbol{\xi}}\right\rvert};
\quad \quad
\xi_{j}^{*} = \frac{1}{k-1} \sum_{i = 1}^{k-1} \xi_{j + i}.
\end{equation}\]</span></p>
<p><span class="math inline">\(CP_{k,\boldsymbol{\xi},\boldsymbol{\theta}_{\boldsymbol{\xi}}}\)</span>
is a sequence of <span class="math inline">\(\left\lvert
\boldsymbol{\theta}_{\boldsymbol{\xi}} \right\rvert = k + l\)</span>
control vertices. The control polygon can be thought of as a piecewise
linear function approximating the spline function. Changes in convexity
and other subtle characteristics of the spline function are exaggerated
by the control polygon.</p>
<p>For example, using the basis matrix defined above and the following
coefficients we can easily define a spline function and control
polygon.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3.5</span>, <span class="fl">4.2</span>, <span class="fl">3.7</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.7</span>, <span class="fl">2</span>, <span class="fl">1.5</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">cp0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">bmat</span>, <span class="va">theta</span><span class="op">)</span></span></code></pre></div>
<p>Plotting the control polygon and the corresponding spline:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cp0</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/plot%20cp-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="knot-influence">Knot Influence<a class="anchor" aria-label="anchor" href="#knot-influence"></a>
</h2>
<div class="section level3">
<h3 id="spline-spaces-and-inserting-a-knot">Spline Spaces and Inserting a Knot<a class="anchor" aria-label="anchor" href="#spline-spaces-and-inserting-a-knot"></a>
</h3>
<p>Consider two knot sequences <span class="math inline">\(\boldsymbol{\xi}\)</span> and <span class="math inline">\(\boldsymbol{\xi} \cup
\boldsymbol{\xi}'.\)</span> Then, for a given polynomial order <span class="math inline">\(k,\)</span> the spline space <span class="math inline">\(\mathbb{S}_{k,\boldsymbol{\xi}} \subset
\mathbb{S}_{k,\boldsymbol{\xi} \cup \boldsymbol{\xi}'}\)</span>
<span class="citation">(de Boor 2001, pg135)</span>. Given this
relationship between spline spaces, and the convex sums generating
spline functions, <span class="citation">Boehm (1980)</span> presented a
method for inserting a knots into the knot sequence such that the spline
function is unchanged. Specifically, for <span class="math display">\[
\boldsymbol{\xi}' = \left\{\left. \xi_{j}' \right|
\min\left(\boldsymbol{\xi}\right) &lt; \xi_j &lt;
\max\left(\boldsymbol{\xi}\right) \quad \forall j\right\},
\]</span> then there exist a <span class="math inline">\(\boldsymbol{\theta}_{\boldsymbol{\xi} \cup
\boldsymbol{\xi}'}\)</span> such that <span class="math display">\[
\boldsymbol{B}_{k,\boldsymbol{\xi}}
\left(x\right)\boldsymbol{\theta}_{\boldsymbol{\xi}} =
\boldsymbol{B}_{k,\boldsymbol{\xi}\cup\boldsymbol{\xi}'}\left(x\right)
\boldsymbol{\theta}_{\boldsymbol{\xi} \cup \boldsymbol{\xi}'}
\quad \forall x \in \left[\min\left(\boldsymbol{\xi}\right),
\max\left(\boldsymbol{\xi} \right) \right].
\]</span></p>
<p>When inserting a singleton <span class="math inline">\(\xi'\)</span> into <span class="math inline">\(\boldsymbol{\xi},\)</span> then <span class="math display">\[
\boldsymbol{\theta}_{\boldsymbol{\xi} \cup \xi'} =
\boldsymbol{W}_{k,
\boldsymbol{\xi}}\left(\xi'\right)
\boldsymbol{\theta}_{\boldsymbol{\xi}}
\]</span> where <span class="math inline">\(\boldsymbol{W}_{k,\boldsymbol{\xi}}\left(\xi'\right)\)</span>
is a <span class="math inline">\(\left( \left\lvert \boldsymbol{\theta}
\right\rvert + 1\right) \times \left\lvert \boldsymbol{\theta}
\right\rvert\)</span> lower bi-diagonal matrix <span class="math display">\[
\boldsymbol{W}_{k,\boldsymbol{\xi}}\left(\xi'\right) =
\begin{pmatrix}
1 &amp; 0 &amp; \cdots &amp; 0 \\
1 - \omega_{1, k, \boldsymbol{\xi}}\left(\xi'\right) &amp;
\omega_{1, k, \boldsymbol{\xi}} \left(\xi'\right) &amp; \cdots &amp;
0 \\
0 &amp; 1 - \omega_{2, k, \boldsymbol{\xi}}\left(\xi'\right) &amp;
\cdots 0 \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; 1 - \omega_{\left\lvert \boldsymbol{\theta} \right\rvert
- 1, k, \boldsymbol{\xi}} \left(\xi'\right) &amp;
\omega_{\left\lvert \boldsymbol{\theta} \right\rvert - 1, k,
\boldsymbol{\xi}} \left(\xi'\right) \\
0 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix},
\]</span> with <span class="math inline">\(\omega_{j,k,\boldsymbol{\xi}}\left(x\right)\)</span>
as defined above in the de~Boor recursive algorithm. Through recursion
we can insert as many knots into <span class="math inline">\(\boldsymbol{\xi}\)</span> without changing the
value of the spline function.</p>
<p>For an example, insert a knot <span class="math inline">\(\xi' =
3\)</span> into the control polygon defined above.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/insert_a_knot.html">insert_a_knot</a></span><span class="op">(</span><span class="va">cp0</span>, xi_prime <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cp0</span>, <span class="va">cp1</span>, color <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/insert%20xi_prime%20=%203-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="assessing-influence-of-xi_j">Assessing influence of <span class="math inline">\(\xi_j\)</span><a class="anchor" aria-label="anchor" href="#assessing-influence-of-xi_j"></a>
</h3>
<p>Here we derivate a metric for assessing how much influence <span class="math inline">\(\xi_j \in \boldsymbol{\xi}\)</span> has on <span class="math inline">\(\boldsymbol{B}_{k,\boldsymbol{\xi}}
\left(x\right)\boldsymbol{\theta}_{\boldsymbol{\xi}}.\)</span> Using the
relationship defined by <span class="citation">Boehm (1980)</span>, we
can derivate a metric for the influence of <span class="math inline">\(\xi_j\)</span> on the spline function.</p>
<p>Start with an defined <span class="math inline">\(k,
\boldsymbol{\xi},\)</span> and <span class="math inline">\(\boldsymbol{\theta}_{k,\boldsymbol{\xi}}.\)</span>
The relationship <span class="math display">\[
\boldsymbol{\theta}_{\boldsymbol{\xi}} =
\boldsymbol{W}_{k,\boldsymbol{\xi}\backslash\xi_{j}}\left(\xi_{j}\right)
\boldsymbol{\theta}_{\boldsymbol{\xi}\backslash\xi_{j}}
\]</span> holds if <span class="math inline">\(\xi_j\)</span> has zero
influence. However, in practice, we would expect that the relationship
is <span class="math display">\[
\boldsymbol{\theta}_{\boldsymbol{\xi}} =
\boldsymbol{W}_{k,\boldsymbol{\xi}\backslash\xi_{j}}\left(\xi_{j}\right)
\boldsymbol{\theta}_{\boldsymbol{\xi}\backslash\xi_{j}} + \boldsymbol{d}
\]</span> for a set of deviations <span class="math inline">\(\boldsymbol{d}\)</span> which would be equal to
<span class="math inline">\(\boldsymbol{0}\)</span> if <span class="math inline">\(\xi_j\)</span> has no influence on the spline.</p>
<p>We can estimate <span class="math inline">\(\boldsymbol{d}\)</span>
via least squares. To simplify the notation in the following we drop
some of the subscripts and parenthesis, that is, let <span class="math inline">\(\boldsymbol{W} =
\boldsymbol{W}_{k,\boldsymbol{\xi}\backslash\xi_{j}}\left(\xi_{j}\right).\)</span></p>
<p><span class="math display">\[
\begin{align}
\boldsymbol{d} &amp;= \boldsymbol{\theta}_{\boldsymbol{\xi}} -
\boldsymbol{W} \boldsymbol{\theta}_{\boldsymbol{\xi}\backslash\xi_{j}}
\\
               &amp;= \boldsymbol{\theta}_{\boldsymbol{\xi}} -
\boldsymbol{W}
\left(\boldsymbol{W}^{T}\boldsymbol{W}\right)^{-1}\boldsymbol{W}^{T}        \boldsymbol{\theta}_{\boldsymbol{\xi}}
\\
               &amp;= \left(\boldsymbol{I}                   -
\boldsymbol{W}
\left(\boldsymbol{W}^{T}\boldsymbol{W}\right)^{-1}\boldsymbol{W}^{T}\right)
\boldsymbol{\theta}_{\boldsymbol{\xi}} \\
\end{align}
\]</span></p>
<p>Finally, we define the influence of <span class="math inline">\(\xi_j\)</span> on <span class="math inline">\(CP_{k,\boldsymbol{\xi},\boldsymbol{\theta}_{\boldsymbol{\xi}}}\)</span>
as <span class="math display">\[ w_j = \left\lVert \boldsymbol{d}
\right\rVert_{2}^{2}. \]</span></p>
<p>The influence of knots on the spline used in the above section.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="va">cp0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">##   j iknot  influence influence_rank</span></span>
<span><span class="co">## 1 5   1.0 1.64661178              5</span></span>
<span><span class="co">## 2 6   1.5 0.29066719              2</span></span>
<span><span class="co">## 3 7   2.3 0.31205029              3</span></span>
<span><span class="co">## 4 8   4.0 0.07702981              1</span></span>
<span><span class="co">## 5 9   4.5 0.41987740              4</span></span></code></pre></div>
<p>Let’s look at the following plots to explore the influence of <span class="math inline">\(\xi_{7}\)</span> (the third interior knot in a
<span class="math inline">\(k=4\)</span> order spline) on the spline. In
panel (a) we see the original control polygon and spline along with the
coarsened control polygon and spline. Note that the there are fewer
control points, and the spline deviates from the original. In panel (b)
we see that the restored control polygon is the result of inserting
<span class="math inline">\(\xi_7\)</span> into the coarsened control
polygon of panel (a). These plots are also a good example of the local
support and strong convexity of the control polygons as there are only
<span class="math inline">\(k + 1 = 5\)</span> control points which are
impacted by the removal and re-insertion of <span class="math inline">\(\xi_7.\)</span> Lastly, in panel (c) we see all
three control polygons plotted together.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>  <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, j <span class="op">=</span> <span class="fl">3</span>, coarsened <span class="op">=</span> <span class="cn">TRUE</span>, restored <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>    , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, j <span class="op">=</span> <span class="fl">3</span>, coarsened <span class="op">=</span> <span class="cn">FALSE</span>, restored <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>    , labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(a)"</span>, <span class="st">"(b)"</span><span class="op">)</span></span>
<span>    , nrow <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span>  , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, j <span class="op">=</span> <span class="fl">3</span>, coarsened <span class="op">=</span> <span class="cn">TRUE</span>, restored <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span>  , labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"(c)"</span><span class="op">)</span></span>
<span>  , nrow <span class="op">=</span> <span class="fl">2</span></span>
<span>  , ncol <span class="op">=</span> <span class="fl">1</span></span>
<span>  , heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>Next, consider the influence of <span class="math inline">\(\xi_8,\)</span> the fourth interior knot. By the
influence metric defined above, this is the least influential knot in
the sequence. This can be seen easily as the spline between the original
and the coarsened spline are very similar, this is despite the apparent
large difference in the magnitude of the control point ordinates between
the original and coarsened control polygons. However, when re-inserting
<span class="math inline">\(\xi_8\)</span> the recovered control polygon
is very similar to the original, hence the low influence of <span class="math inline">\(\xi_8.\)</span></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>  <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, j <span class="op">=</span> <span class="fl">4</span>, coarsened <span class="op">=</span> <span class="cn">TRUE</span>, restored <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>    , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, j <span class="op">=</span> <span class="fl">4</span>, coarsened <span class="op">=</span> <span class="cn">FALSE</span>, restored <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>    , labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(a)"</span>, <span class="st">"(b)"</span><span class="op">)</span></span>
<span>    , nrow <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span>  , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, j <span class="op">=</span> <span class="fl">4</span>, coarsened <span class="op">=</span> <span class="cn">TRUE</span>, restored <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span>  , labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"(c)"</span><span class="op">)</span></span>
<span>  , nrow <span class="op">=</span> <span class="fl">2</span></span>
<span>  , ncol <span class="op">=</span> <span class="fl">1</span></span>
<span>  , heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>If you were required to omit an internal knot, it would be preferable
to omit <span class="math inline">\(\xi_8\)</span> over <span class="math inline">\(\xi_5, \xi_6, \xi_7,\)</span> or <span class="math inline">\(\xi_9\)</span> as that will have the least impact
on the spline approximation of the original functional form.</p>
</div>
</div>
<div class="section level2">
<h2 id="fitting-b-splines-to-noisy-data">Fitting B-splines to noisy data<a class="anchor" aria-label="anchor" href="#fitting-b-splines-to-noisy-data"></a>
</h2>
<p>Start with the spline we have been using and add some noise to
it.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5.99999</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">bmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2.3</span>, <span class="fl">4</span>, <span class="fl">4.5</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3.5</span>, <span class="fl">4.2</span>, <span class="fl">3.7</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.7</span>, <span class="fl">2</span>, <span class="fl">1.5</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">DF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, truth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bmat</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">DF</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bmat</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bmat</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">original_data_ggplot_layers</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">DF</span></span>
<span>                        , mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span>                        , inherit.aes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>                        , color <span class="op">=</span> <span class="st">"#6F263D"</span></span>
<span>                        , alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span>    ,</span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">DF</span></span>
<span>                       , mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">truth</span><span class="op">)</span></span>
<span>                       , inherit.aes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>                       , color <span class="op">=</span> <span class="st">"#6F263D"</span></span>
<span>                       , alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">DF</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="va">original_data_ggplot_layers</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>To fit a spline and control polygon to the noisy data use a formula
statement in the <code>cp</code> call. In this example we will use the
known internal knots and add one extra.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_cp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2.3</span>, <span class="fl">3.0</span>, <span class="fl">4</span>, <span class="fl">4.5</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span>     , data <span class="op">=</span> <span class="va">DF</span></span>
<span>     , keep_fit <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># default is FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">initial_cp</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="va">original_data_ggplot_layers</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>The plot above shows the fitted spline is does well at approximating
the true spline function. Just to make it perfectly clear, the
regression coefficients are the estimates of the ordinates for the
control polygon:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_cp</span><span class="op">$</span><span class="va">fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##  [1]  1.0032390  0.6730762  3.0035459  4.4136192  3.5386419  1.7539897</span></span>
<span><span class="co">##  [7] -0.4708520 -0.7312097  2.1631310  1.3575369</span></span>
<span><span class="va">initial_cp</span><span class="op">$</span><span class="va">cp</span><span class="op">$</span><span class="va">theta</span></span>
<span><span class="co">##  [1]  1.0032390  0.6730762  3.0035459  4.4136192  3.5386419  1.7539897</span></span>
<span><span class="co">##  [7] -0.4708520 -0.7312097  2.1631310  1.3575369</span></span></code></pre></div>
<p>Let’s now look at the influence of the internal knots on the fit</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="va">initial_cp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##    j iknot  influence influence_rank     chisq chisq_rank   p_value os_p_value</span></span>
<span><span class="co">## 1  5   1.0 0.16235075              5 0.9100724          5 0.3400952 0.66205444</span></span>
<span><span class="co">## 2  6   1.5 0.05785223              3 0.4331666          2 0.5104392 0.11947108</span></span>
<span><span class="co">## 3  7   2.3 0.05128404              2 0.5061398          3 0.4768147 0.30134562</span></span>
<span><span class="co">## 4  8   3.0 0.08264093              4 0.8363492          4 0.3604430 0.37410640</span></span>
<span><span class="co">## 5  9   4.0 0.02585915              1 0.2230694          1 0.6367111 0.06662766</span></span>
<span><span class="co">## 6 10   4.5 0.39575696              6 2.6821030          6 0.1014816 0.47378677</span></span></code></pre></div>
<p>The least influential knot is <span class="math inline">\(\xi_8 =
3.0,\)</span> the extra knot inserted. Good, we this is the expected
result.</p>
<p>How would someone determine if the influence was significant? That
is, how can we test the null hypothesis <span class="math display">\[H_0: w_{j} = 0\]</span></p>
<p>Under the null hypothesis that the knot has zero influence and under
standard ordinary least squares regression assumptions the regression
coefficients, (the ordinates of the control polygon are the regression
coefficients), are realisations of a Gaussian random variable. Then</p>
<p><span class="math display">\[
w_j =
\left(\left(\boldsymbol{I} -
\boldsymbol{H}\right)\hat{\boldsymbol{\theta}} \right)^{T}
\left[
  \left(\left(\boldsymbol{I} -
\boldsymbol{H}\right)\hat{\boldsymbol{\theta}} \right)
  \boldsymbol{\Sigma}
  \left(\left(\boldsymbol{I} -
\boldsymbol{H}\right)\hat{\boldsymbol{\theta}} \right)^{T}
\right]^{+}
\left(\left(\boldsymbol{I} -
\boldsymbol{H}\right)\hat{\boldsymbol{\theta}} \right)
\]</span> where <span class="math inline">\(\boldsymbol{H} = W
(W^{T}W)^{-1} W^{T},\)</span> <span class="math inline">\(\boldsymbol{\Sigma}\)</span> is the
variance-covariance matrix for the regression coefficients, and <span class="math inline">\(+\)</span> denotes the Moore-Penrose inverse of
the matrix. By construction, <span class="math inline">\(\left(\left(\boldsymbol{I} -
\boldsymbol{H}\right)\hat{\boldsymbol{\theta}} \right)
\boldsymbol{\Sigma} \left(\left(\boldsymbol{I} -
\boldsymbol{H}\right)\hat{\boldsymbol{\theta}} \right)^{T}\)</span> is
singular and thus the standard inverse does not exist and a generalized
inverse is necessary. This yields the test statistic following a
chi-square distribution with one degree of freedom, <span class="math display">\[ w_j \sim \chi_{1}^{2}.\]</span></p>
<p>Now, if we are interested in removing the knot with the lowest
influence we are interested in the minimum. So the hypothesis test we
are actually interested in is <span class="math display">\[ H_0: w_{(1)}
= 0 \]</span> which follows the distribution <span class="math display">\[ \Pr \left[ w_{(1)} &gt; w \right] = \sum_{j =
1}^{k+l} \binom{n+l}{j}
\left(F_{\chi_{1}^{2}}\left(w\right)\right)^{j} \left( 1 -
F_{\chi_{1}^{2}}\left(w\right) \right)^{k+l-j}\]</span> where <span class="math inline">\(F_{\chi_{1}^{2}}\left(w\right)\)</span> is the
distribution function of the chi-square distribution with one degree of
freedom.</p>
<p>The results generated by calling <code>influence_of_iknots</code>.
report two sets of p-values. The first is the p-value is the probability
of observed chisq value greater than reported, and the second p-value is
the probability of the rank order statistic exceeding the observed
value.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="3%">
<col width="7%">
<col width="12%">
<col width="18%">
<col width="12%">
<col width="13%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">j</th>
<th align="right">iknot</th>
<th align="right">influence</th>
<th align="right">influence_rank</th>
<th align="right">chisq</th>
<th align="right">chisq_rank</th>
<th align="right">p_value</th>
<th align="right">os_p_value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">5</td>
<td align="right">1.0</td>
<td align="right">0.1623508</td>
<td align="right">5</td>
<td align="right">0.9100724</td>
<td align="right">5</td>
<td align="right">0.3400952</td>
<td align="right">0.6620544</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">6</td>
<td align="right">1.5</td>
<td align="right">0.0578522</td>
<td align="right">3</td>
<td align="right">0.4331666</td>
<td align="right">2</td>
<td align="right">0.5104392</td>
<td align="right">0.1194711</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">7</td>
<td align="right">2.3</td>
<td align="right">0.0512840</td>
<td align="right">2</td>
<td align="right">0.5061398</td>
<td align="right">3</td>
<td align="right">0.4768147</td>
<td align="right">0.3013456</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">8</td>
<td align="right">3.0</td>
<td align="right">0.0826409</td>
<td align="right">4</td>
<td align="right">0.8363492</td>
<td align="right">4</td>
<td align="right">0.3604430</td>
<td align="right">0.3741064</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">9</td>
<td align="right">4.0</td>
<td align="right">0.0258592</td>
<td align="right">1</td>
<td align="right">0.2230694</td>
<td align="right">1</td>
<td align="right">0.6367111</td>
<td align="right">0.0666277</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="right">10</td>
<td align="right">4.5</td>
<td align="right">0.3957570</td>
<td align="right">6</td>
<td align="right">2.6821030</td>
<td align="right">6</td>
<td align="right">0.1014816</td>
<td align="right">0.4737868</td>
</tr>
</tbody>
</table>
<p>It is worth remembering how fraught binary classification of
statistical (non)significance can be. Just because the p-value is low
does not mean that the knot is influential, just as a high p-value dose
not mean that the knot is not influential. Sample size, over-fitting,
and other factors can/will lead to poor selection of a model if you only
consider these p-values.</p>
<p>That said, consider <span class="math inline">\(\xi_9 = 4.0\)</span>
which has the lowest influence weight. Let’s omit that knot and refit
the model.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_reduction_cp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2.3</span>, <span class="fl">3</span>, <span class="fl">4.5</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="va">first_reduction_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="3%">
<col width="7%">
<col width="12%">
<col width="18%">
<col width="13%">
<col width="13%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">j</th>
<th align="right">iknot</th>
<th align="right">influence</th>
<th align="right">influence_rank</th>
<th align="right">chisq</th>
<th align="right">chisq_rank</th>
<th align="right">p_value</th>
<th align="right">os_p_value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">5</td>
<td align="right">1.0</td>
<td align="right">0.1957262</td>
<td align="right">4</td>
<td align="right">1.1517249</td>
<td align="right">4</td>
<td align="right">0.2831884</td>
<td align="right">0.4369320</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">6</td>
<td align="right">1.5</td>
<td align="right">0.0345902</td>
<td align="right">2</td>
<td align="right">0.2881794</td>
<td align="right">1</td>
<td align="right">0.5913896</td>
<td align="right">0.0723383</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">7</td>
<td align="right">2.3</td>
<td align="right">0.0238548</td>
<td align="right">1</td>
<td align="right">0.2900566</td>
<td align="right">2</td>
<td align="right">0.5901843</td>
<td align="right">0.3202087</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">8</td>
<td align="right">3.0</td>
<td align="right">0.0782231</td>
<td align="right">3</td>
<td align="right">0.8844555</td>
<td align="right">3</td>
<td align="right">0.3469842</td>
<td align="right">0.2305056</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">9</td>
<td align="right">4.5</td>
<td align="right">5.9074903</td>
<td align="right">5</td>
<td align="right">46.2296402</td>
<td align="right">5</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
<p>After omitting one knot and refitting the model we see that <span class="math inline">\(\xi = 2.3\)</span> is the least influential. Just
for fun, let’s omit that knot, and refit. Let’s continue that process
all the way down to zero knots.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">second_reduction_cp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">4.5</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="va">second_reduction_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="3%">
<col width="7%">
<col width="12%">
<col width="18%">
<col width="13%">
<col width="13%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">j</th>
<th align="right">iknot</th>
<th align="right">influence</th>
<th align="right">influence_rank</th>
<th align="right">chisq</th>
<th align="right">chisq_rank</th>
<th align="right">p_value</th>
<th align="right">os_p_value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">5</td>
<td align="right">1.0</td>
<td align="right">0.4805752</td>
<td align="right">3</td>
<td align="right">3.8031184</td>
<td align="right">3</td>
<td align="right">0.0511572</td>
<td align="right">0.0146519</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">6</td>
<td align="right">1.5</td>
<td align="right">0.0019515</td>
<td align="right">1</td>
<td align="right">0.0186252</td>
<td align="right">1</td>
<td align="right">0.8914463</td>
<td align="right">0.6315108</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">7</td>
<td align="right">3.0</td>
<td align="right">0.1381508</td>
<td align="right">2</td>
<td align="right">1.3834860</td>
<td align="right">2</td>
<td align="right">0.2395083</td>
<td align="right">0.0450848</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">8</td>
<td align="right">4.5</td>
<td align="right">6.2382229</td>
<td align="right">4</td>
<td align="right">59.9559534</td>
<td align="right">4</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
<p>The least influential knot in the second reduction is <span class="math inline">\(\xi = 1.5\)</span> and that will be omited for the
third reduction.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">third_reduction_cp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4.5</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="va">third_reduction_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="3%">
<col width="7%">
<col width="12%">
<col width="18%">
<col width="12%">
<col width="13%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">j</th>
<th align="right">iknot</th>
<th align="right">influence</th>
<th align="right">influence_rank</th>
<th align="right">chisq</th>
<th align="right">chisq_rank</th>
<th align="right">p_value</th>
<th align="right">os_p_value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">5</td>
<td align="right">1.0</td>
<td align="right">3.0669773</td>
<td align="right">2</td>
<td align="right">41.672311</td>
<td align="right">2</td>
<td align="right">0.0000000</td>
<td align="right">0.00e+00</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">6</td>
<td align="right">3.0</td>
<td align="right">0.4304104</td>
<td align="right">1</td>
<td align="right">3.986697</td>
<td align="right">1</td>
<td align="right">0.0458609</td>
<td align="right">9.65e-05</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">7</td>
<td align="right">4.5</td>
<td align="right">6.6872293</td>
<td align="right">3</td>
<td align="right">73.937519</td>
<td align="right">3</td>
<td align="right">0.0000000</td>
<td align="right">0.00e+00</td>
</tr>
</tbody>
</table>
<p>Within the third reduction, the least influential knot is <span class="math inline">\(\xi = 3.0\)</span> and that knot will be omitted
for the fourth reduction.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fourth_reduction_cp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4.5</span><span class="op">)</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="va">fourth_reduction_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="3%">
<col width="7%">
<col width="13%">
<col width="19%">
<col width="11%">
<col width="14%">
<col width="10%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">j</th>
<th align="right">iknot</th>
<th align="right">influence</th>
<th align="right">influence_rank</th>
<th align="right">chisq</th>
<th align="right">chisq_rank</th>
<th align="right">p_value</th>
<th align="right">os_p_value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">5</td>
<td align="right">1.0</td>
<td align="right">5.952998</td>
<td align="right">1</td>
<td align="right">107.2956</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">6</td>
<td align="right">4.5</td>
<td align="right">9.517375</td>
<td align="right">2</td>
<td align="right">142.2148</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Of the two remaining internal knots, <span class="math inline">\(\xi
- 1.0\)</span> is the least influential and will be omitted for the
fifth reduciton.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fifth_reduction_cp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, iknots <span class="op">=</span> <span class="fl">4.5</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="va">fifth_reduction_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="3%">
<col width="7%">
<col width="13%">
<col width="19%">
<col width="11%">
<col width="14%">
<col width="10%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">j</th>
<th align="right">iknot</th>
<th align="right">influence</th>
<th align="right">influence_rank</th>
<th align="right">chisq</th>
<th align="right">chisq_rank</th>
<th align="right">p_value</th>
<th align="right">os_p_value</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">1</td>
<td align="right">5</td>
<td align="right">4.5</td>
<td align="right">4.103958</td>
<td align="right">1</td>
<td align="right">31.66441</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr></tbody>
</table>
<p>Only one knot can be omitted from the fifth to the sixth reduciton.
Having the sixth reduction, where there are zero internal knots, lets us
compare model fits to a model with just a <span class="math inline">\(k=4\)</span> order polynomial.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sixth_reduction_cp</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span><span class="va">sixth_reduction_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/influence_of_iknots.html">influence_of_iknots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## no internal knots</span></span></code></pre></div>
<p>Let’s compare all the fits. We will start by looking at the control
polygons and splines.</p>
<p><img src="cpr_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
<p>The control polygons, panel (a), we see that the sixth, fifth, and
fourth reductions are different from the initial, first, second, and
third reductions, and for the splines, the fifth and sixth reductions
are easily identified as different.</p>
<p>Next, the graphic below will let us compare these models to the
truth, and the observed data.</p>
<p><img src="cpr_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>The dashed black line is the spline fitted to the data (light
burgundy dots) and the true value of the target function is the burgundy
line. In the fifth reduction there is an easily noticeable difference
between the fitted spline and the target function. Between the initial
control polygon and the first three reductions it is difficult to
visually discern any meaningful difference between the fits.</p>
<p>Thus, I would argue that the third reduction is the preferable model
as it has the fewest degrees of freedom while providing a good quality
of fit. This conclusion is supported by looking at the residual standard
error (rse) <span class="math display">\[ rse = \sqrt{ \frac{1}{df}
\sum_{i=1}^{n} \left(y_i - f\left(x_i\right)\right)^2 },\]</span> where
the degrees of freedom, <span class="math inline">\(df,\)</span> is the
sample size <span class="math inline">\(n\)</span> minus the number of
regression paramters.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>  <span class="va">initial_cp</span> , <span class="va">first_reduction_cp</span> , <span class="va">second_reduction_cp</span> , <span class="va">third_reduction_cp</span></span>
<span>     , <span class="va">fourth_reduction_cp</span> , <span class="va">fifth_reduction_cp</span> , <span class="va">sixth_reduction_cp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span>what <span class="op">=</span> <span class="va">rbind</span>, args <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>reduction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">0</span>, by <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="4%">
<col width="10%">
<col width="15%">
<col width="11%">
<col width="11%">
<col width="11%">
<col width="11%">
<col width="5%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">dfs</th>
<th align="right">n_iknots</th>
<th align="left">iknots</th>
<th align="right">loglik</th>
<th align="right">rss</th>
<th align="right">rse</th>
<th align="right">wiggle</th>
<th align="right">fdsc</th>
<th align="right">reduction</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="left"></td>
<td align="right">-74.52286</td>
<td align="right">25.991002</td>
<td align="right">0.5203264</td>
<td align="right">46.86602</td>
<td align="right">2</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="left">4.5</td>
<td align="right">-60.13965</td>
<td align="right">19.493599</td>
<td align="right">0.4529854</td>
<td align="right">46.12997</td>
<td align="right">2</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">6</td>
<td align="right">2</td>
<td align="left">1, 4.5</td>
<td align="right">-22.06566</td>
<td align="right">9.103022</td>
<td align="right">0.3111923</td>
<td align="right">113.09010</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">7</td>
<td align="right">3</td>
<td align="left">1, 3, 4.5</td>
<td align="right">-19.96695</td>
<td align="right">8.728836</td>
<td align="right">0.3063633</td>
<td align="right">99.30959</td>
<td align="right">4</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">8</td>
<td align="right">4</td>
<td align="left">1, 1.5, ….</td>
<td align="right">-19.95683</td>
<td align="right">8.727070</td>
<td align="right">0.3079926</td>
<td align="right">95.81790</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="right">9</td>
<td align="right">5</td>
<td align="left">1, 1.5, ….</td>
<td align="right">-19.79771</td>
<td align="right">8.699341</td>
<td align="right">0.3091879</td>
<td align="right">92.04602</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="right">10</td>
<td align="right">6</td>
<td align="left">1, 1.5, ….</td>
<td align="right">-19.67393</td>
<td align="right">8.677833</td>
<td align="right">0.3105163</td>
<td align="right">87.38456</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The <code>wiggle</code> is one measure of wiggliness defined as <span class="math display">\[
\int_{\min\left(\boldsymbol{\xi}\right)}^{\max\left(\boldsymbol{\xi}\right)}
\left( \frac{d^2}{dx^2} f\left(x\right) \right)^2 dx.
\]</span> <code>fdsc</code> reports the number of times the first
derivative has a sign change.</p>
</div>
<div class="section level2">
<h2 id="control-polygon-reduction">Control Polygon Reduction<a class="anchor" aria-label="anchor" href="#control-polygon-reduction"></a>
</h2>
<p>The exercise above of manually identifying and omitting the knot with
the smallest influence in each model would be tedious when working with
a large set of initial knots. Fortunately, the process has been
automated. Calling <code>cpr</code> on a <code>cpr_cp</code> object
defined by a function will automatically omit the internal knot with the
lowest influence.</p>
<div class="section level3">
<h3 id="example-with-known-knots">Example with known knots<a class="anchor" aria-label="anchor" href="#example-with-known-knots"></a>
</h3>
<p>Apply CPR to the <code>initial_cp</code> from the above example.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cpr0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cpr.html">cpr</a></span><span class="op">(</span><span class="va">initial_cp</span><span class="op">)</span></span>
<span><span class="va">cpr0</span></span>
<span><span class="co">## A list of control polygons</span></span>
<span><span class="co">## List of 7</span></span>
<span><span class="co">##  - attr(*, "class")= chr [1:2] "cpr_cpr" "list"</span></span></code></pre></div>
<p>There are 7 elements of the <code>cpr_cpr</code> object,
<code>length(initial_cp$iknots) + 1</code>. The indexing is set such at
that the <span class="math inline">\(i^{th}\)</span> element has <span class="math inline">\(i-1\)</span> internal knots.</p>
<p>Before exploring the results, let’s just verify that the results of
the call to <code>cpr</code> are the same as the manual results found
about. There are some differences in the metadata of the objects, but
the important parts, like the control polygons, are the same.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">cpr0</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"cp"</span><span class="op">]</span><span class="op">]</span>,  <span class="va">initial_cp</span><span class="op">[[</span><span class="st">"cp"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span>
<span></span>
<span><span class="co"># some attributes are different with the last cp due to how the automation</span></span>
<span><span class="co"># creates the call vs how the call was created manually.</span></span>
<span><span class="va">call_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cpr0</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="st">"call"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">cpr0</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span>, <span class="va">first_reduction_cp</span> <span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">cpr0</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span>, <span class="va">second_reduction_cp</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">cpr0</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span>, <span class="va">third_reduction_cp</span> <span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">cpr0</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span>, <span class="va">fourth_reduction_cp</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">cpr0</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span>, <span class="va">fifth_reduction_cp</span> <span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="va">cpr0</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span>, <span class="va">sixth_reduction_cp</span> <span class="op">[</span><span class="op">-</span><span class="va">call_idx</span><span class="op">]</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre></div>
<p>In the manual process we identified <code>third_reduction_cp</code>
as the preferable model. For the <code>cpr0</code> object we can quickly
see a similar result as we did for the manual process.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cpr0</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="2%">
<col width="3%">
<col width="8%">
<col width="12%">
<col width="9%">
<col width="9%">
<col width="9%">
<col width="9%">
<col width="4%">
<col width="10%">
<col width="12%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">dfs</th>
<th align="right">n_iknots</th>
<th align="left">iknots</th>
<th align="right">loglik</th>
<th align="right">rss</th>
<th align="right">rse</th>
<th align="right">wiggle</th>
<th align="right">fdsc</th>
<th align="right">Pr(&gt;w_(1))</th>
<th align="right">loglik_elbow</th>
<th align="right">rse_elbow</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="left"></td>
<td align="right">-74.52286</td>
<td align="right">25.991002</td>
<td align="right">0.5203264</td>
<td align="right">46.86602</td>
<td align="right">2</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="left">4.5</td>
<td align="right">-60.13965</td>
<td align="right">19.493599</td>
<td align="right">0.4529854</td>
<td align="right">46.12997</td>
<td align="right">2</td>
<td align="right">0.0000000</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">6</td>
<td align="right">2</td>
<td align="left">1, 4.5</td>
<td align="right">-22.06566</td>
<td align="right">9.103022</td>
<td align="right">0.3111923</td>
<td align="right">113.09010</td>
<td align="right">4</td>
<td align="right">0.0000000</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">7</td>
<td align="right">3</td>
<td align="left">1, 3, 4.5</td>
<td align="right">-19.96695</td>
<td align="right">8.728836</td>
<td align="right">0.3063633</td>
<td align="right">99.30959</td>
<td align="right">4</td>
<td align="right">0.0000965</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">8</td>
<td align="right">4</td>
<td align="left">1, 1.5, ….</td>
<td align="right">-19.95683</td>
<td align="right">8.727070</td>
<td align="right">0.3079926</td>
<td align="right">95.81790</td>
<td align="right">4</td>
<td align="right">0.6315108</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="right">9</td>
<td align="right">5</td>
<td align="left">1, 1.5, ….</td>
<td align="right">-19.79771</td>
<td align="right">8.699341</td>
<td align="right">0.3091879</td>
<td align="right">92.04602</td>
<td align="right">4</td>
<td align="right">0.0723383</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="right">10</td>
<td align="right">6</td>
<td align="left">1, 1.5, ….</td>
<td align="right">-19.67393</td>
<td align="right">8.677833</td>
<td align="right">0.3105163</td>
<td align="right">87.38456</td>
<td align="right">4</td>
<td align="right">0.0666277</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The additional columns in this summary, <code>loglik_elbow</code> and
<code>rse_elbow</code>, indicate a location in the plot for either the
loglik or rse by model index (degrees of freedom) where the trade-off
between additional degrees of freedom and improvement in the fix
statistic is negligible. See plot below. This is determined by finding
the breakpoint such that a continuous, but not differentiable at
breakpoint, quadratic spline fits the plot with minimal residual
standard error.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr0</span>, type <span class="op">=</span> <span class="st">"cps"</span>, color <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr0</span>, type <span class="op">=</span> <span class="st">"cps"</span>, show_cp <span class="op">=</span> <span class="cn">FALSE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr0</span>, type <span class="op">=</span> <span class="st">"loglik"</span><span class="op">)</span></span>
<span>  , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr0</span>, type <span class="op">=</span> <span class="st">"rse"</span><span class="op">)</span></span>
<span>  , ncol <span class="op">=</span><span class="fl">2</span></span>
<span>  , nrow <span class="op">=</span> <span class="fl">2</span></span>
<span>  , common.legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-27-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="example-when-knots-are-unknown">Example when knots are unknown<a class="anchor" aria-label="anchor" href="#example-when-knots-are-unknown"></a>
</h3>
<p>In practice it is be extremely unlikely to know where knots should be
placed. Analytic solutions are difficult, if not impossible to derive
<span class="citation">(Jupp 1978)</span>. However, an optimal solution
may not be necessary.</p>
<p>From <span class="citation">de Boor (2001)</span> (page 106) <quote>
“…a B-spline doesn’t change much if one changes its <span class="math inline">\(k+1\)</span> knots a little bit. Therefore, if one
has multiple knots, then it is very easy to find B-spline almost like
with simple knots: Simply replace knot of multiplicity <span class="math inline">\(r &gt; 1\)</span> by <span class="math inline">\(r\)</span> simple knots nearby.” </quote></p>
<p>That is,</p>
<p><span class="math display">\[
  \boldsymbol{B}_{k, \boldsymbol{\xi}}\left(x\right)
\boldsymbol{\theta}_{\boldsymbol{\xi}} \approx
  \boldsymbol{B}_{k, \boldsymbol{\xi'}}\left(x\right)
\boldsymbol{\theta}_{\boldsymbol{\xi'}}
\]</span> where <span class="math display">\[
\left\lvert \xi_j - \xi_j' \right\rvert &lt; \delta \quad \text{for
small} \quad \delta &gt; 0.
\]</span></p>
<p>So, in the case when we are looking for a good set of knots (a good
set of knots should be parsimonious, and provide a good model fit) we
start with an initial knot sequence with a high cardinality, this is not
without precedent <span class="citation">Eilers and Marx (2010)</span>.
We then apply the CPR algorithm to find a good set of knots.</p>
<p>For example we will use 50 internal knots. Not surprisingly we have a
fit that is more “connect-the-dots” than a smooth fit.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_cp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cp.html">cp</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/bsplines.html">bsplines</a></span><span class="op">(</span><span class="va">x</span>, df <span class="op">=</span> <span class="fl">54</span>, bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">DF</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">initial_cp</span>, show_cp <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="va">original_data_ggplot_layers</span></span>
<span>  ,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">initial_cp</span>, show_cp <span class="op">=</span> <span class="cn">FALSE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="va">original_data_ggplot_layers</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-28-1.png" width="672"></p>
<p>Apply CPR to the <code>initial_cp</code> and look at the summary.
Only the first 10 of 51 rows are provided here.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cpr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cpr.html">cpr</a></span><span class="op">(</span><span class="va">initial_cp</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cpr1</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="3%">
<col width="8%">
<col width="12%">
<col width="9%">
<col width="9%">
<col width="9%">
<col width="10%">
<col width="4%">
<col width="10%">
<col width="12%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="right">dfs</th>
<th align="right">n_iknots</th>
<th align="left">iknots</th>
<th align="right">loglik</th>
<th align="right">rss</th>
<th align="right">rse</th>
<th align="right">wiggle</th>
<th align="right">fdsc</th>
<th align="right">Pr(&gt;w_(1))</th>
<th align="right">loglik_elbow</th>
<th align="right">rse_elbow</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">4</td>
<td align="right">0</td>
<td align="left"></td>
<td align="right">-74.52286</td>
<td align="right">25.991002</td>
<td align="right">0.5203264</td>
<td align="right">46.86602</td>
<td align="right">2</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">1</td>
<td align="left">4.440871….</td>
<td align="right">-60.80852</td>
<td align="right">19.756126</td>
<td align="right">0.4560255</td>
<td align="right">44.96627</td>
<td align="right">2</td>
<td align="right">0.0000000</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="right">2</td>
<td align="left">0.752226….</td>
<td align="right">-26.01135</td>
<td align="right">9.850479</td>
<td align="right">0.3237164</td>
<td align="right">246.23540</td>
<td align="right">4</td>
<td align="right">0.0000000</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">3</td>
<td align="left">0.636956….</td>
<td align="right">-24.77752</td>
<td align="right">9.610379</td>
<td align="right">0.3214614</td>
<td align="right">104.90530</td>
<td align="right">4</td>
<td align="right">0.0020696</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">4</td>
<td align="left">0.636956….</td>
<td align="right">-19.81416</td>
<td align="right">8.702204</td>
<td align="right">0.3075535</td>
<td align="right">639.20789</td>
<td align="right">4</td>
<td align="right">0.0000000</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="right">5</td>
<td align="left">0.521686….</td>
<td align="right">-19.38824</td>
<td align="right">8.628390</td>
<td align="right">0.3079245</td>
<td align="right">774.74506</td>
<td align="right">6</td>
<td align="right">0.0076769</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">6</td>
<td align="left">0.175876….</td>
<td align="right">-18.77810</td>
<td align="right">8.523739</td>
<td align="right">0.3077470</td>
<td align="right">3232.38887</td>
<td align="right">6</td>
<td align="right">0.0006350</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="right">7</td>
<td align="left">0.175876….</td>
<td align="right">-18.72815</td>
<td align="right">8.515228</td>
<td align="right">0.3093165</td>
<td align="right">4256.85750</td>
<td align="right">6</td>
<td align="right">0.1540572</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">12</td>
<td align="right">8</td>
<td align="left">0.175876….</td>
<td align="right">-18.22634</td>
<td align="right">8.430195</td>
<td align="right">0.3095120</td>
<td align="right">9158.80131</td>
<td align="right">8</td>
<td align="right">0.0002060</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">13</td>
<td align="right">9</td>
<td align="left">0.175876….</td>
<td align="right">-18.22608</td>
<td align="right">8.430151</td>
<td align="right">0.3112849</td>
<td align="right">9215.39496</td>
<td align="right">8</td>
<td align="right">0.8567697</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>From this, the preferable model is suggested to be index 5, the model
with four internal knots. Inspection of the rse by index plot, I would
argue from a manual selection that index 5 is preferable overall.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr1</span>, type <span class="op">=</span> <span class="st">"rse"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
<p>Let’s compare the models in indices 3, 4, and 5.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr1</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">cpr1</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, <span class="va">cpr1</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>, show_cp <span class="op">=</span> <span class="cn">TRUE</span>, show_spline <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  ,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr1</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">cpr1</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, <span class="va">cpr1</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>, show_cp <span class="op">=</span> <span class="cn">FALSE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  ,</span>
<span>  common.legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-31-1.png" width="672"></p>
<p>The noticeable differences are, for the most part, located on the
left side of the support between between 0 and 1. For the fifth index,
there is change in convexity of the spline. Knowing that the models at
index 3 and 4 are good fits too, then it would be easy not select index
5 due to extra “wiggle” in the spline.</p>
<p>In practice I would likely pick the model in index 4 to have a smooth
(small wiggle) and low rse. Compare the selected model to the original
data.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr1</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, show_cp <span class="op">=</span> <span class="cn">FALSE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Model Index 3"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">original_data_ggplot_layers</span></span>
<span>  , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr1</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, show_cp <span class="op">=</span> <span class="cn">FALSE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Model Index 4"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">original_data_ggplot_layers</span></span>
<span>  , <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpr1</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>, show_cp <span class="op">=</span> <span class="cn">FALSE</span>, show_spline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Model Index 5"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">original_data_ggplot_layers</span></span>
<span>  , nrow <span class="op">=</span> <span class="fl">1</span></span>
<span>  , legend <span class="op">=</span> <span class="st">"none"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="cpr_files/figure-html/unnamed-chunk-32-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="extensions-to-higher-dimensions">Extensions to higher dimensions<a class="anchor" aria-label="anchor" href="#extensions-to-higher-dimensions"></a>
</h2>
<p>CPR works for uni-variable B-splines. By taking tensor products of
B-splines, and building a control-net, the higher-dimensional analog of
a control polygon, we can apply similar methods to estimate a surface.
Details on the Control Net Reduction method are presented in</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="st">"cnr"</span>, package <span class="op">=</span> <span class="st">"cpr"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-boehm1980" class="csl-entry">
Boehm, Wolfgang. 1980. <span>“Inserting New Knots into b-Spline
Curves.”</span> <em>Computer-Aided Design</em> 12 (4): 199–201.
</div>
<div id="ref-deboor2001" class="csl-entry">
de Boor, Carl. 2001. <em>A Practical Guide to Splines, Revised Edition,
Vol. 27 of Applied Mathematical Sciences</em>. Springer-Verlag, Berlin.
</div>
<div id="ref-eilers1996" class="csl-entry">
Eilers, Paul HC, and Brian D Marx. 1996. <span>“Flexible Smoothing with
b-Splines and Penalties.”</span> <em>Statistical Science</em>, 89–102.
</div>
<div id="ref-eilers2010" class="csl-entry">
———. 2010. <span>“Splines, Knots, and Penalties.”</span> <em>Wiley
Interdisciplinary Reviews: Computational Statistics</em> 2 (6): 637–53.
</div>
<div id="ref-jupp1978approximation" class="csl-entry">
Jupp, David LB. 1978. <span>“Approximation to Data by Splines with Free
Knots.”</span> <em>SIAM Journal on Numerical Analysis</em> 15 (2):
328–43.
</div>
<div id="ref-prautzsch2002" class="csl-entry">
Prautzsch, Hartmut, Wolfgang Boehm, and Marco Paluszny. 2002.
<em>B<span>é</span>zier and b-Spline Techniques</em>. Springer Science
&amp; Business Media.
</div>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## R version 4.3.2 (2023-10-31)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.3 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] cpr_0.3.0.9000 qwraps2_0.6.0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] gtable_0.3.4      xfun_0.41         bslib_0.6.1       ggplot2_3.4.4    </span></span>
<span><span class="co">##  [5] rstatix_0.7.2     lattice_0.21-9    vctrs_0.6.5       tools_4.3.2      </span></span>
<span><span class="co">##  [9] generics_0.1.3    tibble_3.2.1      fansi_1.0.6       highr_0.10       </span></span>
<span><span class="co">## [13] pkgconfig_2.0.3   Matrix_1.6-4      desc_1.4.3        lifecycle_1.0.4  </span></span>
<span><span class="co">## [17] compiler_4.3.2    farver_2.1.1      stringr_1.5.1     textshaping_0.3.7</span></span>
<span><span class="co">## [21] munsell_0.5.0     carData_3.0-5     htmltools_0.5.7   sass_0.4.8       </span></span>
<span><span class="co">## [25] yaml_2.3.8        pillar_1.9.0      pkgdown_2.0.7     car_3.1-2        </span></span>
<span><span class="co">## [29] ggpubr_0.6.0      nloptr_2.0.3      jquerylib_0.1.4   tidyr_1.3.0      </span></span>
<span><span class="co">## [33] MASS_7.3-60       cachem_1.0.8      boot_1.3-28.1     abind_1.4-5      </span></span>
<span><span class="co">## [37] nlme_3.1-163      tidyselect_1.2.0  digest_0.6.33     stringi_1.8.3    </span></span>
<span><span class="co">## [41] dplyr_1.1.4       purrr_1.0.2       labeling_0.4.3    splines_4.3.2    </span></span>
<span><span class="co">## [45] cowplot_1.1.1     fastmap_1.1.1     grid_4.3.2        colorspace_2.1-0 </span></span>
<span><span class="co">## [49] cli_3.6.2         magrittr_2.0.3    utf8_1.2.4        broom_1.0.5      </span></span>
<span><span class="co">## [53] withr_2.5.2       scales_1.3.0      backports_1.4.1   rmarkdown_2.25   </span></span>
<span><span class="co">## [57] lme4_1.1-35.1     gridExtra_2.3     ggsignif_0.6.4    ragg_1.2.7       </span></span>
<span><span class="co">## [61] memoise_2.0.1     evaluate_0.23     knitr_1.45        rlang_1.1.2      </span></span>
<span><span class="co">## [65] Rcpp_1.0.11       glue_1.6.2        minqa_1.2.6       jsonlite_1.8.8   </span></span>
<span><span class="co">## [69] R6_2.5.1          systemfonts_1.0.5 fs_1.6.3</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Peter DeWitt.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
