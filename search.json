[{"path":"http://www.peteredewitt.com/cpr/articles/cnr.html","id":"tensor-products-of-b-splines","dir":"Articles","previous_headings":"","what":"Tensor Products of B-Splines","title":"Tensor Products of B-Splines, Control Nets, and Control Net Reduction","text":"uni-variable functions B-splines: \\[\\begin{equation}   f \\left( x \\right) =   \\sum_{j} \\theta_j B_{j,k,\\boldsymbol{\\xi}}\\left(x\\right) =   \\boldsymbol{B}_{k, \\boldsymbol{\\xi}} \\left(x\\right) \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}}   \\label{eq:f} \\end{equation}\\] extend multi-variable \\(m\\)-dimensional B-spline function, built \\(m\\) B-spline basis matrices \\(\\boldsymbol{B}_{k_1, \\boldsymbol{\\xi}_1} \\left(x_1\\right),\\) \\(\\boldsymbol{B}_{k_2, \\boldsymbol{\\xi}_2} \\left(x_2\\right), \\ldots,\\) \\(\\boldsymbol{B}_{k_m, \\boldsymbol{\\xi}_m} \\left(x_m\\right),\\) \\[\\begin{equation}   f \\left( \\boldsymbol{X} \\right) =   \\mathscr{B}_{\\boldsymbol{K}, \\boldsymbol{\\Xi}} \\left( \\boldsymbol{X} \\right)   \\boldsymbol{\\theta}_{\\boldsymbol{\\Xi}} \\end{equation}\\] \\(\\boldsymbol{K} = \\left\\{k_1, k_2, \\ldots, k_m\\right\\},\\) denotes set polynomial orders, \\(\\boldsymbol{\\Xi} = \\left\\{ \\boldsymbol{\\xi}_1, \\boldsymbol{\\xi}_2, \\ldots, \\boldsymbol{\\xi}_m \\right\\}\\) set knot sequences, \\(\\boldsymbol{\\theta}_{\\boldsymbol{\\Xi}}\\) \\(\\prod_{= 1}^{m} \\left( \\left\\lvert \\boldsymbol{\\xi}_i \\right\\rvert - k_i \\right) \\times 1\\) column vector regression coefficients, \\(\\boldsymbol{X}\\) observed data: \\[\\begin{equation}   \\boldsymbol{X} = \\begin{pmatrix}     x_{11} & x_{21} & \\cdots & x_{m1} \\\\     x_{12} & x_{22} & \\cdots & x_{m2} \\\\     \\vdots & \\vdots & \\ddots & \\vdots \\\\     x_{12} & x_{22} & \\cdots & x_{mn}   \\end{pmatrix}. \\end{equation}\\] basis multi-variable B-splines constructed recursive algorithm. base case \\(m = 2\\) \\[\\begin{equation}   \\label{eq:tensor_product_base_case}   \\mathscr{B}_{ \\left\\{k_1, k_2\\right\\}, \\left\\{ \\boldsymbol{\\xi}_1,   \\boldsymbol{\\xi}_2 \\right\\}} \\left( \\boldsymbol{x}_1, \\boldsymbol{x}_2 \\right) =   \\left(\\boldsymbol{1}^T_{\\left\\lvert{\\boldsymbol{\\xi}_2}\\right\\rvert - k_2} \\otimes   \\boldsymbol{B}_{k_1, \\boldsymbol{\\xi}_1} \\left(\\boldsymbol{x}_1 \\right)  \\right) \\odot   \\left(\\boldsymbol{B}_{k_2, \\boldsymbol{\\xi}_2} \\left( \\boldsymbol{x}_2 \\right) \\otimes   \\boldsymbol{1}^{T}_{\\left\\lvert{\\boldsymbol{\\xi}_1}\\right\\rvert - k_1} \\right), \\end{equation}\\] \\(\\odot\\) element-wise product, \\(\\otimes\\) Kronecker product, \\(\\boldsymbol{1}_n\\) \\(n \\times 1\\) column vector 1s. two Kronecker products define correct dimensions entry-wise product. tensor product matrix number rows two input matrices columns generated pairwise products columns two input matrices. general case \\(m > 2,\\) matrix \\(\\mathscr{B}_{\\boldsymbol{K}, \\boldsymbol{\\Xi}} \\left( \\boldsymbol{X} \\right)\\) defined \\[\\begin{equation}     \\mathscr{B}_{\\boldsymbol{K}, \\boldsymbol{\\Xi}} \\left( \\boldsymbol{X} \\right) =     \\left( \\boldsymbol{1}_{\\left\\lvert{\\boldsymbol{\\xi}_m}\\right\\rvert - k_m}^{T} \\otimes     \\mathscr{B}_{\\boldsymbol{K} \\backslash   k_{m}, \\boldsymbol{\\Xi} \\backslash \\boldsymbol{\\xi}_m} \\left(\\boldsymbol{X}   \\backslash \\boldsymbol{x}_{m} \\right) \\right)     \\odot     \\left( \\boldsymbol{B}_{k_m, \\boldsymbol{\\xi}_m}\\left(\\boldsymbol{x}_m\\right) \\otimes     \\boldsymbol{1}_{\\prod_{= 1}^{m-1}     \\left(\\left\\lvert{\\boldsymbol{\\xi}_i}\\right\\rvert - k_i \\right)}^{T}   \\right). \\end{equation}\\] possible write set summations: \\[\\begin{equation}   \\begin{split}     f\\left( \\boldsymbol{X} \\right) & = \\mathscr{B}_{\\boldsymbol{K}, \\boldsymbol{\\Xi}} \\left( \\boldsymbol{X} \\right) \\boldsymbol{\\theta}_{\\boldsymbol{\\Xi}} \\\\    & =     \\sum_{j_1 = 1}^{\\left\\lvert{\\boldsymbol{\\xi}_1}\\right\\rvert - k_1}     \\sum_{j_2 = 1}^{\\left\\lvert{\\boldsymbol{\\xi}_2}\\right\\rvert - k_2}   \\cdots   \\sum_{j_m = 1}^{\\left\\lvert{\\boldsymbol{\\xi}_m}\\right\\rvert - k_m}   \\boldsymbol{B}_{k_1, \\boldsymbol{\\xi}_1}\\left(\\boldsymbol{x}_1\\right)   \\boldsymbol{B}_{k_2, \\boldsymbol{\\xi}_2}\\left(\\boldsymbol{x}_2\\right)   \\cdots   \\boldsymbol{B}_{k_m, \\boldsymbol{\\xi}_m}\\left(\\boldsymbol{x}_m\\right)   \\theta_{\\boldsymbol{\\Xi}, j_1, j_2, \\ldots, j_m} \\\\   & =     \\sum_{j_1 = 1}^{\\left\\lvert{\\boldsymbol{\\xi}_1}\\right\\rvert - k_1}     \\boldsymbol{B}_{k_1,\\boldsymbol{\\xi}_1}\\left(\\boldsymbol{x}_1\\right)   \\underbrace{     \\sum_{j_2 = 1}^{\\left\\lvert{\\boldsymbol{\\xi}_2}\\right\\rvert - k_2}   \\cdots   \\sum_{j_m = 1}^{\\left\\lvert{\\boldsymbol{\\xi}_m}\\right\\rvert - k_m}   \\boldsymbol{B}_{k_2,\\boldsymbol{\\xi}_2}\\left(\\boldsymbol{x}_2\\right)   \\cdots   \\boldsymbol{B}_{k_m,\\boldsymbol{\\xi}_m}\\left(\\boldsymbol{x}_m\\right)   \\theta_{\\boldsymbol{\\Xi}, j_1, j_2, \\ldots, j_m}   }_{\\text{polynomial coefficients}} \\\\   & =   \\text{diag}\\left(   \\boldsymbol{B}_{k_1, \\boldsymbol{\\xi}_1} \\left(\\boldsymbol{x}_1\\right)   \\boldsymbol{\\theta}_{\\boldsymbol{\\Xi}\\backslash   \\boldsymbol{\\xi}_1} \\left( \\boldsymbol{X} \\backslash \\boldsymbol{x}_1 \\right)\\right).   \\end{split} \\end{equation}\\] critical extension uni-variable control polygon reduction method multi-variable control polygon reduction method. conditioning \\(m-1\\) marginals, multi-variable B-spline becomes uni-variable B-spline terms \\(m^{th}\\) marginal. Thus, metrics methods control polygon reduction can applied.","code":""},{"path":"http://www.peteredewitt.com/cpr/articles/cnr.html","id":"control-nets","dir":"Articles","previous_headings":"","what":"Control Nets","title":"Tensor Products of B-Splines, Control Nets, and Control Net Reduction","text":"multi-variable B-splines, meaningful geometric relationship set knot sequences, \\(\\boldsymbol{\\Xi},\\) regression coefficients, \\(\\boldsymbol{\\theta}_{\\boldsymbol{\\Xi}},\\) provided control net. control net \\(m = 2\\) variables : \\[\\begin{equation}   {CN}_{\\boldsymbol{K} = \\left\\{k_1, k_2\\right\\}, \\boldsymbol{\\Xi} = \\left\\{   \\boldsymbol{\\xi}_1,   \\boldsymbol{\\xi}_2 \\right\\}, \\boldsymbol{\\theta}_{\\boldsymbol{\\Xi}}} = \\left\\{ \\left( \\xi_{1i}^{*},   \\xi_{2j}^{*}, \\theta_{ij} \\right) \\right\\}_{= 1, j =   1}^{\\left\\lvert{\\boldsymbol{\\xi}_1}\\right\\rvert -     k_1,   \\left\\lvert{\\boldsymbol{\\xi}_2}\\right\\rvert - k_2}, \\quad \\xi^{*}_{lj} = \\frac{1}{k_l + 1} \\sum_{= 1}^{k_l - 1}   \\xi_{l, j + }. \\end{equation}\\] Building control net cpr package done calling cn function defining basis via btensor method. Define tensor product B-splines providing list vectors, iknots, bknots, orders. example control net surface produces:","code":"tpmat <-   btensor(x = list(x1 = runif(51), x2 = runif(51)),           iknots = list(numeric(0), c(0.418, 0.582, 0.676, 0.840)),           bknots = list(c(0, 1), c(0, 1)),           order = list(3, 4)) tpmat ## Tensor Product Matrix dims: [51 x 24] theta <-   c(-0.03760,  0.03760, -0.03760,  0.77579, -0.84546,  0.63644, -0.87674,      0.71007, -1.21007,  0.29655, -0.57582, -0.26198,  0.23632, -0.58583,     -0.46271, -0.39724, -0.02194, -1.23562, -0.19377, -0.27948, -1.14028,      0.00405, -0.50405, -0.99595)  acn <- cn(tpmat, theta) par(mfrow = c(1, 2)) plot(acn, rgl = FALSE, xlab = \"x1\", ylab = \"x2\", zlab = \"control net\", clim = c(-1.2, 0.3), colkey = FALSE) ## Warning in rgl.init(initValue, onlyNULL): RGL: unable to open X11 display ## Warning: 'rgl.init' failed, running with 'rgl.useNULL = TRUE'. ## Warning: no DISPLAY variable so Tk is not available plot(acn, rgl = FALSE, show_net = FALSE, show_surface = TRUE, xlab = \"x1\", ylab = \"x2\", zlab = \"surface\", clim = c(-1.2, 0.3))"},{"path":"http://www.peteredewitt.com/cpr/articles/cnr.html","id":"control-net-reduction","dir":"Articles","previous_headings":"","what":"Control Net Reduction","title":"Tensor Products of B-Splines, Control Nets, and Control Net Reduction","text":"Similar control polygon reduction (CPR), control net reduction (CNR) looks assesses influence internal knot, omits least influential, refits model, repeats. complication CNR influence internal knot margin \\(m\\) function locations values \\(x\\) margins defining polynomial coefficients. suggest using set \\(p=20\\) values margin assessment. example two-variable tensor product, influence weight \\(j^{th}\\) internal knot first margin \\[w_{1j} = \\max_{x_2 \\\\boldsymbol{U}} w_{\\left. 1j \\right| x_2},\\] \\[\\boldsymbol{U} = \\left\\{ u :  \\min\\left(x_2\\right) + \\frac{\\left\\{1,2,\\ldots,p\\right\\}}{p+1} \\left( \\max\\left(x_2\\right) - \\min\\left(x_2\\right)\\right) \\right\\} \\] example: least influential knot \\(\\xi_{1,4}\\) influential knot \\(\\xi_{2,5}.\\)  call cnr runs full CNR algorithm initial control net.  plot residual standard errors index shows index 3 preferable model. can look surfaces see little difference original (index 6) index 3 considerable differences surfaces index 1 2.","code":"f <- function(x1, x2) {(x1 - 0.5)^2 * sin(4 * pi * x2) - x1 * x2} set.seed(42) cn_data <- expand.grid(x1 = sort(runif(100)), x2 = sort(runif(100))) cn_data <- within(cn_data, {z = f(x1, x2)}) initial_cn <-   cn(z ~ btensor(x        = list(x1, x2)                  , iknots = list(c(0.234), c(0.418, 0.582, 0.676, 0.840))                  , bknots = list(c(0, 1), c(0, 1))                  , order  = list(3, 4)                  )      , data = cn_data)  influence_of_iknots(initial_cn) ## [[1]] ##         xi_4  ## 5.282465e-32  ##  ## [[2]] ##        xi_5        xi_6        xi_7        xi_8  ## 0.717424005 0.045575415 0.006775287 0.012875249  ##  ## attr(,\"class\") ## [1] \"cpr_influence_of_iknots_cpn\" \"list\" cn1 <- update_btensor(initial_cn, iknots = list(numeric(0), c(0.418, 0.582, 0.676, 0.840))) cn2 <- update_btensor(initial_cn, iknots = list(numeric(0.234), c(0.582, 0.676, 0.840))) par(mfrow = c(1, 3)) plot(initial_cn, rgl = FALSE, show_surface = TRUE, show_net = FALSE, colkey = FALSE, clim = c(-1.2, 0.3), main = \"Original\") plot(cn1,        rgl = FALSE, show_surface = TRUE, show_net = FALSE, colkey = FALSE, clim = c(-1.2, 0.3), main = bquote(Omitting~xi[1,1])) plot(cn2,        rgl = FALSE, show_surface = TRUE, show_net = FALSE, colkey = FALSE, clim = c(-1.2, 0.3), main = bquote(Omitting~xi[2,1])) cnr0 <- cnr(initial_cn) ##    |                                                                               |                                                                      |   0%   |                                                                               |============                                                          |  17%   |                                                                               |=======================                                               |  33%   |                                                                               |===================================                                   |  50%   |                                                                               |===============================================                       |  67%   |                                                                               |==========================================================            |  83%   |                                                                               |======================================================================| 100% summary(cnr0) ##   dfs   loglik        rss         rse n_iknots1 iknots1 n_iknots2      iknots2 ## 1  12 12396.78 49.0631393 0.070087150         0                 0              ## 2  15 12408.53 48.9479832 0.070015367         0                 1        0.582 ## 3  18 36554.82  0.3912139 0.006260346         0                 2 0.418, 0.582 ## 4  21 36559.88  0.3908179 0.006258118         0                 3 0.418, 0.... ## 5  24 38449.23  0.2678356 0.005181505         0                 4 0.418, 0.... ## 6  32 38449.23  0.2678356 0.005183584         1   0.234         4 0.418, 0.... ##   index ## 1     1 ## 2     2 ## 3     3 ## 4     4 ## 5     5 ## 6     6 plot(cnr0) par(mfrow = c(2, 3)) plot(cnr0[[1]], rgl = FALSE, show_surface = TRUE, show_net = FALSE, clim = c(-1.2, 0.3), main = \"Index 1\", colkey = FALSE) plot(cnr0[[2]], rgl = FALSE, show_surface = TRUE, show_net = FALSE, clim = c(-1.2, 0.3), main = \"Index 2\", colkey = FALSE) plot(cnr0[[3]], rgl = FALSE, show_surface = TRUE, show_net = FALSE, clim = c(-1.2, 0.3), main = \"Index 3\", colkey = FALSE) plot(cnr0[[4]], rgl = FALSE, show_surface = TRUE, show_net = FALSE, clim = c(-1.2, 0.3), main = \"Index 4\", colkey = FALSE) plot(cnr0[[5]], rgl = FALSE, show_surface = TRUE, show_net = FALSE, clim = c(-1.2, 0.3), main = \"Index 5\", colkey = FALSE) plot(cnr0[[6]], rgl = FALSE, show_surface = TRUE, show_net = FALSE, clim = c(-1.2, 0.3), main = \"Index 6\", colkey = FALSE)"},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/articles/cnr.html","id":"session-info","dir":"Articles","previous_headings":"","what":"Session Info","title":"Tensor Products of B-Splines, Control Nets, and Control Net Reduction","text":"","code":"sessionInfo() ## R version 4.3.2 (2023-10-31) ## Platform: x86_64-pc-linux-gnu (64-bit) ## Running under: Ubuntu 22.04.3 LTS ##  ## Matrix products: default ## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  ## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0 ##  ## locale: ##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8        ##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8    ##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C           ## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C    ##  ## time zone: UTC ## tzcode source: system (glibc) ##  ## attached base packages: ## [1] stats     graphics  grDevices utils     datasets  methods   base      ##  ## other attached packages: ## [1] cpr_0.3.0.9006 qwraps2_0.6.0  ##  ## loaded via a namespace (and not attached): ##  [1] generics_0.1.3    utf8_1.2.4        sass_0.4.8        tcltk_4.3.2       ##  [5] stringi_1.8.3     lattice_0.21-9    lme4_1.1-35.1     digest_0.6.33     ##  [9] magrittr_2.0.3    rgl_1.2.8         evaluate_0.23     grid_4.3.2        ## [13] fastmap_1.1.1     jsonlite_1.8.8    Matrix_1.6-4      misc3d_0.9-1      ## [17] fansi_1.0.6       purrr_1.0.2       scales_1.3.0      textshaping_0.3.7 ## [21] jquerylib_0.1.4   cli_3.6.2         rlang_1.1.2       munsell_0.5.0     ## [25] splines_4.3.2     withr_2.5.2       base64enc_0.1-3   cachem_1.0.8      ## [29] yaml_2.3.8        tools_4.3.2       memoise_2.0.1     nloptr_2.0.3      ## [33] dplyr_1.1.4       minqa_1.2.6       colorspace_2.1-0  ggplot2_3.4.4     ## [37] boot_1.3-28.1     vctrs_0.6.5       R6_2.5.1          lifecycle_1.0.4   ## [41] plot3D_1.4        stringr_1.5.1     fs_1.6.3          htmlwidgets_1.6.4 ## [45] MASS_7.3-60       ragg_1.2.7        pkgconfig_2.0.3   desc_1.4.3        ## [49] pillar_1.9.0      pkgdown_2.0.7     bslib_0.6.1       gtable_0.3.4      ## [53] glue_1.6.2        Rcpp_1.0.11       systemfonts_1.0.5 tidyselect_1.2.0  ## [57] tibble_3.2.1      xfun_0.41         highr_0.10        knitr_1.45        ## [61] farver_2.1.1      htmltools_0.5.7   nlme_3.1-163      labeling_0.4.3    ## [65] rmarkdown_2.25    compiler_4.3.2"},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"b-splines-and-control-polygons","dir":"Articles","previous_headings":"","what":"B-splines and Control Polygons","title":"Control Polygon Reduction","text":"term “spline” likely derived shipwright draftsmen splines, thin wood strips, held place weights, used define curves. splines naturally minimize strain energy use additional weights strategic locations spline needed achieve specific curvatures. Cubic B-splines dissimilar. Splines piecewise polynomial curves differentiable prescribed order. B-splines based basis polynomial functions. Definitions notation uni-variable multi-variable B-splines associated control polygons control nets presented following. Two good references splines de Boor (2001) Prautzsch, Boehm, Paluszny (2002) wish dig details.","code":""},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"b-splines","dir":"Articles","previous_headings":"B-splines and Control Polygons","what":"B-splines","title":"Control Polygon Reduction","text":"curve defined \\(f\\left(x\\right)\\) spline order \\(k\\) (degree \\(k -1\\)), knots \\(\\xi_1, \\xi_2, \\ldots, \\xi_m\\) \\(\\xi_j \\leq x_{j+1}\\) \\(\\xi_{j} < \\xi_{j + k} \\forall j\\) \\(f\\left(x\\right)\\) \\(k-r-1\\) times differentiable \\(r\\)-fold knot, \\(f\\left(x\\right)\\) polynomial order \\(\\leq k\\) interval \\(x \\\\left[\\xi_j, \\xi_{j+1}\\right]\\) \\(j = 0, \\ldots, m - 1.\\) particular, B-splines, defined affine combination: \\[\\begin{equation}   f \\left( x \\right) =   \\sum_{j} \\theta_j B_{j,k,\\boldsymbol{\\xi}}\\left(x\\right) =   \\boldsymbol{B}_{k, \\boldsymbol{\\xi}} \\left(x\\right) \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}}   \\label{eq:f} \\end{equation}\\] \\(B_{j,k,\\boldsymbol{\\xi}}\\left(x\\right)\\) \\(j^{th}\\) basis spline function, \\(\\boldsymbol{\\xi}\\) sequence \\(l\\) interior knots total \\(2k\\) boundary knots, .e., cardinality knot sequence \\(\\left\\lvert \\boldsymbol{\\xi} \\right\\rvert = 2k + l.\\) value \\(k\\) boundary knots arbitrary, common choice use \\(k\\)-fold knots boundary: \\[ \\xi_1 = \\xi_2 = \\cdots = \\xi_k < \\xi_{k+1} \\leq \\cdots \\leq \\xi_{k + l} = \\xi_{k + l + 1} = \\cdots = \\xi_{2k + l}.\\] Alternative boundary knots can used long sequence \\(\\boldsymbol{\\xi}\\) non-decreasing. implications \\(k\\)-fold boundary knots follow next section. \\(j^{th}\\) B-spline defined : \\[\\begin{equation} B_{j,k,\\boldsymbol{\\xi}}\\left(x\\right) = \\omega_{j,k,\\boldsymbol{\\xi}} \\left(x\\right) B_{j,k-1,\\boldsymbol{\\xi}}\\left(x\\right) + \\left(1 - \\omega_{j+1,k,\\boldsymbol{\\xi}} \\right) B_{j+1,k-1,\\boldsymbol{\\xi}}\\left(x\\right), \\end{equation}\\] \\[\\begin{equation} B_{j,k,\\boldsymbol{\\xi}}\\left(x\\right) = 0 \\quad \\text{} \\quad x \\notin \\left[\\xi_j, \\xi_{j+k} \\right), \\quad \\quad B_{j,1,\\boldsymbol{\\xi}}\\left(x\\right) = \\begin{cases} 1 & x \\\\left[\\xi_j, \\xi_{j+k}\\right) \\\\ 0 & \\text{otherwise}, \\end{cases} \\end{equation}\\] \\[\\begin{equation} \\omega_{j,k,\\boldsymbol{\\xi}}\\left(x\\right) = \\begin{cases} 0 & x \\leq \\xi_j \\\\ \\frac{x-\\xi_j}{\\xi_{j+k-1} - \\xi_{j}} & \\xi_j < x < \\xi_{j+k-1} \\\\ 1 & \\xi_{j+k-1} \\leq x. \\end{cases} \\end{equation}\\] set observations, \\(\\boldsymbol{x} = x_1, \\ldots, x_n,\\) basis functions defined generalize matrix: \\[\\begin{equation}   \\boldsymbol{B}_{k, \\boldsymbol{\\xi}} \\left(\\boldsymbol{x}\\right) =   \\begin{pmatrix}     B_{1, k, \\boldsymbol{\\xi}} \\left(x_1\\right) &     B_{2, k, \\boldsymbol{\\xi}} \\left(x_1\\right) &     \\ldots &     B_{k + l, k, \\boldsymbol{\\xi}} \\left(x_1\\right) \\\\     \\vdots & \\vdots & \\ddots & \\vdots \\\\     B_{1, k, \\boldsymbol{\\xi}} \\left(x_n\\right) &     B_{2, k, \\boldsymbol{\\xi}} \\left(x_n\\right) &     \\ldots &     B_{k + l, k, \\boldsymbol{\\xi}} \\left(x_n\\right).   \\end{pmatrix} \\end{equation}\\] Within cpr package can generate basis matrix thusly: Note: default order bsplines 4, default boundary knots range x. However, relying default boundary knots can lead unexpected behavior , definition splines \\(k\\)-fold upper boundary 0. can quickly view plot spline functions well.  many important properties basis functions: \\[B_{j,k,\\boldsymbol{xi}} \\left(x\\right) \\\\left[0, 1\\right], \\forall x \\\\mathbb{R};\\] \\[B_{j,k,\\boldsymbol{\\xi}} \\left(x\\right) > 0 \\quad \\text{} \\quad x \\\\left(\\xi_{j}, \\xi_{j+k}\\right);\\] \\[\\sum_j B_{j,k,\\boldsymbol{xi}} \\left(x\\right) = \\begin{cases} 1 & x \\\\left[\\xi_1, \\xi_{2k+l}\\right) \\\\ 0 & otherwise. \\end{cases}\\]","code":"x <- seq(0, 5.9999, length.out = 5000) bmat <- bsplines(x, iknots = c(1, 1.5, 2.3, 4, 4.5), bknots = c(0, 6)) bmat ## Basis matrix dims: [5,000 x 9] ## Order: 4 ## Number of internal knots: 5 ##  ## First 6 rows: ##  ##           [,1]        [,2]         [,3]         [,4] [,5] [,6] [,7] [,8] [,9] ## [1,] 1.0000000 0.000000000 0.000000e+00 0.000000e+00    0    0    0    0    0 ## [2,] 0.9964037 0.003593461 2.878634e-06 5.011451e-10    0    0    0    0    0 ## [3,] 0.9928160 0.007172539 1.150485e-05 4.009161e-09    0    0    0    0    0 ## [4,] 0.9892369 0.010737255 2.586411e-05 1.353092e-08    0    0    0    0    0 ## [5,] 0.9856664 0.014287632 4.594188e-05 3.207329e-08    0    0    0    0    0 ## [6,] 0.9821045 0.017823691 7.172363e-05 6.264314e-08    0    0    0    0    0 plot(bmat, show_xi = TRUE, show_x = TRUE) all(bmat >= 0) ## [1] TRUE all(bmat <= 1) ## [1] TRUE all.equal(rowSums(bmat), rep(1, nrow(bmat))) ## [1] TRUE"},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"cprbsplines-vs-splinesbs","dir":"Articles","previous_headings":"B-splines and Control Polygons > B-splines","what":"cpr::bsplines vs splines::bs","title":"Control Polygon Reduction","text":"Part base R distribution splines package build B-splines calling bs. three areas functions differ: 1. input arguments, 2. attributes returned matrix, 3. behavior right boundary knot.","code":""},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"input-arguments","dir":"Articles","previous_headings":"B-splines and Control Polygons > B-splines > cpr::bsplines vs splines::bs","what":"Input Arguments","title":"Control Polygon Reduction","text":"bsplines intercept warn.outside arguments matrix generated bsplines effectively always intercept = TRUE warn.outside = TRUE. values x right boundary, outside boundary treated also differ two functions.","code":"args(bsplines) ## function (x, iknots = NULL, df = NULL, bknots = range(x), order = 4L)  ## NULL args(splines::bs) ## function (x, df = NULL, knots = NULL, degree = 3, intercept = FALSE,  ##     Boundary.knots = range(x), warn.outside = TRUE)  ## NULL"},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"attributes-of-the-returned-matrices","dir":"Articles","previous_headings":"B-splines and Control Polygons > B-splines > cpr::bsplines vs splines::bs","what":"Attributes of the returned matrices","title":"Control Polygon Reduction","text":"default call B-spline functions returns basis matrix order 4 (degree 3; cubic) B-spline boundary knots placed range(x). However, returns . bspline_mat additional attributes related control polygons. major difference dimension matrices. default splines::bs omits one column basis matrix using using function regression formula resulting design matrix rank deficient. Using bsplines suggest using +0 -1 regression formula omit intercept (nuance handled calls cp end user need worry ).","code":"bs_mat <- splines::bs(x, knots = attr(bmat, \"iknots\"), Boundary.knots = attr(bmat, \"bknots\")) str(attributes(bmat)) ## List of 10 ##  $ dim        : int [1:2] 5000 9 ##  $ order      : num 4 ##  $ df         : num 9 ##  $ iknots     : num [1:5] 1 1.5 2.3 4 4.5 ##  $ bknots     : num [1:2] 0 6 ##  $ xi         : num [1:13] 0 0 0 0 1 1.5 2.3 4 4.5 6 ... ##  $ xi_star    : num [1:9] 0 0.333 0.833 1.6 2.6 ... ##  $ class      : chr [1:2] \"cpr_bs\" \"matrix\" ##  $ call       : language bsplines(x = x, iknots = c(1, 1.5, 2.3, 4, 4.5), bknots = c(0, 6)) ##  $ environment:<environment: R_GlobalEnv> str(attributes(bs_mat)) ## List of 7 ##  $ dim           : int [1:2] 5000 8 ##  $ dimnames      :List of 2 ##   ..$ : NULL ##   ..$ : chr [1:8] \"1\" \"2\" \"3\" \"4\" ... ##  $ degree        : int 3 ##  $ knots         : num [1:5] 1 1.5 2.3 4 4.5 ##  $ Boundary.knots: num [1:2] 0 6 ##  $ intercept     : logi FALSE ##  $ class         : chr [1:3] \"bs\" \"basis\" \"matrix\""},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"right-continuity","dir":"Articles","previous_headings":"B-splines and Control Polygons > B-splines > cpr::bsplines vs splines::bs","what":"Right Continuity","title":"Control Polygon Reduction","text":"definition, \\(\\boldsymbol{B}_{j,k,\\boldsymbol{\\xi}}\\left(x\\right)\\) non-negative right-continuous functions. bsplines adheres definition strictly, whereas splines::bs uses pivoting method allow non-zero extrapolations outside support. Example: cpr::bsplines call, notice first, third, fifth rows, corresponding values outside support zeros row sums. Compare splines::bs returns negative values matrix, rows sum 1.","code":"bspline_eg <- bsplines(c(0, 1, 2, 5, 6), bknots = c(1, 5)) ## Warning in bsplines(c(0, 1, 2, 5, 6), bknots = c(1, 5)): At least one x value < ## min(bknots) ## Warning in bsplines(c(0, 1, 2, 5, 6), bknots = c(1, 5)): At least one x value ## >= max(bknots) bs_eg      <- splines::bs(c(0, 1, 2, 5, 6), Boundary.knots = c(1, 5), intercept = TRUE ) ## Warning in splines::bs(c(0, 1, 2, 5, 6), Boundary.knots = c(1, 5), intercept = ## TRUE): some 'x' values beyond boundary knots may cause ill-conditioned bases  head(bspline_eg) ##          [,1]     [,2]     [,3]     [,4] ## [1,] 0.000000 0.000000 0.000000 0.000000 ## [2,] 1.000000 0.000000 0.000000 0.000000 ## [3,] 0.421875 0.421875 0.140625 0.015625 ## [4,] 0.000000 0.000000 0.000000 0.000000 ## [5,] 0.000000 0.000000 0.000000 0.000000 rowSums(bspline_eg) ## [1] 0 1 1 0 0  head(bs_eg) ##              1         2         3         4 ## [1,]  1.953125 -1.171875  0.234375 -0.015625 ## [2,]  1.000000  0.000000  0.000000  0.000000 ## [3,]  0.421875  0.421875  0.140625  0.015625 ## [4,]  0.000000  0.000000  0.000000  1.000000 ## [5,] -0.015625  0.234375 -1.171875  1.953125 rowSums(bs_eg) ## [1] 1 1 1 1 1"},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"control-polygons","dir":"Articles","previous_headings":"","what":"Control Polygons","title":"Control Polygon Reduction","text":"spline \\(f\\left(\\boldsymbol{x}\\right) = \\boldsymbol{B}_{k,\\boldsymbol{\\xi}}\\left(\\boldsymbol{x}\\right)\\) convex sum coefficients \\(\\boldsymbol{\\theta}_{\\boldsymbol{\\xi}}.\\) meaningful geometric relationship \\(\\boldsymbol{\\xi}\\) \\(\\boldsymbol{\\theta}_{\\boldsymbol{\\xi}}\\) exist form control polygon, \\(CP_{k,\\boldsymbol{\\xi},\\boldsymbol{\\theta}_{\\boldsymbol{\\xi}}},\\) strong convex hull \\(\\boldsymbol{B}_{k,\\boldsymbol{\\xi}}\\left(\\boldsymbol{x}\\right) \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}}.\\) \\[\\begin{equation} CP_{k,\\boldsymbol{\\xi},\\boldsymbol{\\theta}_{\\xi}} = \\left\\{ \\left( \\xi_{j}^{*}, \\theta_{j,\\boldsymbol{\\xi}} \\right) \\right \\}_{j=1}^{\\left\\lvert\\boldsymbol{\\theta}_{\\boldsymbol{\\xi}}\\right\\rvert}; \\quad \\quad \\xi_{j}^{*} = \\frac{1}{k-1} \\sum_{= 1}^{k-1} \\xi_{j + }. \\end{equation}\\] \\(CP_{k,\\boldsymbol{\\xi},\\boldsymbol{\\theta}_{\\boldsymbol{\\xi}}}\\) sequence \\(\\left\\lvert \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}} \\right\\rvert = k + l\\) control vertices. control polygon can thought piecewise linear function approximating spline function. Changes convexity subtle characteristics spline function exaggerated control polygon. example, using basis matrix defined following coefficients can easily define spline function control polygon. Plotting control polygon corresponding spline:","code":"theta <- matrix(c(1, 0, 3.5, 4.2, 3.7, -0.5, -0.7, 2, 1.5), ncol = 1) cp0 <- cp(bmat, theta) plot(cp0, show_spline = TRUE)"},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"spline-spaces-and-inserting-a-knot","dir":"Articles","previous_headings":"Knot Influence","what":"Spline Spaces and Inserting a Knot","title":"Control Polygon Reduction","text":"Consider two knot sequences \\(\\boldsymbol{\\xi}\\) \\(\\boldsymbol{\\xi} \\cup \\boldsymbol{\\xi}'.\\) , given polynomial order \\(k,\\) spline space \\(\\mathbb{S}_{k,\\boldsymbol{\\xi}} \\subset \\mathbb{S}_{k,\\boldsymbol{\\xi} \\cup \\boldsymbol{\\xi}'}\\) (de Boor 2001, pg135). Given relationship spline spaces, convex sums generating spline functions, Boehm (1980) presented method inserting knots knot sequence spline function unchanged. Specifically, \\[ \\boldsymbol{\\xi}' = \\left\\{\\left. \\xi_{j}' \\right| \\min\\left(\\boldsymbol{\\xi}\\right) < \\xi_j < \\max\\left(\\boldsymbol{\\xi}\\right) \\quad \\forall j\\right\\}, \\] exist \\(\\boldsymbol{\\theta}_{\\boldsymbol{\\xi} \\cup \\boldsymbol{\\xi}'}\\) \\[ \\boldsymbol{B}_{k,\\boldsymbol{\\xi}} \\left(x\\right)\\boldsymbol{\\theta}_{\\boldsymbol{\\xi}} = \\boldsymbol{B}_{k,\\boldsymbol{\\xi}\\cup\\boldsymbol{\\xi}'}\\left(x\\right) \\boldsymbol{\\theta}_{\\boldsymbol{\\xi} \\cup \\boldsymbol{\\xi}'} \\quad \\forall x \\\\left[\\min\\left(\\boldsymbol{\\xi}\\right), \\max\\left(\\boldsymbol{\\xi} \\right) \\right]. \\] inserting singleton \\(\\xi'\\) \\(\\boldsymbol{\\xi},\\) \\[ \\boldsymbol{\\theta}_{\\boldsymbol{\\xi} \\cup \\xi'} = \\boldsymbol{W}_{k, \\boldsymbol{\\xi}}\\left(\\xi'\\right) \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}} \\] \\(\\boldsymbol{W}_{k,\\boldsymbol{\\xi}}\\left(\\xi'\\right)\\) \\(\\left( \\left\\lvert \\boldsymbol{\\theta} \\right\\rvert + 1\\right) \\times \\left\\lvert \\boldsymbol{\\theta} \\right\\rvert\\) lower bi-diagonal matrix \\[ \\boldsymbol{W}_{k,\\boldsymbol{\\xi}}\\left(\\xi'\\right) = \\begin{pmatrix} 1 & 0 & \\cdots & 0 \\\\ 1 - \\omega_{1, k, \\boldsymbol{\\xi}}\\left(\\xi'\\right) & \\omega_{1, k, \\boldsymbol{\\xi}} \\left(\\xi'\\right) & \\cdots & 0 \\\\ 0 & 1 - \\omega_{2, k, \\boldsymbol{\\xi}}\\left(\\xi'\\right) & \\cdots 0 \\\\ \\vdots & \\vdots & \\ddots & \\vdots \\\\ 0 & 0 & 1 - \\omega_{\\left\\lvert \\boldsymbol{\\theta} \\right\\rvert - 1, k, \\boldsymbol{\\xi}} \\left(\\xi'\\right) & \\omega_{\\left\\lvert \\boldsymbol{\\theta} \\right\\rvert - 1, k, \\boldsymbol{\\xi}} \\left(\\xi'\\right) \\\\ 0 & 0 & 0 & 1 \\end{pmatrix}, \\] \\(\\omega_{j,k,\\boldsymbol{\\xi}}\\left(x\\right)\\) defined de~Boor recursive algorithm. recursion can insert many knots \\(\\boldsymbol{\\xi}\\) without changing value spline function. example, insert knot \\(\\xi' = 3\\) control polygon defined .","code":"cp1 <- insert_a_knot(cp0, xi_prime = 3) plot(cp0, cp1, color = TRUE, show_spline = TRUE)"},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"assessing-influence-of-xi_j","dir":"Articles","previous_headings":"Knot Influence","what":"Assessing influence of \\(\\xi_j\\)","title":"Control Polygon Reduction","text":"derive metric assessing much influence \\(\\xi_j \\\\boldsymbol{\\xi}\\) \\(\\boldsymbol{B}_{k,\\boldsymbol{\\xi}} \\left(x\\right)\\boldsymbol{\\theta}_{\\boldsymbol{\\xi}}.\\) Using relationship defined Boehm (1980), can derive metric influence \\(\\xi_j\\) spline function. Start defined \\(k, \\boldsymbol{\\xi},\\) \\(\\boldsymbol{\\theta}_{k,\\boldsymbol{\\xi}}.\\) relationship \\[ \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}} = \\boldsymbol{W}_{k,\\boldsymbol{\\xi}\\backslash\\xi_{j}}\\left(\\xi_{j}\\right) \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}\\backslash\\xi_{j}} \\] holds \\(\\xi_j\\) zero influence. However, practice, expect relationship \\[ \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}} = \\boldsymbol{W}_{k,\\boldsymbol{\\xi}\\backslash\\xi_{j}}\\left(\\xi_{j}\\right) \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}\\backslash\\xi_{j}} + \\boldsymbol{d} \\] set deviations \\(\\boldsymbol{d}\\) equal \\(\\boldsymbol{0}\\) \\(\\xi_j\\) influence spline. can estimate \\(\\boldsymbol{d}\\) via least squares. simplify notation following drop subscripts parenthesis, , let \\(\\boldsymbol{W} = \\boldsymbol{W}_{k,\\boldsymbol{\\xi}\\backslash\\xi_{j}}\\left(\\xi_{j}\\right).\\) \\[ \\begin{align} \\boldsymbol{d} &= \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}} - \\boldsymbol{W} \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}\\backslash\\xi_{j}} \\\\                &= \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}} - \\boldsymbol{W} \\left(\\boldsymbol{W}^{T}\\boldsymbol{W}\\right)^{-1}\\boldsymbol{W}^{T}        \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}} \\\\                &= \\left(\\boldsymbol{}                   - \\boldsymbol{W} \\left(\\boldsymbol{W}^{T}\\boldsymbol{W}\\right)^{-1}\\boldsymbol{W}^{T}\\right) \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}} \\\\ \\end{align} \\] Finally, define influence \\(\\xi_j\\) \\(CP_{k,\\boldsymbol{\\xi},\\boldsymbol{\\theta}_{\\boldsymbol{\\xi}}}\\) \\[ w_j = \\left\\lVert \\boldsymbol{d} \\right\\rVert_{2}^{2}. \\] influence knots spline used section. Let’s look following plots explore influence \\(\\xi_{7}\\) (third interior knot \\(k=4\\) order spline) spline. panel () see original control polygon spline along coarsened control polygon spline. Note fewer control points, spline deviates original. panel (b) see restored control polygon result inserting \\(\\xi_7\\) coarsened control polygon panel (). plots also good example local support strong convexity control polygons \\(k + 1 = 5\\) control points impacted removal re-insertion \\(\\xi_7.\\) Lastly, panel (c) see three control polygons plotted together.  Next, consider influence \\(\\xi_8,\\) fourth interior knot. influence metric defined , least influential knot sequence. can seen easily spline original coarsened spline similar, despite apparent large difference magnitude control point ordinates original coarsened control polygons. However, re-inserting \\(\\xi_8\\) recovered control polygon similar original, hence low influence \\(\\xi_8.\\)  required omit internal knot, preferable omit \\(\\xi_8\\) \\(\\xi_5, \\xi_6, \\xi_7,\\) \\(\\xi_9\\) least impact spline approximation original functional form.","code":"x <- influence_of_iknots(cp0) summary(x) ##   j iknot  influence influence_rank chisq chisq_rank p_value os_p_value ## 1 5   1.0 1.64661178              5    NA         NA      NA         NA ## 2 6   1.5 0.29066719              2    NA         NA      NA         NA ## 3 7   2.3 0.31205029              3    NA         NA      NA         NA ## 4 8   4.0 0.07702981              1    NA         NA      NA         NA ## 5 9   4.5 0.41987740              4    NA         NA      NA         NA ggpubr::ggarrange(   ggpubr::ggarrange(       plot(x, j = 3, coarsened = TRUE, restored = FALSE, color = TRUE, show_spline = TRUE) +         ggplot2::theme(legend.position = \"none\")     , plot(x, j = 3, coarsened = FALSE, restored = TRUE, color = TRUE, show_spline = TRUE) +       ggplot2::theme(legend.position = \"none\")     , labels = c(\"(a)\", \"(b)\")     , nrow = 1   )   , plot(x, j = 3, coarsened = TRUE, restored = TRUE, color = TRUE, show_spline = TRUE) +     ggplot2::theme(legend.position = \"bottom\")   , labels = c(\"\", \"(c)\")   , nrow = 2   , ncol = 1   , heights = c(1, 2) ) ggpubr::ggarrange(   ggpubr::ggarrange(       plot(x, j = 4, coarsened = TRUE, restored = FALSE, color = TRUE, show_spline = TRUE) +         ggplot2::theme(legend.position = \"none\")     , plot(x, j = 4, coarsened = FALSE, restored = TRUE, color = TRUE, show_spline = TRUE) +       ggplot2::theme(legend.position = \"none\")     , labels = c(\"(a)\", \"(b)\")     , nrow = 1   )   , plot(x, j = 4, coarsened = TRUE, restored = TRUE, color = TRUE, show_spline = TRUE) +     ggplot2::theme(legend.position = \"bottom\")   , labels = c(\"\", \"(c)\")   , nrow = 2   , ncol = 1   , heights = c(1, 2) )"},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"fitting-b-splines-to-noisy-data","dir":"Articles","previous_headings":"","what":"Fitting B-splines to noisy data","title":"Control Polygon Reduction","text":"Start spline using add noise .  fit spline control polygon noisy data use formula statement cp call. example use known internal knots add one extra.  plot shows fitted spline well approximating true spline function. Just make perfectly clear, regression coefficients estimates ordinates control polygon: Let’s now look influence internal knots fit least influential knot \\(\\xi_8 = 3.0,\\) extra knot inserted. Good, expected result. someone determine influence significant? , can test null hypothesis \\[H_0: w_{j} = 0\\] null hypothesis knot zero influence standard ordinary least squares regression assumptions regression coefficients, (ordinates control polygon regression coefficients), realizations Gaussian random variable. \\[ w_j = \\left(\\left(\\boldsymbol{} - \\boldsymbol{H}\\right)\\hat{\\boldsymbol{\\theta}} \\right)^{T} \\left[   \\left(\\left(\\boldsymbol{} - \\boldsymbol{H}\\right)\\boldsymbol{\\theta}} \\right)   \\boldsymbol{\\Sigma}   \\left(\\left(\\boldsymbol{} - \\boldsymbol{H}\\right)\\boldsymbol{\\theta}} \\right)^{T} \\right]^{+} \\left(\\left(\\boldsymbol{} - \\boldsymbol{H}\\right)\\hat{\\boldsymbol{\\theta}} \\right) \\] \\(\\boldsymbol{H} = W (W^{T}W)^{-1} W^{T},\\) \\(\\boldsymbol{\\Sigma}\\) variance-covariance matrix regression coefficients, \\(+\\) denotes Moore-Penrose inverse matrix. construction, \\(\\left(\\boldsymbol{} - \\boldsymbol{H}\\right) \\boldsymbol{\\Sigma} \\left(\\boldsymbol{} - \\boldsymbol{H}\\right)^{T}\\) singular thus standard inverse exist generalized inverse necessary. yields test statistic following chi-square distribution one degree freedom, \\[ w_j \\sim \\chi_{1}^{2}.\\] Now, interested removing knot lowest influence interested minimum. hypothesis test actually interested \\[ H_0: w_{(1)} = 0 \\] follows distribution \\[ \\Pr \\left[ w_{(1)} > w \\right] = \\sum_{j = 1}^{k+l} \\binom{n+l}{j} \\left(F_{\\chi_{1}^{2}}\\left(w\\right)\\right)^{j} \\left( 1 - F_{\\chi_{1}^{2}}\\left(w\\right) \\right)^{k+l-j}\\] \\(F_{\\chi_{1}^{2}}\\left(w\\right)\\) distribution function chi-square distribution one degree freedom. results generated calling influence_of_iknots. report two sets p-values. first p-value probability observed chisq value greater reported, second p-value probability rank order statistic exceeding observed value. worth remembering fraught binary classification statistical (non)significance can . Just p-value low mean knot influential, just high p-value dose mean knot influential. Sample size, -fitting, factors can/lead poor selection model consider p-values. said, consider \\(\\xi_9 = 4.0\\) lowest influence weight. Let’s omit knot refit model. omitting one knot refitting model see \\(\\xi = 2.3\\) least influential. Just fun, let’s omit knot, refit. Let’s continue process way zero knots. least influential knot second reduction \\(\\xi = 1.5\\) omitted third reduction. Within third reduction, least influential knot \\(\\xi = 3.0\\) knot omitted fourth reduction. two remaining internal knots, \\(\\xi - 1.0\\) least influential omitted fifth reduction. one knot can omitted fifth sixth reduction. sixth reduction, zero internal knots, lets us compare model fits model just \\(k=4\\) order polynomial. Let’s compare fits. start looking control polygons splines.  control polygons, panel (), see sixth, fifth, fourth reductions different initial, first, second, third reductions, splines, fifth sixth reductions easily identified different. Next, graphic let us compare models truth, observed data.  dashed black line spline fitted data (light burgundy dots) true value target function burgundy line. fifth reduction easily noticeable difference fitted spline target function. initial control polygon first three reductions difficult visually discern meaningful difference fits. Thus, argue third reduction preferable model fewest degrees freedom providing good quality fit. conclusion supported looking residual standard error (rse) \\[ rse = \\sqrt{ \\frac{1}{df} \\sum_{=1}^{n} \\left(y_i - f\\left(x_i\\right)\\right)^2 },\\] degrees freedom, \\(df,\\) sample size \\(n\\) minus number regression parameters. wiggle one measure wiggliness defined \\[ \\int_{\\min\\left(\\boldsymbol{\\xi}\\right)}^{\\max\\left(\\boldsymbol{\\xi}\\right)} \\left( \\frac{d^2}{dx^2} f\\left(x\\right) \\right)^2 dx. \\] fdsc reports number times first derivative sign change.","code":"set.seed(42) x <- seq(0, 5.99999, length.out = 100) bmat <- bsplines(x, iknots = c(1, 1.5, 2.3, 4, 4.5), bknots = c(0, 6)) theta <- matrix(c(1, 0, 3.5, 4.2, 3.7, -0.5, -0.7, 2, 1.5), ncol = 1) DF <- data.frame(x = x, truth = as.numeric(bmat %*% theta)) DF$y <- as.numeric(bmat %*% theta + rnorm(nrow(bmat), sd = 0.3))  original_data_ggplot_layers <-   list(     ggplot2::geom_point(data = DF                         , mapping = ggplot2::aes(x = x, y = y)                         , inherit.aes = FALSE                         , color = \"#6F263D\"                         , alpha = 0.2)     ,     ggplot2::geom_line(data = DF                        , mapping = ggplot2::aes(x = x, y = truth)                        , inherit.aes = FALSE                        , color = \"#6F263D\"                        , alpha = 0.6)   )  ggplot2::ggplot(DF) + ggplot2::theme_bw() + original_data_ggplot_layers initial_cp <-   cp(y ~ bsplines(x, iknots = c(1, 1.5, 2.3, 3.0, 4, 4.5), bknots = c(0, 6))      , data = DF      , keep_fit = TRUE # default is FALSE   )  plot(initial_cp, show_spline = TRUE) + original_data_ggplot_layers initial_cp$fit |> coef() |> unname() ##  [1]  1.0032390  0.6730762  3.0035459  4.4136192  3.5386419  1.7539897 ##  [7] -0.4708520 -0.7312097  2.1631310  1.3575369 initial_cp$cp$theta ##  [1]  1.0032390  0.6730762  3.0035459  4.4136192  3.5386419  1.7539897 ##  [7] -0.4708520 -0.7312097  2.1631310  1.3575369 initial_cp |>   influence_of_iknots() |>   summary() ##    j iknot  influence influence_rank     chisq chisq_rank   p_value os_p_value ## 1  5   1.0 0.16235075              5 0.9100724          5 0.3400952 0.66205444 ## 2  6   1.5 0.05785223              3 0.4331666          2 0.5104392 0.11947108 ## 3  7   2.3 0.05128404              2 0.5061398          3 0.4768147 0.30134562 ## 4  8   3.0 0.08264093              4 0.8363492          4 0.3604430 0.37410640 ## 5  9   4.0 0.02585915              1 0.2230694          1 0.6367111 0.06662766 ## 6 10   4.5 0.39575696              6 2.6821030          6 0.1014816 0.47378677 initial_cp |>   influence_of_iknots() |>   summary() |>   knitr::kable(row.names = TRUE) first_reduction_cp <-   cp(y ~ bsplines(x, iknots = c(1, 1.5, 2.3, 3, 4.5), bknots = c(0, 6)), data = DF) first_reduction_cp |>   influence_of_iknots() |>   summary() |>   knitr::kable(row.names = TRUE) second_reduction_cp <-   cp(y ~ bsplines(x, iknots = c(1, 1.5, 3, 4.5), bknots = c(0, 6)), data = DF) second_reduction_cp |>   influence_of_iknots() |>   summary() |>   knitr::kable(row.names = TRUE) third_reduction_cp <-   cp(y ~ bsplines(x, iknots = c(1, 3, 4.5), bknots = c(0, 6)), data = DF) third_reduction_cp |>   influence_of_iknots() |>   summary() |>   knitr::kable(row.names = TRUE) fourth_reduction_cp <-   cp(y ~ bsplines(x, iknots = c(1, 4.5), bknots = c(0, 6)), data = DF) fourth_reduction_cp |>   influence_of_iknots() |>   summary() |>   knitr::kable(row.names = TRUE) fifth_reduction_cp <-   cp(y ~ bsplines(x, iknots = 4.5, bknots = c(0, 6)), data = DF) fifth_reduction_cp |>   influence_of_iknots() |>   summary() |>   knitr::kable(row.names = TRUE) sixth_reduction_cp <-   cp(y ~ bsplines(x, bknots = c(0, 6)), data = DF) sixth_reduction_cp |>   influence_of_iknots() |>   summary() ##   j iknot influence influence_rank chisq chisq_rank p_value os_p_value ## 1 4    NA        NA             NA    NA         NA      NA         NA list(  initial_cp , first_reduction_cp , second_reduction_cp , third_reduction_cp      , fourth_reduction_cp , fifth_reduction_cp , sixth_reduction_cp) |>   rev() |>   lapply(summary) |>   do.call(what = rbind, args = _) |>   cbind(data.frame(reduction = seq(6, 0, by = -1))) |>   knitr::kable(row.names = TRUE)"},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"control-polygon-reduction","dir":"Articles","previous_headings":"","what":"Control Polygon Reduction","title":"Control Polygon Reduction","text":"exercise manually identifying omitting knot smallest influence model tedious working large set initial knots. Fortunately, process automated. Calling cpr cpr_cp object defined function automatically omit internal knot lowest influence.","code":""},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"example-with-known-knots","dir":"Articles","previous_headings":"Control Polygon Reduction","what":"Example with known knots","title":"Control Polygon Reduction","text":"Apply CPR initial_cp example. 0 control polygons within cpr_cpr object, length(initial_cp$iknots) + 1. indexing set \\(^{th}\\) element \\(-1\\) internal knots. exploring results, let’s just verify results call cpr manual results found . differences metadata objects, important parts, like control polygons, . manual process identified third_reduction_cp preferable model. cpr0 object can quickly see similar result manual process. additional columns summary, loglik_elbow rse_elbow, indicate location plot either loglik rse model index (degrees freedom) trade-additional degrees freedom improvement fix statistic negligible. See plot . determined finding breakpoint continuous, differentiable breakpoint, quadratic spline fits plot minimal residual standard error.","code":"cpr0 <- cpr(initial_cp) ##    |                                                                               |                                                                      |   0%   |                                                                               |==========                                                            |  14%   |                                                                               |====================                                                  |  29%   |                                                                               |==============================                                        |  43%   |                                                                               |========================================                              |  57%   |                                                                               |==================================================                    |  71%   |                                                                               |============================================================          |  86%   |                                                                               |======================================================================| 100% cpr0 ## A list of control polygons ## List of 7 ##  - attr(*, \"ioik\")=List of 7 ##  - attr(*, \"class\")= chr [1:2] \"cpr_cpr\" \"list\" all.equal( cpr0[[\"cps\"]][[7]][[\"cp\"]],  initial_cp[[\"cp\"]]) ## [1] \"target is NULL, current is data.frame\"  # some attributes are different with the last cp due to how the automation # creates the call vs how the call was created manually. call_idx <- which(names(cpr0[[\"cps\"]][[6]]) == \"call\") all.equal( cpr0[[\"cps\"]][[6]][-call_idx], first_reduction_cp [-call_idx]) ## [1] \"target is NULL, current is list\" all.equal( cpr0[[\"cps\"]][[5]][-call_idx], second_reduction_cp[-call_idx]) ## [1] \"target is NULL, current is list\" all.equal( cpr0[[\"cps\"]][[4]][-call_idx], third_reduction_cp [-call_idx]) ## [1] \"target is NULL, current is list\" all.equal( cpr0[[\"cps\"]][[3]][-call_idx], fourth_reduction_cp[-call_idx]) ## [1] \"target is NULL, current is list\" all.equal( cpr0[[\"cps\"]][[2]][-call_idx], fifth_reduction_cp [-call_idx]) ## [1] \"target is NULL, current is list\" all.equal( cpr0[[\"cps\"]][[1]][-call_idx], sixth_reduction_cp [-call_idx], check.attributes = FALSE) ## [1] \"target is NULL, current is list\" s0 <- summary(cpr0) knitr::kable(s0, row.names = TRUE) ggpubr::ggarrange(   ggpubr::ggarrange(       plot(cpr0, color = TRUE)     , plot(cpr0, show_cp = FALSE, show_spline = TRUE, color = TRUE)     , ncol = 1     , common.legend = TRUE   )   ,   ggpubr::ggarrange(       plot(s0, type = \"rse\")     , plot(s0, type = \"rss\")     , plot(s0, type = \"loglik\")     , plot(s0, type = \"wiggle\")     , plot(s0, type = \"fdsc\")     , plot(s0, type = \"Pr(>w_(1))\")   , common.legend = TRUE   )   , widths = c(2, 3) ) ## Warning: Removed 1 rows containing missing values (`geom_point()`). ## Warning: Removed 1 row containing missing values (`geom_line()`). ## Warning: Removed 1 rows containing missing values (`geom_point()`). ## Warning: Removed 1 row containing missing values (`geom_line()`)."},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"example-when-knots-are-unknown","dir":"Articles","previous_headings":"Control Polygon Reduction","what":"Example when knots are unknown","title":"Control Polygon Reduction","text":"practice extremely unlikely know knots placed. Analytic solutions difficult, impossible derive (Jupp 1978). However, optimal solution may necessary. de Boor (2001) (page 106)  “…B-spline doesn’t change much one changes \\(k+1\\) knots little bit. Therefore, one multiple knots, easy find B-spline almost like simple knots: Simply replace knot multiplicity \\(r > 1\\) \\(r\\) simple knots nearby.” , \\[   \\boldsymbol{B}_{k, \\boldsymbol{\\xi}}\\left(x\\right) \\boldsymbol{\\theta}_{\\boldsymbol{\\xi}} \\approx   \\boldsymbol{B}_{k, \\boldsymbol{\\xi'}}\\left(x\\right) \\boldsymbol{\\theta}_{\\boldsymbol{\\xi'}} \\] \\[ \\left\\lvert \\xi_j - \\xi_j' \\right\\rvert < \\delta \\quad \\text{small} \\quad \\delta > 0. \\] , case looking good set knots (good set knots parsimonious, provide good model fit) start initial knot sequence high cardinality, without precedent Eilers Marx (2010). apply CPR algorithm find good set knots. example use 50 internal knots. surprisingly fit “connect--dots” smooth fit.  Apply CPR initial_cp look summary. first 10 51 rows provided . , preferable model suggested index 5, model four internal knots. Inspection rse index plot, argue manual selection index 5 preferable overall.  Let’s compare models indices 3, 4, 5.  noticeable differences , part, located left side support 0 1. fifth index, change convexity spline. Knowing models index 3 4 good fits , easy select index 5 due extra “wiggle” spline. practice likely pick model index 4 smooth (small wiggle) low rse. Compare selected model original data.","code":"initial_cp <- cp(y ~ bsplines(x, df = 54, bknots = c(0, 6)), data = DF)  ggpubr::ggarrange(   plot(initial_cp, show_cp = TRUE, show_spline = FALSE) + original_data_ggplot_layers   ,   plot(initial_cp, show_cp = FALSE, show_spline = TRUE) + original_data_ggplot_layers ) cpr1 <- cpr(initial_cp) ##    |                                                                               |                                                                      |   0%   |                                                                               |=                                                                     |   2%   |                                                                               |===                                                                   |   4%   |                                                                               |====                                                                  |   6%   |                                                                               |=====                                                                 |   8%   |                                                                               |=======                                                               |  10%   |                                                                               |========                                                              |  12%   |                                                                               |==========                                                            |  14%   |                                                                               |===========                                                           |  16%   |                                                                               |============                                                          |  18%   |                                                                               |==============                                                        |  20%   |                                                                               |===============                                                       |  22%   |                                                                               |================                                                      |  24%   |                                                                               |==================                                                    |  25%   |                                                                               |===================                                                   |  27%   |                                                                               |=====================                                                 |  29%   |                                                                               |======================                                                |  31%   |                                                                               |=======================                                               |  33%   |                                                                               |=========================                                             |  35%   |                                                                               |==========================                                            |  37%   |                                                                               |===========================                                           |  39%   |                                                                               |=============================                                         |  41%   |                                                                               |==============================                                        |  43%   |                                                                               |================================                                      |  45%   |                                                                               |=================================                                     |  47%   |                                                                               |==================================                                    |  49%   |                                                                               |====================================                                  |  51%   |                                                                               |=====================================                                 |  53%   |                                                                               |======================================                                |  55%   |                                                                               |========================================                              |  57%   |                                                                               |=========================================                             |  59%   |                                                                               |===========================================                           |  61%   |                                                                               |============================================                          |  63%   |                                                                               |=============================================                         |  65%   |                                                                               |===============================================                       |  67%   |                                                                               |================================================                      |  69%   |                                                                               |=================================================                     |  71%   |                                                                               |===================================================                   |  73%   |                                                                               |====================================================                  |  75%   |                                                                               |======================================================                |  76%   |                                                                               |=======================================================               |  78%   |                                                                               |========================================================              |  80%   |                                                                               |==========================================================            |  82%   |                                                                               |===========================================================           |  84%   |                                                                               |============================================================          |  86%   |                                                                               |==============================================================        |  88%   |                                                                               |===============================================================       |  90%   |                                                                               |=================================================================     |  92%   |                                                                               |==================================================================    |  94%   |                                                                               |===================================================================   |  96%   |                                                                               |===================================================================== |  98%   |                                                                               |======================================================================| 100% x <- summary(cpr1) knitr::kable(head(x, 10)) plot(x, type = \"rse\") ggpubr::ggarrange(   plot(cpr1[[3]], cpr1[[4]], cpr1[[5]], show_cp = TRUE, show_spline = FALSE, color = TRUE)   ,   plot(cpr1[[3]], cpr1[[4]], cpr1[[5]], show_cp = FALSE, show_spline = TRUE, color = TRUE)   ,   common.legend = TRUE ) ggpubr::ggarrange(     plot(cpr1[[3]], show_cp = FALSE, show_spline = TRUE) +     ggplot2::ggtitle(\"Model Index 3\") +     original_data_ggplot_layers   , plot(cpr1[[4]], show_cp = FALSE, show_spline = TRUE) +     ggplot2::ggtitle(\"Model Index 4\") +     original_data_ggplot_layers   , plot(cpr1[[5]], show_cp = FALSE, show_spline = TRUE) +     ggplot2::ggtitle(\"Model Index 5\") +     original_data_ggplot_layers   , nrow = 1   , legend = \"none\" )"},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"extensions-to-higher-dimensions","dir":"Articles","previous_headings":"","what":"Extensions to higher dimensions","title":"Control Polygon Reduction","text":"CPR works uni-variable B-splines. taking tensor products B-splines, building control-net, higher-dimensional analog control polygon, can apply similar methods estimate surface. Details Control Net Reduction method presented ","code":"vignette(topic = \"cnr\", package = \"cpr\")"},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/articles/cpr.html","id":"session-info","dir":"Articles","previous_headings":"","what":"Session Info","title":"Control Polygon Reduction","text":"","code":"sessionInfo() ## R version 4.3.2 (2023-10-31) ## Platform: x86_64-pc-linux-gnu (64-bit) ## Running under: Ubuntu 22.04.3 LTS ##  ## Matrix products: default ## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  ## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0 ##  ## locale: ##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8        ##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8    ##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C           ## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C    ##  ## time zone: UTC ## tzcode source: system (glibc) ##  ## attached base packages: ## [1] stats     graphics  grDevices utils     datasets  methods   base      ##  ## other attached packages: ## [1] cpr_0.3.0.9006 qwraps2_0.6.0  ##  ## loaded via a namespace (and not attached): ##  [1] gtable_0.3.4      xfun_0.41         bslib_0.6.1       ggplot2_3.4.4     ##  [5] rstatix_0.7.2     lattice_0.21-9    vctrs_0.6.5       tools_4.3.2       ##  [9] generics_0.1.3    tibble_3.2.1      fansi_1.0.6       highr_0.10        ## [13] pkgconfig_2.0.3   Matrix_1.6-4      desc_1.4.3        lifecycle_1.0.4   ## [17] compiler_4.3.2    farver_2.1.1      stringr_1.5.1     textshaping_0.3.7 ## [21] munsell_0.5.0     carData_3.0-5     htmltools_0.5.7   sass_0.4.8        ## [25] yaml_2.3.8        pillar_1.9.0      pkgdown_2.0.7     car_3.1-2         ## [29] ggpubr_0.6.0      nloptr_2.0.3      jquerylib_0.1.4   tidyr_1.3.0       ## [33] MASS_7.3-60       cachem_1.0.8      boot_1.3-28.1     abind_1.4-5       ## [37] nlme_3.1-163      tidyselect_1.2.0  digest_0.6.33     stringi_1.8.3     ## [41] dplyr_1.1.4       purrr_1.0.2       labeling_0.4.3    splines_4.3.2     ## [45] cowplot_1.1.2     fastmap_1.1.1     grid_4.3.2        colorspace_2.1-0  ## [49] cli_3.6.2         magrittr_2.0.3    utf8_1.2.4        broom_1.0.5       ## [53] withr_2.5.2       scales_1.3.0      backports_1.4.1   rmarkdown_2.25    ## [57] lme4_1.1-35.1     gridExtra_2.3     ggsignif_0.6.4    ragg_1.2.7        ## [61] memoise_2.0.1     evaluate_0.23     knitr_1.45        rlang_1.1.2       ## [65] Rcpp_1.0.11       glue_1.6.2        minqa_1.2.6       jsonlite_1.8.8    ## [69] R6_2.5.1          systemfonts_1.0.5 fs_1.6.3"},{"path":"http://www.peteredewitt.com/cpr/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Peter DeWitt. Author, maintainer. Samantha MaWhinney. Thesis advisor. Nichole Carlson. Thesis advisor.","code":""},{"path":"http://www.peteredewitt.com/cpr/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"DeWitt P (2024). cpr: Control Polygon Reduction. R package version 0.3.0.9006, http://www.peteredewitt.com/cpr/, https://github.com/dewittpe/cpr/.","code":"@Manual{,   title = {cpr: Control Polygon Reduction},   author = {Peter DeWitt},   year = {2024},   note = {R package version 0.3.0.9006, http://www.peteredewitt.com/cpr/},   url = {https://github.com/dewittpe/cpr/}, }"},{"path":"http://www.peteredewitt.com/cpr/index.html","id":"cpr-control-polygon-reduction-","dir":"","previous_headings":"","what":"Control Polygon Reduction","title":"Control Polygon Reduction","text":"R package implementing Control Polygon Reduction model selection method. tasked modeling functional relationship response continuous predictor, .e., y = f(x), CPR allows quick efficient searching large model space find B-spline estimates function f(x). CPR extends multiple dimensions allows one find good locations knots tensor product B-splines.","code":""},{"path":"http://www.peteredewitt.com/cpr/index.html","id":"learn-more-about-cpr","dir":"","previous_headings":"","what":"Learn More About CPR.","title":"Control Polygon Reduction","text":"model selection method developed part Peter DeWitt’s PhD dissertation work. extended since.","code":""},{"path":"http://www.peteredewitt.com/cpr/index.html","id":"vignettes","dir":"","previous_headings":"Learn More About CPR.","what":"Vignettes","title":"Control Polygon Reduction","text":"two vignettes within package can also read package website","code":"vignettes(topic = 'cpr', package = 'cpr') vignettes(topic = 'cnr', package = 'cpr')"},{"path":"http://www.peteredewitt.com/cpr/index.html","id":"related-publications","dir":"","previous_headings":"Learn More About CPR.","what":"Related Publications:","title":"Control Polygon Reduction","text":"CPR method presented 28th International Biometric Conference held July 2016, Victoria, British Columbia, Canada. abstract, paper, talk title: “Parsimonious B-splines Regression Models via Control Polygon Reduction.” bibtex entry abstract: Awards: presentation work earned Peter DeWitt two awards: “Best Student Oral Presentation” International Biometric Society (IBS). “Distinguished Oral Presentation” part student paper competition hosted Western North American Region (WNAR) IBS.","code":"@inproceedings{,   author       = {DeWitt, Peter E. and Carlson, Nichole E. and Samantha MaWhinney},   title        = {Parsimonious B-spline Regression Models via Control Polygon Reduction},   booktitle    = {Abstracts for the XXVIIIth International Biometric Conference},   month        = {July},   year         = {2016},   organization = {International Biometric Society},   address      = {Victoria, British Columbia},   url          = {http://www.biometricsociety.org/conference-abstracts/2016/},   isbn         = {978-0-9821919-4-1} }"},{"path":"http://www.peteredewitt.com/cpr/index.html","id":"installing-cpr","dir":"","previous_headings":"","what":"Installing CPR","title":"Control Polygon Reduction","text":"Options installing CPR: 1. Install Comprehensive R Archive Network (CRAN) Install developmental version github. require remotes installed, , using Windows, ’ll need Rtools installed well. Clone repository use GNU make Go release page load cpr_<version>.tar.gz file version want install. Install command line Within R","code":"# within R install.packages(\"cpr\", repos = \"https://cran.rstudio.com\") remotes::install_github(\"dewittpe/cpr\", build_vignettes = TRUE) make install R CMD INSTALL cpr_<version>.tar.gz install.packages(<path_to_file>, repos = NULL, type=\"source\")"},{"path":"http://www.peteredewitt.com/cpr/index.html","id":"other-notes","dir":"","previous_headings":"","what":"Other Notes:","title":"Control Polygon Reduction","text":"cpr package provides 3D graphics via rgl package. get error, rather message, form: easy fix. need get FreeType 2 font engine. Debian, can get library via: FreeType 2 font engine installed computer must reinstall rgl package.","code":"font family \"sans\" not found, using \"bitmap\" apt-get install libfreetype6-dev"},{"path":"http://www.peteredewitt.com/cpr/reference/bsplineD.html","id":null,"dir":"Reference","previous_headings":"","what":"B-spline Derivatives — bsplineD","title":"B-spline Derivatives — bsplineD","text":"Generate first second derivatives B-spline Basis.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/bsplineD.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"B-spline Derivatives — bsplineD","text":"","code":"bsplineD(   x,   iknots = NULL,   df = NULL,   bknots = range(x),   order = 4L,   derivative = 1L )"},{"path":"http://www.peteredewitt.com/cpr/reference/bsplineD.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"B-spline Derivatives — bsplineD","text":"x numeric vector iknots internal knots df degrees freedom: sum order internal knots.  Ignored iknots specified. bknots boundary knot locations, defaults range(x). order order piecewise polynomials, defaults 4L. derivative, (integer) first second derivative","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/bsplineD.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"B-spline Derivatives — bsplineD","text":"numeric matrix","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/bsplineD.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"B-spline Derivatives — bsplineD","text":"C. de Boor, \"practical guide splines. Revised Edition,\" Springer, 2001. H. Prautzsch, W. Boehm, M. Paluszny, \"Bezier B-spline Techniques,\" Springer, 2002.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/bsplineD.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"B-spline Derivatives — bsplineD","text":"","code":"################################################################################ # Example 1 - pefectly fitting a cubic function f <- function(x) {   x^3 - 2 * x^2 - 5 * x + 6 }  fprime <- function(x) { # first derivatives of f(x)   3 * x^2 - 4 * x - 5 }  fdoubleprime <- function(x) { # second derivatives of f(x)   6 * x - 4 }  # Build a spline to fit bknots = c(-3, 5)  x     <- seq(-3, 4.999, length.out = 200) bmat  <- bsplines(x, bknots = bknots) theta <- matrix(coef(lm(f(x) ~ bmat + 0)), ncol = 1)  bmatD1 <- bsplineD(x, bknots = bknots, derivative = 1L) bmatD2 <- bsplineD(x, bknots = bknots, derivative = 2L)  # Verify that we have perfectly fitted splines to the function and its # derivatives. # check that the function f(x) is recovered all.equal(f(x), as.numeric(bmat %*% theta)) #> [1] TRUE all.equal(fprime(x), as.numeric(bmatD1 %*% theta)) #> [1] TRUE all.equal(fdoubleprime(x), as.numeric(bmatD2 %*% theta)) #> [1] TRUE  # Plot the results old_par <- par() par(mfrow = c(1, 3)) plot(x, f(x), type = \"l\", main = bquote(f(x)), ylab = \"\", xlab = \"\") points(x, bmat %*% theta, col = 'blue') grid()  plot(     x   , fprime(x)   , type = \"l\"   , main = bquote(frac(d,dx)~f(x))   , ylab = \"\"   , xlab = \"\" ) points(x, bmatD1 %*% theta, col = 'blue') grid()  plot(     x   , fdoubleprime(x)   , type = \"l\"   , main = bquote(frac(d^2,dx^2)~f(x))   , ylab = \"\"   , xlab = \"\" ) points(x, bmatD2 %*% theta, col = 'blue') grid()   par(old_par) #> Warning: graphical parameter \"cin\" cannot be set #> Warning: graphical parameter \"cra\" cannot be set #> Warning: graphical parameter \"csi\" cannot be set #> Warning: graphical parameter \"cxy\" cannot be set #> Warning: graphical parameter \"din\" cannot be set #> Warning: graphical parameter \"page\" cannot be set  ################################################################################ # Example 2 set.seed(42)  xvec <- seq(0.1, 9.9, length = 1000) iknots <- sort(runif(rpois(1, 3), 1, 9)) bknots <- c(0, 10)  # basis matrix and the first and second derivatives thereof, for cubic # (order = 4) b-splines bmat  <- bsplines(xvec, iknots, bknots = bknots) bmat1 <- bsplineD(xvec, iknots, bknots = bknots, derivative = 1) bmat2 <- bsplineD(xvec, iknots, bknots = bknots, derivative = 2)  # control polygon ordinates theta <- runif(length(iknots) + 4L, -5, 5)  # plot data plot_data <-   data.frame(       Spline            = as.numeric(bmat %*% theta)     , First_Derivative  = as.numeric(bmat1 %*% theta)     , Second_Derivative = as.numeric(bmat2 %*% theta)   ) plot_data <- stack(plot_data) plot_data <- cbind(plot_data, data.frame(x = xvec))  ggplot2::ggplot(plot_data) + ggplot2::theme_bw() + ggplot2::aes(x = x, y = values, color = ind) + ggplot2::geom_line() + ggplot2::geom_hline(yintercept = 0) + ggplot2::geom_vline(xintercept = iknots, linetype = 3)"},{"path":"http://www.peteredewitt.com/cpr/reference/bsplines.html","id":null,"dir":"Reference","previous_headings":"","what":"B-Splines — bsplines","title":"B-Splines — bsplines","text":"implementation Carl de Boor's recursive algorithm building B-splines.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/bsplines.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"B-Splines — bsplines","text":"","code":"bsplines(x, iknots = NULL, df = NULL, bknots = range(x), order = 4L)"},{"path":"http://www.peteredewitt.com/cpr/reference/bsplines.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"B-Splines — bsplines","text":"x numeric vector iknots internal knots df degrees freedom: sum order internal knots.  Ignored iknots specified. bknots boundary knot locations, defaults range(x). order order piecewise polynomials, defaults 4L.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/bsplines.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"B-Splines — bsplines","text":"several differences function bs. important difference two methods treat right-hand end support.  bs uses pivot method allow extrapolation thus returns basis matrix non-zero values exist max(Boundary.knots) (bs version bsplines's bknots).  bsplines use strict definition splines support open right hand side, , bsplines return right-continuous functions. Additionally, attributes object returned bsplines different attributes object returned bs. See vignette(topic = \"cpr\", package = \"cpr\") detailed comparison bsplines bs calls notes B-splines general.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/bsplines.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"B-Splines — bsplines","text":"C. de Boor, \"practical guide splines. Revised Edition,\" Springer, 2001. H. Prautzsch, W. Boehm, M. Paluszny, \"Bezier B-spline Techniques,\" Springer, 2002.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/bsplines.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"B-Splines — bsplines","text":"","code":"# build a vector of values to transform xvec <- seq(-3, 4.9999, length = 100)  # cubic b-spline bmat <- bsplines(xvec, iknots = c(-2, 0, 1.2, 1.2, 3.0), bknots = c(-3, 5)) bmat #> Basis matrix dims: [100 x 9] #> Order: 4 #> Number of internal knots: 5 #>  #> First 6 rows: #>  #>           [,1]      [,2]        [,3]         [,4] [,5] [,6] [,7] [,8] [,9] #> [1,] 1.0000000 0.0000000 0.000000000 0.000000e+00    0    0    0    0    0 #> [2,] 0.7766405 0.2170642 0.006253393 4.187719e-05    0    0    0    0    0 #> [3,] 0.5892937 0.3864632 0.023908015 3.350175e-04    0    0    0    0    0 #> [4,] 0.4347939 0.5127699 0.051305529 1.130684e-03    0    0    0    0    0 #> [5,] 0.3099750 0.6005573 0.086787597 2.680140e-03    0    0    0    0    0 #> [6,] 0.2116711 0.6543984 0.128695884 5.234649e-03    0    0    0    0    0  # plot the splines plot(bmat)                # each spline will be colored by default  plot(bmat, color = FALSE) # black and white plot  plot(bmat, color = FALSE) + ggplot2::aes(linetype = spline) # add a linetype   # Axes # The x-axis, by default, show the knot locations.  Other options are numeric # values, and/or to use a second x-axis  plot(bmat, show_xi = TRUE,  show_x = FALSE) # default, knot, symbols, on lower                                              # axis  plot(bmat, show_xi = FALSE, show_x = TRUE)  # Numeric value for the knot                                              # locations  plot(bmat, show_xi = TRUE,  show_x = TRUE)  # symbols on bottom, numbers on top   # quadratic splines bmat <- bsplines(xvec, iknots = c(-2, 0, 1.2, 1.2, 3.0), order = 3L) #> Warning: At least one x value >= max(bknots) bmat #> Basis matrix dims: [100 x 8] #> Order: 3 #> Number of internal knots: 5 #>  #> First 6 rows: #>  #>           [,1]      [,2]        [,3] [,4] [,5] [,6] [,7] [,8] #> [1,] 1.0000000 0.0000000 0.000000000    0    0    0    0    0 #> [2,] 0.8449156 0.1529078 0.002176594    0    0    0    0    0 #> [3,] 0.7028908 0.2884028 0.008706377    0    0    0    0    0 #> [4,] 0.5739256 0.4064850 0.019589348    0    0    0    0    0 #> [5,] 0.4580200 0.5071545 0.034825508    0    0    0    0    0 #> [6,] 0.3551739 0.5904113 0.054414856    0    0    0    0    0 plot(bmat) + ggplot2::ggtitle(\"Quadratic B-splines\")"},{"path":"http://www.peteredewitt.com/cpr/reference/btensor.html","id":null,"dir":"Reference","previous_headings":"","what":"btensor — btensor","title":"btensor — btensor","text":"Tensor products B-splines.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/btensor.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"btensor — btensor","text":"","code":"btensor(x, df = NULL, iknots = NULL, bknots, order)"},{"path":"http://www.peteredewitt.com/cpr/reference/btensor.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"btensor — btensor","text":"x list variables build B-spline transforms .  tensor product B-splines returned. df degrees freedom.  list degrees freedom marginal. iknots list internal knots x.  omitted, default place internal knots x.  specified, list needs contain internal knots x.  df iknots given, df take precedence. bknots list boundary knots x.  iknots, omitted default use range x.  specified, use must specify bknots x. order list order x; defaults 4L x.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/btensor.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"btensor — btensor","text":"matrix class cpr_bt","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/btensor.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"btensor — btensor","text":"return form function tensor product B-splines transformations given variables.  Say variables X, Y, Z build tensor product .  columns returned matrix correspond column products three B-splines: x1y1z1 x2y1z1 x3y1z1 x4y1z1 x1y2z1 x2y2z1 ... x4y4z4 three fourth order B-splines internal knots.  columns X cycle quickest, followed Y, Z.  result  model.matrix( ~ bsplines(X) : bsplines(Y) : bsplines(Z) + 0) . See vignette(topic = \"cnr\", package = \"cpr\") details.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/btensor.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"btensor — btensor","text":"","code":"tp <- with(mtcars,            btensor(x = list(d = disp, h = hp, m = mpg),                    iknots = list(numeric(0), c(100, 150), numeric(0)))            ) #> Warning: At least one x value >= max(bknots) #> Warning: At least one x value >= max(bknots) #> Warning: At least one x value >= max(bknots) tp #> Tensor Product Matrix dims: [32 x 96] #>"},{"path":"http://www.peteredewitt.com/cpr/reference/build_tensor.html","id":null,"dir":"Reference","previous_headings":"","what":"Build Tensor — build_tensor","title":"Build Tensor — build_tensor","text":"Tensor products Matrices.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/build_tensor.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Build Tensor — build_tensor","text":"","code":"build_tensor(x = NULL, y = NULL, ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/build_tensor.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Build Tensor — build_tensor","text":"x matrix y matrix ... additional numeric matrices build tensor product","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/build_tensor.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Build Tensor — build_tensor","text":"matrix matrix","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/build_tensor.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Build Tensor — build_tensor","text":"","code":"A <- matrix(1:4, nrow = 10, ncol = 20) B <- matrix(1:6, nrow = 10, ncol = 6)  # Two ways of building the same tensor product tensor1 <- build_tensor(A, B) tensor2 <- do.call(build_tensor, list(A, B)) all.equal(tensor1, tensor2) #> [1] TRUE  # a three matrix tensor product tensor3 <- build_tensor(A, B, B) str(tensor3) #>  num [1:10, 1:720] 1 8 27 64 25 72 3 16 9 32 ..."},{"path":"http://www.peteredewitt.com/cpr/reference/cn.html","id":null,"dir":"Reference","previous_headings":"","what":"Control Nets — cn","title":"Control Nets — cn","text":"Generate control net uni-variable B-spline","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cn.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Control Nets — cn","text":"","code":"cn(x, ...)  # S3 method for cpr_bt cn(x, theta, ...)  # S3 method for formula cn(   formula,   data,   method = stats::lm,   method.args = list(),   keep_fit = TRUE,   check_rank = TRUE,   ... )"},{"path":"http://www.peteredewitt.com/cpr/reference/cn.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Control Nets — cn","text":"x cpr_bt object ... pass theta vector (regression) coefficients, ordinates control net. formula formula appropriate regression method used. data required data.frame method regression method lm, glm, lmer, etc. method.args list additional arguments pass regression method. keep_fit (logical, defaults FALSE).  TRUE regression model fit retained returned fit element. FALSE regression model saved fit element NA. check_rank (logical, defaults TRUE) TRUE check design matrix full rank.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cn.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Control Nets — cn","text":"cpr_cn object.  list following elements. elements omitted using cn.cpr_bt method. cn control net, data.frame row defining vertex  control net bspline_list list marginal B-splines call call keep_fit logical, indicates regression models retained fit isTRUE(keep_fit) regression model ,  else NA. coefficients regression coefficients, fixed effects  mixed effects model used. vcov variance-covariance matrix coefficients loglik log-likelihood regression model rse residual standard error regression models","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cn.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Control Nets — cn","text":"cn generates control net given B-spline function.  several methods building control net.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/cn.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Control Nets — cn","text":"","code":"acn <- cn(log10(pdg) ~               btensor(   x     = list(day, age)                       , df     = list(30, 4)                       , bknots = list(c(-1, 1), c(44, 53))               )            , data = spdg) str(acn, max.level = 1) #> List of 12 #>  $ cn          :'data.frame':\t120 obs. of  3 variables: #>  $ bspline_list:List of 2 #>  $ call        : language cn(formula = log10(pdg) ~ btensor(x = list(day, age), df = list(30, 4),      bknots = list(c(-1, 1), c(44, 53))), data = spdg) #>  $ keep_fit    : logi TRUE #>  $ fit         :List of 12 #>   ..- attr(*, \"class\")= chr \"lm\" #>  $ theta       : num [1:120] -8.419 -0.293 -0.519 -0.181 -0.316 ... #>  $ coefficients: Named num [1:120] -8.419 -0.293 -0.519 -0.181 -0.316 ... #>   ..- attr(*, \"names\")= chr [1:120] \"btensor(x = list(day, age), df = list(30, 4), bknots = list(c(-1, 1), c(44, 53)))1\" \"btensor(x = list(day, age), df = list(30, 4), bknots = list(c(-1, 1), c(44, 53)))2\" \"btensor(x = list(day, age), df = list(30, 4), bknots = list(c(-1, 1), c(44, 53)))3\" \"btensor(x = list(day, age), df = list(30, 4), bknots = list(c(-1, 1), c(44, 53)))4\" ... #>  $ vcov        : num [1:120, 1:120] 387.92 -47.33 15.45 -6 2.97 ... #>   ..- attr(*, \"dimnames\")=List of 2 #>  $ vcov_theta  : num [1:120, 1:120] 387.92 -47.33 15.45 -6 2.97 ... #>  $ loglik      : num -7737 #>  $ rss         : num 2703 #>  $ rse         : num 0.332 #>  - attr(*, \"class\")= chr [1:3] \"cpr_cn\" \"cpr_cn\" \"list\""},{"path":"http://www.peteredewitt.com/cpr/reference/cnr.html","id":null,"dir":"Reference","previous_headings":"","what":"Control Net Reduction — cnr","title":"Control Net Reduction — cnr","text":"Run Control Net Reduction Algorithm.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cnr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Control Net Reduction — cnr","text":"","code":"cnr(x, margin, n_polycoef = 20L, progress = c(\"cnr\", \"influence\", \"none\"), ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/cnr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Control Net Reduction — cnr","text":"x cnr_cn object margin margins apply CNR algorithm .  Passed influence_weights. n_polycoef number polynomial coefficients use assessing influence internal knot. progress controls level progress messaging. ... currently used","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cnr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Control Net Reduction — cnr","text":"cpr_cnr object.  list cpr_cn objects.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cnr.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Control Net Reduction — cnr","text":"cnr runs control net reduction algorithm. keep keep regression fit part cnr\\_cp object models including keep fits.  example, keep = 10 resulting cnr\\_cnr object regression fit stored first keep + 1 (zero internal knots, one internal knot, ..., keep internal knots) cnr\\_cp objects list.  limit number stored regression fits keep memory usage .","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/cnr.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Control Net Reduction — cnr","text":"","code":"acn <- cn(log10(pdg) ~ btensor(list(day, age)                                , df = list(10, 8)                                , bknots = list(c(-1, 1), c(44, 53)))          , data = spdg) cnr0 <- cnr(acn) #>    |                                                                               |                                                                      |   0%   |                                                                               |======                                                                |   9%   |                                                                               |=============                                                         |  18%   |                                                                               |===================                                                   |  27%   |                                                                               |=========================                                             |  36%   |                                                                               |================================                                      |  45%   |                                                                               |======================================                                |  55%   |                                                                               |=============================================                         |  64%   |                                                                               |===================================================                   |  73%   |                                                                               |=========================================================             |  82%   |                                                                               |================================================================      |  91%   |                                                                               |======================================================================| 100% cnr0 #> A list of control nets #> List of 11 #>  - attr(*, \"class\")= chr [1:2] \"cpr_cnr\" \"list\" summary(cnr0) #>    dfs    loglik      rss       rse n_iknots1      iknots1 n_iknots2 #> 1   16 -8412.922 2855.385 0.3406112         0                      0 #> 2   20 -8406.155 2853.816 0.3405453         0                      1 #> 3   25 -7964.400 2753.253 0.3345253         1 0.057623....         1 #> 4   30 -7954.317 2750.999 0.3344224         1 0.057623....         2 #> 5   36 -7795.952 2715.846 0.3323194         2 0.057623....         2 #> 6   42 -7793.308 2715.263 0.3323242         2 0.057623....         3 #> 7   49 -7791.974 2714.969 0.3323536         3 -0.79187....         3 #> 8   56 -7791.165 2714.791 0.3323900         4 -0.79187....         3 #> 9   63 -7782.825 2712.953 0.3323248         5 -0.79187....         3 #> 10  70 -7763.444 2708.686 0.3321107         6 -0.79187....         3 #> 11  80 -7761.069 2708.164 0.3321463         6 -0.79187....         4 #>         iknots2 index #> 1                   1 #> 2  47.33451....     2 #> 3  47.33451....     3 #> 4  47.33451....     4 #> 5  47.33451....     5 #> 6  47.33451....     6 #> 7  47.33451....     7 #> 8  47.33451....     8 #> 9  47.33451....     9 #> 10 47.33451....    10 #> 11 47.33451....    11 plot(cnr0)"},{"path":"http://www.peteredewitt.com/cpr/reference/coef_vcov.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract Regression Coefficients for B-Splines and Tensor Products of B-splines — coef_vcov","title":"Extract Regression Coefficients for B-Splines and Tensor Products of B-splines — coef_vcov","text":"S3 method extracting regression coefficients bsplines btensor terms.  Default uses stats::coef extract regression coefficients.  specific method lmerMod objects provided.  using regression method stats::coef return regression coefficients, need define S3 method stats::coef .","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/coef_vcov.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract Regression Coefficients for B-Splines and Tensor Products of B-splines — coef_vcov","text":"","code":"coef_vcov(fit, theta_idx)"},{"path":"http://www.peteredewitt.com/cpr/reference/coef_vcov.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract Regression Coefficients for B-Splines and Tensor Products of B-splines — coef_vcov","text":"fit regression model fit theta_idx numeric index theta related coefs","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/coef_vcov.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract Regression Coefficients for B-Splines and Tensor Products of B-splines — coef_vcov","text":"list four elements theta theta regression coefficients coef regression coefficients vcov_theta subsection variance-covariance matrix pertaining theta values vcov full variance-covariance matrix","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/coef_vcov.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Extract Regression Coefficients for B-Splines and Tensor Products of B-splines — coef_vcov","text":"functions called cp cn calls.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/coef_vcov.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract Regression Coefficients for B-Splines and Tensor Products of B-splines — coef_vcov","text":"","code":"cp0 <- cp(log10(pdg) ~ bsplines(day, df = 6, bknots = c(-1, 1)) + age + ttm, data = spdg) cv <- cpr:::coef_vcov(cp0$fit)  summary(cv) #>            Length Class  Mode    #> theta       8     -none- numeric #> coef        8     -none- numeric #> vcov_theta 64     -none- numeric #> vcov       64     -none- numeric"},{"path":"http://www.peteredewitt.com/cpr/reference/cp.html","id":null,"dir":"Reference","previous_headings":"","what":"Control Polygons — cp","title":"Control Polygons — cp","text":"Generate control polygon uni-variable B-spline","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cp.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Control Polygons — cp","text":"","code":"cp(x, ...)  # S3 method for cpr_bs cp(x, theta, ...)  # S3 method for formula cp(   formula,   data,   method = stats::lm,   method.args = list(),   keep_fit = TRUE,   check_rank = TRUE,   ... )"},{"path":"http://www.peteredewitt.com/cpr/reference/cp.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Control Polygons — cp","text":"x cpr_bs object ... pass theta vector (regression) coefficients, ordinates control polygon. formula formula appropriate regression method used. data required data.frame method regression method lm, glm, lmer, etc. method.args list additional arguments pass regression method. keep_fit (logical, default value TRUE).  TRUE regression model fit retained returned fit element. FALSE fit element NA. check_rank (logical, defaults TRUE) TRUE check design matrix full rank.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cp.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Control Polygons — cp","text":"cpr_cp object, list element cp, data.frame reporting x y coordinates control polygon. Additional elements include knot sequence, polynomial order, meta data regarding construction control polygon.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cp.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Control Polygons — cp","text":"cp generates control polygon given B-spline function.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cp.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Control Polygons — cp","text":"","code":"# Support xvec <- runif(n = 500, min = 0, max = 6) bknots <- c(0, 6)  # Define the basis matrix bmat1 <- bsplines(x = xvec, iknots = c(1, 1.5, 2.3, 4, 4.5), bknots = bknots) bmat2 <- bsplines(x = xvec, bknots = bknots)  # Define the control vertices ordinates theta1 <- c(1, 0, 3.5, 4.2, 3.7, -0.5, -0.7, 2, 1.5) theta2 <- c(1, 3.4, -2, 1.7)  # build the two control polygons cp1 <- cp(bmat1, theta1) cp2 <- cp(bmat2, theta2)  # black and white plot plot(cp1)  plot(cp1, show_spline = TRUE)   # multiple control polygons plot(cp1, cp2, show_spline = TRUE)  plot(cp1, cp2, color = TRUE)  plot(cp1, cp2, show_spline = TRUE, color = TRUE)   # via formula DF  <- data.frame(x = xvec, y = sin((xvec - 2)/pi) + 1.4 * cos(xvec/pi)) cp3 <- cp(y ~ bsplines(x, bknots = bknots), data = DF)  # plot the spline and target data. plot(cp3, show_cp = FALSE, show_spline = TRUE) +   ggplot2::geom_line(mapping = ggplot2::aes(x = x, y = y, color = \"Target\"),                      data = DF, linetype = 2)"},{"path":"http://www.peteredewitt.com/cpr/reference/cp_diff.html","id":null,"dir":"Reference","previous_headings":"","what":"Vertical Difference between two Control Polygons — cp_diff","title":"Vertical Difference between two Control Polygons — cp_diff","text":"Vertical Difference two Control Polygons","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cp_diff.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Vertical Difference between two Control Polygons — cp_diff","text":"","code":"cp_diff(cp1, cp2)"},{"path":"http://www.peteredewitt.com/cpr/reference/cp_diff.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Vertical Difference between two Control Polygons — cp_diff","text":"cp1 cpr_cp object cp2 cpr_cp object","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cp_diff.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Vertical Difference between two Control Polygons — cp_diff","text":"vertical distance control vertices cp1 control polygon cp2.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/cp_diff.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Vertical Difference between two Control Polygons — cp_diff","text":"","code":"xvec <- runif(n = 500, min = 0, max = 6)  # Define the basis matrix bmat1 <- bsplines(x = xvec, iknots = c(1, 1.5, 2.3, 4, 4.5), bknots = c(0, 6)) bmat2 <- bsplines(x = xvec, bknots = c(0, 6))  # Define the control vertices ordinates theta1 <- c(1, 0, 3.5, 4.2, 3.7, -0.5, -0.7, 2, 1.5) theta2 <- c(1, 3.4, -2, 1.7)  # build the two control polygons cp1 <- cp(bmat1, theta1) cp2 <- cp(bmat2, theta2)  cp_diff(cp1, cp2) #> [1]  0.0000000  1.4000000 -1.5000000 -1.2800000 -1.9200000 -0.4200000  0.2416667 #> [8] -1.2250000  0.2000000  df <- data.frame(x = cp1$cp$xi_star,                  y = cp1$cp$theta,                  yend = cp1$cp$theta + cp_diff(cp1, cp2))   plot(cp1, cp2) + ggplot2::geom_segment(data = df   , mapping = ggplot2::aes(x = x, xend = x, y = y, yend = yend)   , color = \"red\"   , inherit.aes = FALSE)"},{"path":"http://www.peteredewitt.com/cpr/reference/cp_value.html","id":null,"dir":"Reference","previous_headings":"","what":"Control Polygon Value — cp_value","title":"Control Polygon Value — cp_value","text":"Find y value Control Polygon given x","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cp_value.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Control Polygon Value — cp_value","text":"","code":"cp_value(obj, x)"},{"path":"http://www.peteredewitt.com/cpr/reference/cp_value.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Control Polygon Value — cp_value","text":"obj cpr_cp object data.frame first column abscissa second column ordinate control polygon vertices. x abscissa determine ordinate control polygon cp","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cp_value.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Control Polygon Value — cp_value","text":"cp_value returns ordinate control polygon line segment abscissa x given.  x control vertex line segment defined two control vertices control polygon provided. cp_diff returns vertical distance control vertices cp1 control polygon cp2.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/cp_value.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Control Polygon Value — cp_value","text":"","code":"xvec <- seq(0, 6, length = 500)  # Define the basis matrix bmat1 <- bsplines(x = xvec, iknots = c(1, 1.5, 2.3, 4, 4.5)) #> Warning: At least one x value >= max(bknots) bmat2 <- bsplines(x = xvec) #> Warning: At least one x value >= max(bknots)  # Define the control vertices ordinates theta1 <- c(1, 0, 3.5, 4.2, 3.7, -0.5, -0.7, 2, 1.5) theta2 <- c(1, 3.4, -2, 1.7)  # build the two control polygons cp1 <- cp(bmat1, theta1) cp2 <- cp(bmat2, theta2)  x <- c(0.2, 0.8, 1.3, 1.73, 2.15, 3.14, 4.22, 4.88, 5.3, 5.9) cp_value(cp1, x = x) #>  [1]  0.4000000  3.2666667  3.9260870  4.1350000  3.9250000  1.4320000 #>  [7] -0.6005405 -0.5110000  1.1900000  1.6000000  df <- data.frame(x = x, y = cp_value(cp1, x = x))  plot(cp1, show_x = TRUE, show_spline = TRUE) + ggplot2::geom_point(data = df   , mapping = ggplot2::aes(x = x, y = y)   , color = \"red\"   , shape = 4   , size = 3   , inherit.aes = FALSE)"},{"path":"http://www.peteredewitt.com/cpr/reference/cpr-defunct.html","id":null,"dir":"Reference","previous_headings":"","what":"Defunct Functions — cpr-defunct","title":"Defunct Functions — cpr-defunct","text":"major refactor package v0.3.0 v.0.4.0 took place many functions made defunct.  refactor extensive moving functions deprecated viable option.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cpr-defunct.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Defunct Functions — cpr-defunct","text":"","code":"refine_ordinate(...)  coarsen_ordinate(...)  hat_ordinate(...)  insertion_matrix(...)  wiegh_iknots(...)  influence_of(...)  influence_weights(...)"},{"path":"http://www.peteredewitt.com/cpr/reference/cpr-defunct.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Defunct Functions — cpr-defunct","text":"... pass ","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cpr-package.html","id":null,"dir":"Reference","previous_headings":"","what":"cpr: Control Polygon Reduction — cpr-package","title":"cpr: Control Polygon Reduction — cpr-package","text":"cpr package implements control polygon reduction control net reduction methods finding parsimonious B-spline regression models described DeWitt (2017).","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cpr-package.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"cpr: Control Polygon Reduction — cpr-package","text":"DeWitt, Peter Edward. “Parsimonious B-spline regression models via control polygon control net reduction identifying factors explaining variation daily hormone profiles menopausal transition.” (2017).","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/cpr-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"cpr: Control Polygon Reduction — cpr-package","text":"Maintainer: Peter DeWitt dewittpe@gmail.com (ORCID) contributors: Samantha MaWhinney sam.mawhinney@ucdenver.edu [thesis advisor] Nichole Carlson nichole.carlson@ucdenver.edu [thesis advisor]","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cpr.html","id":null,"dir":"Reference","previous_headings":"","what":"Control Polygon Reduction — cpr","title":"Control Polygon Reduction — cpr","text":"Run Control Polygon Reduction Algorithm.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cpr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Control Polygon Reduction — cpr","text":"","code":"cpr(x, progress = c(\"cpr\", \"influence\", \"none\"), ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/cpr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Control Polygon Reduction — cpr","text":"x cpr_cp object progress controls level progress messaging.  See Details. ... currently used","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cpr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Control Polygon Reduction — cpr","text":"list cpr_cp objects","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/cpr.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Control Polygon Reduction — cpr","text":"cpr runs control polygon reduction algorithm. algorithm genarlly speaking fast, can take long time run number interior knots initial control polygon high.  help track progress execution can progress = \"cpr\" show progress bar incremented interation CPR algorithm.  progress = \"influence\" use conbination messages progress bars report step assessing influce internal knots iteration CPR algorithm.  See influence_of_iknots details.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/cpr.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Control Polygon Reduction — cpr","text":"","code":"############################################################################# # Example 1: find a model for log10(pdg) = f(day) from the spdg data set if (FALSE) { # need the lme4 package to fit a mixed effect model require(lme4)  # construct the initial control polygon.  Forth order spline with fifty # internal knots.  Remember degrees of freedom equal the polynomial order # plus number of internal knots. init_cp <- cp(log10(pdg) ~ bsplines(day, df = 24, bknots = c(-1, 1)) + (1|id),               data = spdg, method = lme4::lmer) cpr_run <- cpr(init_cp) plot(cpr_run, color = TRUE)  s <- summary(cpr_run) s plot(s, type = \"rse\")  # preferable model is in index 5 by eye preferable_cp <- cpr_run[[\"cps\"]][[5]] }  ############################################################################# # Example 2: logistic regression # simulate a binary response Pr(y = 1 | x) = p(x) p <- function(x) { 0.65 * sin(x * 0.70) + 0.3 * cos(x * 4.2) }  set.seed(42) x <- runif(2500, 0.00, 4.5) sim_data <- data.frame(x = x, y = rbinom(2500, 1, p(x)))  # Define the initial control polygon init_cp <- cp(formula = y ~ bsplines(x, df = 24, bknots = c(0, 4.5)),               data    = sim_data,               method  = glm,               method.args = list(family  = binomial())               )  # run CPR cpr_run <- cpr(init_cp) #>    |                                                                               |                                                                      |   0%   |                                                                               |===                                                                   |   5%   |                                                                               |=======                                                               |  10%   |                                                                               |==========                                                            |  14%   |                                                                               |=============                                                         |  19%   |                                                                               |=================                                                     |  24%   |                                                                               |====================                                                  |  29%   |                                                                               |=======================                                               |  33%   |                                                                               |===========================                                           |  38%   |                                                                               |==============================                                        |  43%   |                                                                               |=================================                                     |  48%   |                                                                               |=====================================                                 |  52%   |                                                                               |========================================                              |  57%   |                                                                               |===========================================                           |  62%   |                                                                               |===============================================                       |  67%   |                                                                               |==================================================                    |  71%   |                                                                               |=====================================================                 |  76%   |                                                                               |=========================================================             |  81%   |                                                                               |============================================================          |  86%   |                                                                               |===============================================================       |  90%   |                                                                               |===================================================================   |  95%   |                                                                               |======================================================================| 100%  # preferable model is in index 6 s <- summary(cpr_run) plot(s, color = TRUE, type = \"rse\")   plot(     cpr_run   , color = TRUE   , from = 5   , to = 7   , show_spline = TRUE   , show_cp = FALSE   ) #> Error in eval(expr): object 'cpr_run' not found   # plot the fitted spline and the true p(x) sim_data$pred_select_p <- plogis(predict(cpr_run[[7]], newdata = sim_data))  ggplot2::ggplot(sim_data) + ggplot2::theme_bw() + ggplot2::aes(x = x) + ggplot2::geom_point(mapping = ggplot2::aes(y = y), alpha = 0.1) + ggplot2::geom_line(     mapping = ggplot2::aes(y = pred_select_p, color = \"pred_select_p\")   ) + ggplot2::stat_function(fun = p, mapping = ggplot2::aes(color = 'p(x)'))   # compare to gam and a binned average sim_data$x2 <- round(sim_data$x, digits = 1) bin_average <-   lapply(split(sim_data, sim_data$x2), function(x) {            data.frame(x = x$x2[1], y = mean(x$y))          }) bin_average <- do.call(rbind, bin_average)  ggplot2::ggplot(sim_data) + ggplot2::theme_bw() + ggplot2::aes(x = x) + ggplot2::stat_function(fun = p, mapping = ggplot2::aes(color = 'p(x)')) + ggplot2::geom_line(     mapping = ggplot2::aes(y = pred_select_p, color = \"pred_select_p\")   ) + ggplot2::stat_smooth(mapping = ggplot2::aes(y = y, color = \"gam\"),                      method = \"gam\",                      formula = y ~ s(x, bs = \"cs\"),                      se = FALSE,                      n = 1000) + ggplot2::geom_line(data = bin_average                    , mapping = ggplot2::aes(y = y, color = \"bin_average\"))"},{"path":"http://www.peteredewitt.com/cpr/reference/generate_cp_formula_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Generate Control Polygon Formula and Data — generate_cp_formula_data","title":"Generate Control Polygon Formula and Data — generate_cp_formula_data","text":"Construct data.frame formula passed regression modeling tool generate control polygon.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/generate_cp_formula_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Generate Control Polygon Formula and Data — generate_cp_formula_data","text":"","code":"generate_cp_formula_data(f, data, formula_only = FALSE, envir = parent.frame())"},{"path":"http://www.peteredewitt.com/cpr/reference/generate_cp_formula_data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Generate Control Polygon Formula and Data — generate_cp_formula_data","text":"f formula data data set containing variables formula formula_only TRUE generate formula, FALSE, generate assign data set . envir environment generated formula data set assigned .","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/generate_cp_formula_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Generate Control Polygon Formula and Data — generate_cp_formula_data","text":"TRUE, invisibly.  return needed assignment happens within call.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/generate_cp_formula_data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Generate Control Polygon Formula and Data — generate_cp_formula_data","text":"function expected called within cp function expected called end user directly. generate_cp_data exists need build considered varying means model.  y ~ bsplines(x1) + x2 generate rank deficient model matrix---rows bspline basis matrix sum one perfectly collinear implicit intercept term.  Specifying formula y ~ bsplines(x1) + x2 - 1 work x2 continuous variable.  , however, x2 factor, coerced factor, model matrix rank deficient column levels factor generated.  need replace intercept column model matrix bspline.  also needs done variety possible model calls, lm, lmer, etc. returning explicit formula data.frame use fit, hope reduce memory use increase speed cpr method. need know method method.args build data set.  example, geeglm id variable needed data set part method.args formula.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/generate_cp_formula_data.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Generate Control Polygon Formula and Data — generate_cp_formula_data","text":"","code":"data <-    data.frame(                 x1 = runif(20)               , x2 = runif(20)               , x3 = runif(20)               , xf = factor(rep(c(\"l1\",\"l2\",\"l3\",\"l4\"), each = 5))               , xc = rep(c(\"c1\",\"c2\",\"c3\",\"c4\", \"c5\"), each = 4)               , pid = gl(n = 2, k = 10)               , pid2 = rep(1:2, each = 10)    )   f <- ~ bsplines(x1, bknots = c(0,1)) + x2 + xf + xc + (x3 | pid2)   cpr:::generate_cp_formula_data(f, data)   stopifnot(isTRUE(    all.equal(              f_for_use              ,              . ~ bsplines(x1, bknots = c(0, 1)) + x2 + (x3 | pid2) + xfl2 +                  xfl3 + xfl4 + xcc2 + xcc3 + xcc4 + xcc5 - 1              )  ))   stopifnot(isTRUE(identical(    names(data_for_use)    ,    c(\"x1\", \"x2\", \"x3\", \"pid\", \"pid2\", \"xfl2\", \"xfl3\", \"xfl4\"      , \"xcc2\" , \"xcc3\", \"xcc4\", \"xcc5\")  )))"},{"path":"http://www.peteredewitt.com/cpr/reference/get_spline.html","id":null,"dir":"Reference","previous_headings":"","what":"Get the Control Polygon and the Spline Function — get_spline","title":"Get the Control Polygon and the Spline Function — get_spline","text":"Generate data.frames interpolating plotting spline function, given cpr_cp cpr_cn object.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/get_spline.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get the Control Polygon and the Spline Function — get_spline","text":"","code":"get_spline(x, margin = 1, at, n = 100, se = FALSE, derivative = 0)"},{"path":"http://www.peteredewitt.com/cpr/reference/get_spline.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get the Control Polygon and the Spline Function — get_spline","text":"x cpr_cp cpr_cn object. margin integer identifying marginal control net slice along.  used working x cpr_cn object. point value marginals defined margin.  used x cpr_cn object.  Expected input list length length(attr(x, \"bspline_list\")).  Entries elements marginal ignored.  omitted, midpoint boundary knots marginal used. n length sequence use interpolating spline function. se TRUE return estimated standard error spline derivative. derivative value 0 (default) returns spline, 1 first derivative, 2 second derivative.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/get_spline.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get the Control Polygon and the Spline Function — get_spline","text":"data.frame  n rows two columns x y, values spline.  third column standard error returned requested.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/get_spline.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Get the Control Polygon and the Spline Function — get_spline","text":"control polygon, cpr\\_cp object, spline function f(x). get_spline returns list two data.frame.  cp element data.frame (x, y) coordinates control points spline element data.frame n rows interpolating f(x). control net, cpr\\_cn object, return cpr\\_cp object, conceptually different.  cpr\\_cp objects uni-variable spline function, cpr\\_cn multi-variable spline surfaces.  get_spline returns \"slice\" higher dimensional object.  example, consider three-dimensional control net defined unit cube marginals x1, x2, x3.  implied spline surface function f(x1, x2, x3). get_spline(x, margin = 2, = list(0.2, NA, 0.5)) return control polygon spline surface f(0.2, x, 0.5). See get_surface taking two-dimensional slice three-plus dimensional control net, , generating useful data set plotting surface two-dimensional control net.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/get_spline.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get the Control Polygon and the Spline Function — get_spline","text":"","code":"data(spdg, package = \"cpr\")  ## Extract the control polygon and spline for plotting.  We'll use base R ## graphics for this example. a_cp <- cp(pdg ~ bsplines(day, df = 10, bknots = c(-1, 1)), data = spdg)  spline <- get_spline(a_cp) plot(spline$x, spline$y, type = \"l\")   # compare to the plot.cpr_cp method plot(a_cp, show_spline = TRUE)   # derivatives f0 <- function(x) {   #(x + 2) * (x - 1) * (x - 3)   x^3 - 2 * x^2 - 5 * x + 6 } f1 <- function(x) {   3 * x^2 - 4 * x - 5 } f2 <- function(x) {   6 * x - 4 }  x <- sort(runif(n = 100, min = -3, max = 5)) bknots = c(-3, 5) bmat <- bsplines(x, bknots = bknots) theta <- coef(lm(f0(x) ~ bsplines(x, bknots = bknots) + 0) )  cp0 <- cp(bmat, theta) spline0 <- get_spline(cp0, derivative = 0) spline1 <- get_spline(cp0, derivative = 1) spline2 <- get_spline(cp0, derivative = 2)  old_par <- par()  par(mfrow = c(1, 3)) plot(x, f0(x), type = \"l\", main = \"spline\") points(spline0$x, spline0$y, pch = 2, col = 'blue')  plot(x, f1(x), type = \"l\", main = \"first derivative\") points(spline1$x, spline1$y, pch = 2, col = 'blue')  plot(x, f2(x), type = \"l\", main = \"second derivative\") points(spline2$x, spline2$y, pch = 2, col = 'blue')   par(old_par) #> Warning: graphical parameter \"cin\" cannot be set #> Warning: graphical parameter \"cra\" cannot be set #> Warning: graphical parameter \"csi\" cannot be set #> Warning: graphical parameter \"cxy\" cannot be set #> Warning: graphical parameter \"din\" cannot be set #> Warning: graphical parameter \"page\" cannot be set"},{"path":"http://www.peteredewitt.com/cpr/reference/get_surface.html","id":null,"dir":"Reference","previous_headings":"","what":"Get Surface — get_surface","title":"Get Surface — get_surface","text":"Get Two-Dimensional Control Net Surface n-dimensional Control Nets","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/get_surface.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get Surface — get_surface","text":"","code":"get_surface(x, margin = 1:2, at, n = 100)"},{"path":"http://www.peteredewitt.com/cpr/reference/get_surface.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get Surface — get_surface","text":"x cpr_cn object margin integer identifying marginal control net slice along.  used working x cpr_cn object. point value marginals defined margin.  used x cpr_cn object.  Expected input list length length(attr(x, \"bspline_list\")).  Entries elements marginal ignored.  omitted, midpoint boundary knots marginal used. n length sequence use interpolating spline function.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/get_surface.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get Surface — get_surface","text":"list two elements cn control net surface data.frame three columns define surface","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/get_surface.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get Surface — get_surface","text":"","code":"## Extract the control net and surface from a cpr_cn object. a_cn <- cn(log10(pdg) ~ btensor(list(day, age, ttm)            , df = list(15, 3, 5)            , bknots = list(c(-1, 1), c(45, 53), c(-9, -1))            , order = list(3, 2, 3))            , data = spdg)  cn_and_surface <- get_surface(a_cn, n = 50) str(cn_and_surface, max.level = 2) #> List of 2 #>  $ cn     :'data.frame':\t45 obs. of  3 variables: #>   ..$ Var1: num [1:45] -1 -0.94 -0.829 -0.726 -0.619 ... #>   ..$ Var2: num [1:45] 45 45 45 45 45 45 45 45 45 45 ... #>   ..$ z   : num [1:45] -0.0363 -0.0704 -0.1904 -0.3311 -0.3755 ... #>  $ surface:'data.frame':\t10000 obs. of  3 variables: #>   ..$ Var1: num [1:10000] -1 -0.98 -0.96 -0.939 -0.919 ... #>   ..$ Var2: num [1:10000] 45 45 45 45 45 45 45 45 45 45 ... #>   ..$ z   : num [1:10000] -0.0363 -0.0455 -0.0571 -0.0712 -0.0878 ...  old_par <- par() par(mfrow = c(1, 2)) with(cn_and_surface$cn,      plot3D::persp3D(unique(Var1),                      unique(Var2),                      matrix(z,                             nrow = length(unique(Var1)),                             ncol = length(unique(Var2))),                      main = \"Control Net\")      ) #> Warning: no DISPLAY variable so Tk is not available with(cn_and_surface$surface,      plot3D::persp3D(unique(Var1),                      unique(Var2),                      matrix(z,                             nrow = length(unique(Var1)),                             ncol = length(unique(Var2))),                      main = \"Surface\")      )   par(old_par) #> Warning: graphical parameter \"cin\" cannot be set #> Warning: graphical parameter \"cra\" cannot be set #> Warning: graphical parameter \"csi\" cannot be set #> Warning: graphical parameter \"cxy\" cannot be set #> Warning: graphical parameter \"din\" cannot be set #> Warning: graphical parameter \"page\" cannot be set"},{"path":"http://www.peteredewitt.com/cpr/reference/iknots_or_df.html","id":null,"dir":"Reference","previous_headings":"","what":"Internal Knots or Degrees of Freedom — iknots_or_df","title":"Internal Knots or Degrees of Freedom — iknots_or_df","text":"Check order, degrees freedom (df) iknots","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/iknots_or_df.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Internal Knots or Degrees of Freedom — iknots_or_df","text":"","code":"iknots_or_df(x, iknots, df, order)"},{"path":"http://www.peteredewitt.com/cpr/reference/iknots_or_df.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Internal Knots or Degrees of Freedom — iknots_or_df","text":"x support - numeric vector iknots internal knots - numeric vector df degrees freedom - numeric value length 1 order polynomial order","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/iknots_or_df.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Internal Knots or Degrees of Freedom — iknots_or_df","text":"numeric vector use internal knots defining B-spline.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/iknots_or_df.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Internal Knots or Degrees of Freedom — iknots_or_df","text":"internal function, exported, used calls bsplines bsplineD. Use iknots preferentially.  iknots provided return trimmed_quantile appropriate df order","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/iknots_or_df.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Internal Knots or Degrees of Freedom — iknots_or_df","text":"","code":"xvec <- runif(600, min = 0, max = 3)  # return the iknots cpr:::iknots_or_df(x = xvec, iknots = 1:2, df = NULL, order = NULL) #> [1] 1 2  # return the iknots even when the df and order are provided cpr:::iknots_or_df(x = xvec, iknots = 1:2, df = 56, order = 12) #> Warning: Both iknots and df defined, using iknots #> [1] 1 2  # return numeric(0) when df <= order (df < order will also give a warning) cpr:::iknots_or_df(x = xvec, iknots = NULL, df = 6, order = 6) #> numeric(0)  # return trimmed_quantile when df > order # probs = (df - order) / (df - order + 1) cpr:::iknots_or_df(x = xvec, iknots = NULL, df = 10, order = 4) #> 14.28571% 28.57143% 42.85714% 57.14286% 71.42857% 85.71429%  #> 0.4576623 0.9097725 1.3163082 1.7251498 2.1546635 2.5640816  cpr::trimmed_quantile(xvec, probs = 1:6 / 7) #> 14.28571% 28.57143% 42.85714% 57.14286% 71.42857% 85.71429%  #> 0.4576623 0.9097725 1.3163082 1.7251498 2.1546635 2.5640816"},{"path":"http://www.peteredewitt.com/cpr/reference/influence_of_iknots.html","id":null,"dir":"Reference","previous_headings":"","what":"Determine the influence of the internal knots of a control polygon — influence_of_iknots","title":"Determine the influence of the internal knots of a control polygon — influence_of_iknots","text":"Determine influence internal knots control polygon","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/influence_of_iknots.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Determine the influence of the internal knots of a control polygon — influence_of_iknots","text":"","code":"influence_of_iknots(x, verbose = FALSE, ...)  # S3 method for cpr_cn influence_of_iknots(   x,   verbose = FALSE,   margin = seq_along(x$bspline_list),   n_polycoef = 20L,   ... )"},{"path":"http://www.peteredewitt.com/cpr/reference/influence_of_iknots.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Determine the influence of the internal knots of a control polygon — influence_of_iknots","text":"x cpr_cp cpr_cn object verbose print status messages ... pass margin margin(s) consider influence iknots n_polycoef number polynomial coefficients use assessing influence iknot","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/influence_of_iknots.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Determine the influence of the internal knots of a control polygon — influence_of_iknots","text":"cpr_influence_of_iknots object.  list six elements: original_cp  coarsened_cps  restored_cps  d  influence  chisq","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/influence_of_iknots.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Determine the influence of the internal knots of a control polygon — influence_of_iknots","text":"","code":"x <- seq(0 + 1/5000, 6 - 1/5000, length.out = 5000) bmat <- bsplines(x, iknots = c(1, 1.5, 2.3, 4, 4.5), bknots = c(0, 6)) theta <- matrix(c(1, 0, 3.5, 4.2, 3.7, -0.5, -0.7, 2, 1.5), ncol = 1) cp0 <- cp(bmat, theta)  icp0 <- influence_of_iknots(cp0)  plot(cp0, icp0$coarsened_cps[[1]], icp0$restored_cps[[1]], color = TRUE, show_spline = TRUE)  plot(cp0, icp0$restored_cps[[1]], color = TRUE, show_spline = TRUE)   plot(cp0, icp0$coarsened_cps[[2]], icp0$restored_cps[[2]], color = TRUE, show_spline = TRUE)  plot(cp0, icp0$restored_cps[[2]], color = TRUE, show_spline = TRUE)   plot(cp0, icp0$coarsened_cps[[3]], icp0$restored_cps[[3]], color = TRUE, show_spline = TRUE)  plot(cp0, icp0$restored_cps[[3]], color = TRUE, show_spline = TRUE)   plot(cp0, icp0$coarsened_cps[[4]], icp0$restored_cps[[4]], color = TRUE, show_spline = TRUE)  plot(cp0, icp0$restored_cps[[4]], color = TRUE, show_spline = TRUE)   plot(cp0, icp0$coarsened_cps[[5]], icp0$restored_cps[[5]], color = TRUE, show_spline = TRUE)  plot(cp0, icp0$restored_cps[[5]], color = TRUE, show_spline = TRUE)   # When the cp was defined by regression df <- data.frame(x = x, y = as.numeric(bmat %*% theta) + rnorm(5000, sd = 0.2)) cp1 <- cp(y ~ bsplines(x, iknots = c(1, 1.5, 2.3, 3, 4, 4.5), bknots = c(0, 6)), data = df) icp1 <- influence_of_iknots(cp1) icp1 #>         xi_5         xi_6         xi_7         xi_8         xi_9        xi_10  #> 1.541257e+00 2.123213e-01 6.530531e-02 8.792049e-05 2.306098e-02 2.712189e-01"},{"path":"http://www.peteredewitt.com/cpr/reference/insert_a_knot.html","id":null,"dir":"Reference","previous_headings":"","what":"Insert a Knot into a Control Polygon — insert_a_knot","title":"Insert a Knot into a Control Polygon — insert_a_knot","text":"Insert knot control polygon without changing spline","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/insert_a_knot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Insert a Knot into a Control Polygon — insert_a_knot","text":"","code":"insert_a_knot(x, xi_prime, ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/insert_a_knot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Insert a Knot into a Control Polygon — insert_a_knot","text":"x cpr_cp object xi_prime value knot insert ... currently used","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/insert_a_knot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Insert a Knot into a Control Polygon — insert_a_knot","text":"cpr_cp object","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/insert_a_knot.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Insert a Knot into a Control Polygon — insert_a_knot","text":"","code":"x <- seq(1e-5, 5.99999, length.out = 100) bmat <- bsplines(x, iknots = c(1, 1.5, 2.3, 4, 4.5), bknots = c(0, 6)) theta <- matrix(c(1, 0, 3.5, 4.2, 3.7, -0.5, -0.7, 2, 1.5), ncol = 1) cp0 <- cp(bmat, theta) cp1 <- insert_a_knot(x = cp0, xi_prime = 3) plot(cp0, cp1, color = TRUE, show_spline = TRUE)"},{"path":"http://www.peteredewitt.com/cpr/reference/knot_expr.html","id":null,"dir":"Reference","previous_headings":"","what":"Knot Expressions — knot_expr","title":"Knot Expressions — knot_expr","text":"Non-exported function used build expressions knot sequences labeled well plot.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/knot_expr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Knot Expressions — knot_expr","text":"","code":"knot_expr(x, digits)"},{"path":"http://www.peteredewitt.com/cpr/reference/knot_expr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Knot Expressions — knot_expr","text":"x cpr_cp cpr_bs object digits digits right decimal point report","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/knot_expr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Knot Expressions — knot_expr","text":"list","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/knot_expr.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Knot Expressions — knot_expr","text":"","code":"bmat <- bsplines(mtcars$hp, df = 8, bknots = c(50, 350)) ke <- cpr:::knot_expr(bmat, digits = 1) summary(ke) #>          Length Class  Mode      #> breaks   6      -none- numeric   #> xi_expr  6      -none- list      #> num_expr 6      -none- character  plot(x = ke$breaks, y = rep(1, length(ke$breaks)), type = \"n\") text(        x = ke$breaks      , y = rep(1, length(ke$breaks))      , labels = parse(text = ke$xi_expr) )"},{"path":"http://www.peteredewitt.com/cpr/reference/loglikelihood.html","id":null,"dir":"Reference","previous_headings":"","what":"Determine the (quasi) Log Likelihood for a regression object. — loglikelihood","title":"Determine the (quasi) Log Likelihood for a regression object. — loglikelihood","text":"Return, via logLik custom S3 method, (quasi) log likelihood regression object.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/loglikelihood.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Determine the (quasi) Log Likelihood for a regression object. — loglikelihood","text":"","code":"loglikelihood(x, ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/loglikelihood.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Determine the (quasi) Log Likelihood for a regression object. — loglikelihood","text":"x regression fit object ... passed logLik","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/loglikelihood.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Determine the (quasi) Log Likelihood for a regression object. — loglikelihood","text":"numeric value (quasi) log likelihood.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/loglikelihood.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Determine the (quasi) Log Likelihood for a regression object. — loglikelihood","text":"function used cpr cnr determine (quasi) log likelihood returned cpr_cpr cpr_cnr objects. Generally function defaults logLik.  Therefore, S3 method determining (quasi) log likelihood exists workspace everything work.  S3 method exist define one. See methods(loglikelihood) list provided methods.  default method uses logLik.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/loglikelihood.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Determine the (quasi) Log Likelihood for a regression object. — loglikelihood","text":"","code":"fit <- lm(mpg ~ wt, data = mtcars) stats::logLik(fit) #> 'log Lik.' -80.01471 (df=3) cpr:::loglikelihood(fit) #> [1] -80.01471"},{"path":"http://www.peteredewitt.com/cpr/reference/matrix_rank.html","id":null,"dir":"Reference","previous_headings":"","what":"Rank of a Matrix — matrix_rank","title":"Rank of a Matrix — matrix_rank","text":"Determine rank (number linearly independent columns) matrix.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/matrix_rank.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Rank of a Matrix — matrix_rank","text":"","code":"matrix_rank(x)"},{"path":"http://www.peteredewitt.com/cpr/reference/matrix_rank.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Rank of a Matrix — matrix_rank","text":"x numeric matrix","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/matrix_rank.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Rank of a Matrix — matrix_rank","text":"rank matrix numeric value.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/matrix_rank.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Rank of a Matrix — matrix_rank","text":"Implementation via Armadillo C++ linear algebra library.  function returns rank matrix x.  computation based singular value decomposition matrix; std::runtime_error exception thrown decomposition fails.  singular values less tolerance treated zeros.  tolerance max(m, n) * max_sv * arma::datum::eps, m number rows x, n number columns x, max_sv maximal singular value x, arma::datum::eps difference 1 least value greater 1 representable.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/matrix_rank.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Rank of a Matrix — matrix_rank","text":"Conrad Sanderson Ryan Curtin.  Armadillo: template-based C++ library linear algebra.  Journal Open Source Software, Vol. 1, pp. 26, 2016.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/matrix_rank.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Rank of a Matrix — matrix_rank","text":"","code":"# Check the rank of a matrix set.seed(42) mat <- matrix(rnorm(25000 * 120), nrow = 25000) matrix_rank(mat) == ncol(mat) #> [1] TRUE matrix_rank(mat) == 120L #> [1] TRUE  # A full rank B-spline basis bmat <- bsplines(seq(0, 1, length = 100), df = 15) #> Warning: At least one x value >= max(bknots) matrix_rank(bmat) == 15L #> [1] TRUE  # A rank deficient B-spline basis bmat <- bsplines(seq(0, 1, length = 100), iknots = c(0.001, 0.002)) #> Warning: At least one x value >= max(bknots) ncol(bmat) == 6L #> [1] TRUE matrix_rank(bmat) == 5L #> [1] TRUE"},{"path":"http://www.peteredewitt.com/cpr/reference/newknots.html","id":null,"dir":"Reference","previous_headings":"","what":"New Knots for CPs and CNs in CPR and CNR — newknots","title":"New Knots for CPs and CNs in CPR and CNR — newknots","text":"Non-exported function, newknots used cpr cnr calls.  Used create new control polygon control net different internal knots.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/newknots.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"New Knots for CPs and CNs in CPR and CNR — newknots","text":"","code":"newknots(form, nk)"},{"path":"http://www.peteredewitt.com/cpr/reference/newknots.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"New Knots for CPs and CNs in CPR and CNR — newknots","text":"form formula nk numeric vector, list numeric vectors, used bsplines btensor call, respectively.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/newknots.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"New Knots for CPs and CNs in CPR and CNR — newknots","text":"Expected use within cpr cnr calls.  return object formula define control polygon/net different knots ones found within form.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/newknots.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"New Knots for CPs and CNs in CPR and CNR — newknots","text":"Think function analogue stats{update} calls.  stats{update} modify call, newknots update just iknots argument bsplines btensor call within formula argument cp cn call.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/newknots.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"New Knots for CPs and CNs in CPR and CNR — newknots","text":"","code":"cp0 <- cp(log(pdg) ~ bsplines(day, iknots = c(-.25, 0, 0.25), bknots = c(-1, 1)), data = spdg)  new_knots <- c(-0.85, 0, 0.25, 0.3) f <- cpr:::newknots(cp0$call$formula, nk = new_knots) f #> log(pdg) ~ bsplines(day, iknots = c(-0.85, 0, 0.25, 0.3), bknots = c(-1,  #>     1)) #> NULL cp(f, data = spdg) #>      xi_star        theta #> 1 -1.0000000 -0.007699847 #> 2 -0.9500000 -0.439608186 #> 3 -0.6166667 -1.086005675 #> 4 -0.2000000 -1.657347591 #> 5  0.1833333  0.570416069 #> 6  0.5166667  1.960042179 #> 7  0.7666667  1.477610529 #> 8  1.0000000  0.088837397"},{"path":"http://www.peteredewitt.com/cpr/reference/order_statistics.html","id":null,"dir":"Reference","previous_headings":"","what":"Distribution of Order Statistics — order_statistics","title":"Distribution of Order Statistics — order_statistics","text":"Density distribution function jth order statistics sample size n known distribution function.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/order_statistics.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Distribution of Order Statistics — order_statistics","text":"","code":"d_order_statistic(x, n, j, distribution, ...)  p_order_statistic(q, n, j, distribution, ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/order_statistics.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Distribution of Order Statistics — order_statistics","text":"x, q vector quantiles n sample size j jth order statistics distribution character string defining distribution. See Details. ... additional arguments passed density distribution function","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/order_statistics.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Distribution of Order Statistics — order_statistics","text":"numeric vector","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/order_statistics.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Distribution of Order Statistics — order_statistics","text":"known distribution defined density distribution functions, e.g., normal (dnorm, pnorm), chisq (dchisq, pchisq), define density function jth order statistic, sample size n, $$ \\frac{n!}{(j-1)!(n-j)!} f(x) F(x)^{j-1} (1 - F(x))^{n-j}$$. distribution function $$\\sum_{k = j}^{n} \\binom{n}{k} \\left[F(x)\\right]^{k} \\left[1-F(x)\\right]^{n-k}$$.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/order_statistics.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Distribution of Order Statistics — order_statistics","text":"Casella G, Berger RL (2002). Statistical Inference. 2nd edition. Duxbury Thomson Learning.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/order_statistics.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Distribution of Order Statistics — order_statistics","text":"","code":"# Example 1 # Find the distribution of the minimum from a sample of size 54 from a # standard normal distribution  simulated_data <- matrix(rnorm(n = 54 * 5000), ncol = 54)  # find all the minimums for each of the simulated samples of size 54 mins <- apply(simulated_data, 1, min)  # get the density values x <- seq(-5, 0, length.out = 100) d <- d_order_statistic(x, n = 54, j = 1, distribution = \"norm\")  # plot the histogram and density hist(mins, freq = FALSE) points(x, d, type = \"l\", col = \"red\")   # plot the distribution function plot(ecdf(mins)) points(x, p_order_statistic(q = x,  n = 54, j = 1, distribution = \"norm\"), col = \"red\")   # Example 2 # Find the density and distrubition of the fourth order statistic from a # sample of size 12 from a chisq distribution with 3 degrees of freedom  simulated_data <- matrix(rchisq(n = 12 * 5000, df = 3), ncol = 12)  os4 <- apply(simulated_data, 1, function(x) sort(x)[4])  x <- seq(min(os4), max(os4), length.out = 100) d <- d_order_statistic(x, n = 12, j = 4, distribution = \"chisq\", df = 3) p <- p_order_statistic(x, n = 12, j = 4, distribution = \"chisq\", df = 3)  hist(os4, freq = FALSE); points(x, d, type = \"l\", col = \"red\")  plot(ecdf(os4)); points(x, p, col = \"red\")   # Example 3 # For a set of j observations, find the values for each of the j order # statistics simulated_data <- matrix(rnorm(n = 6 * 5000), ncol = 6) simulated_data <- apply(simulated_data, 1, sort) xs <- apply(simulated_data, 1, range) xs <- apply(xs, 2, function(x) {seq(x[1], x[2], length.out = 100)}) ds <- apply(xs, 1, d_order_statistic, n = 6, j = 1:6, distribution = \"norm\") ps <- apply(xs, 1, p_order_statistic, n = 6, j = 1:6, distribution = \"norm\")  old_par <- par() # save current settings  par(mfrow = c(2, 3)) for (i in 1:6) {   hist(simulated_data[i, ]        , freq = FALSE        , main = substitute(Density~of~X[(ii)], list(ii = i))        , xlab = \"\"   )   points(xs[, i], ds[i, ], type = \"l\", col = \"red\") }   for (i in 1:6) {   plot(ecdf(simulated_data[i, ])        , main = substitute(CDF~of~X[(ii)], list(ii = i))        , ylab = \"\"        , xlab = \"\"        )   points(xs[, i], ps[i, ], type = \"p\", col = \"red\") }   par(mfrow = c(1, 1)) plot(xs[, 1], ps[1, ], type = \"l\", col = 1, xlim = range(xs), ylab = \"\", xlab = \"\") for(i in 2:6) {   points(xs[, i], ps[i, ], type = \"l\", col = i) } legend(\"topleft\", col = 1:6, lty = 1, legend =        c(          expression(CDF~of~X[(1)]),          expression(CDF~of~X[(2)]),          expression(CDF~of~X[(3)]),          expression(CDF~of~X[(4)]),          expression(CDF~of~X[(5)]),          expression(CDF~of~X[(5)])          ))   par(old_par) # reset par to setting prior to running this example #> Warning: graphical parameter \"cin\" cannot be set #> Warning: graphical parameter \"cra\" cannot be set #> Warning: graphical parameter \"csi\" cannot be set #> Warning: graphical parameter \"cxy\" cannot be set #> Warning: graphical parameter \"din\" cannot be set #> Warning: graphical parameter \"page\" cannot be set"},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_bs.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot B-spline Basis — plot.cpr_bs","title":"Plot B-spline Basis — plot.cpr_bs","text":"Wrapper around several ggplot2 calls plot B-spline basis","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_bs.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot B-spline Basis — plot.cpr_bs","text":"","code":"# S3 method for cpr_bs plot(x, ..., show_xi = TRUE, show_x = FALSE, color = TRUE, digits = 2, n = 100)"},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_bs.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot B-spline Basis — plot.cpr_bs","text":"x cpr_bs object show_xi logical, show knot locations, using Greek letter xi, x-axis show_x logical, show x values knots x-axis color logical, TRUE (default) splines plotted color.  FALSE splines black lines. digits number digits right decimal place report value knot. n number values use plot splines, defaults 100 ... currently used","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_bs.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot B-spline Basis — plot.cpr_bs","text":"ggplot","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_bs.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Plot B-spline Basis — plot.cpr_bs","text":"","code":"bmat <- bsplines(seq(-3, 2, length = 1000), iknots = c(-2, 0, 0.2)) #> Warning: At least one x value >= max(bknots) plot(bmat, show_xi = TRUE,  show_x = TRUE)  plot(bmat, show_xi = FALSE, show_x = TRUE)  plot(bmat, show_xi = TRUE,  show_x = FALSE)  ## Default  plot(bmat, show_xi = FALSE, show_x = FALSE)  plot(bmat, show_xi = FALSE, show_x = FALSE)  plot(bmat, show_xi = FALSE, show_x = FALSE, color = FALSE)"},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cn.html","id":null,"dir":"Reference","previous_headings":"","what":"Plotting Control Nets — plot.cpr_cn","title":"Plotting Control Nets — plot.cpr_cn","text":"Three-dimensional plots control nets /surfaces","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cn.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plotting Control Nets — plot.cpr_cn","text":"","code":"# S3 method for cpr_cn plot(   x,   ...,   xlab = \"\",   ylab = \"\",   zlab = \"\",   show_net = TRUE,   show_surface = FALSE,   get_surface_args,   net_args,   surface_args,   rgl = TRUE )"},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cn.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plotting Control Nets — plot.cpr_cn","text":"x cpr_cn object ... common arguments used plot control net surface, e.g., xlim, ylim, zlim. xlab, ylab, zlab labels axes. show_net logical, show control net show_surface logical, show tensor product surface get_surface_args list arguments passed get_surface call.  call generates needed data sets used plotting. net_args arguments used explicitly control net.  Ignored show_net = FALSE. surface_args arguments used explicitly surface.  Ignored show_surface = FALSE. rgl TRUE, default, generate use rgl::persp3d generate graphics.  FALSE, use plot3D::persp3D generate graphics.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cn.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plotting Control Nets — plot.cpr_cn","text":"plotting data needed generate plot returned invisibly.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cn.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Plotting Control Nets — plot.cpr_cn","text":"plotting method generates three-dimensional plots control net, surface, , cpr_cn objects.  three-dimensional plots generated either persp3D form plot3D package persp3d rgl package. rgl graphics may may work system depending support OpenGL. Building complex customized graphics might easier use get_surface generate needed data plotting.  See vignette(topic = \"cnr\", package = \"cpr\") examples building different plots. rgl graphics, surface_args net_args lists rgl.material arguments passed persp3d. Defaults col = \"black\", front = \"lines\", back = \"lines\" net_args col = \"grey20\", front = \"fill\", back = \"lines\" surface_args. plot3D graphics defaults values net_args surface_args.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cn.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Plotting Control Nets — plot.cpr_cn","text":"","code":"acn <- cn(log10(pdg) ~ btensor(  x = list(day, age)                                 , df = list(30, 4)                                 , bknots = list(c(-1, 1), c(44, 53)))            , data = spdg)  # plot3D plot(acn, rgl = FALSE) #> Warning: RGL: unable to open X11 display #> Warning: 'rgl.init' failed, running with 'rgl.useNULL = TRUE'.   # rgl if (FALSE) { plot(acn, rgl = TRUE) }"},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cnr.html","id":null,"dir":"Reference","previous_headings":"","what":"Control Net Reduction Plots — plot.cpr_cnr","title":"Control Net Reduction Plots — plot.cpr_cnr","text":"collection function inspection evaluation control polygon reduction.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cnr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Control Net Reduction Plots — plot.cpr_cnr","text":"","code":"# S3 method for cpr_cnr plot(x, type = \"rse\", from = 1, to, ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cnr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Control Net Reduction Plots — plot.cpr_cnr","text":"x cpr_cnr object type type diagnostic plot. \"loglik\" log likelihood degrees freedom, \"rse\" residual standard error model index first index x plot last index x plot ... pass ","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cnr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Control Net Reduction Plots — plot.cpr_cnr","text":"ggplot","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cnr.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Control Net Reduction Plots — plot.cpr_cnr","text":"","code":"initial_cn <- cn(log10(pdg) ~ btensor(list(day, age)                         , df = list(10, 8)                         , bknots = list(c(-1, 1), c(44, 53))                         )           , data = spdg)  cnr0 <- cnr(initial_cn) #>    |                                                                               |                                                                      |   0%   |                                                                               |======                                                                |   9%   |                                                                               |=============                                                         |  18%   |                                                                               |===================                                                   |  27%   |                                                                               |=========================                                             |  36%   |                                                                               |================================                                      |  45%   |                                                                               |======================================                                |  55%   |                                                                               |=============================================                         |  64%   |                                                                               |===================================================                   |  73%   |                                                                               |=========================================================             |  82%   |                                                                               |================================================================      |  91%   |                                                                               |======================================================================| 100%  plot(cnr0)"},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cp.html","id":null,"dir":"Reference","previous_headings":"","what":"Plotting Control Polygons — plot.cpr_cp","title":"Plotting Control Polygons — plot.cpr_cp","text":"Plotting control polygon(s) /associated spline(s) via ggplot2","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cp.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plotting Control Polygons — plot.cpr_cp","text":"","code":"# S3 method for cpr_cp plot(   x,   ...,   comparative,   show_cp = TRUE,   show_spline = FALSE,   show_xi = TRUE,   color = FALSE,   n = 100,   show_x = FALSE,   digits = 2 )"},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cp.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plotting Control Polygons — plot.cpr_cp","text":"x cpr_cp object ... additional cpr_cp objects comparative TRUE use color distinguish one spline another, FALSE color highlight control polygon spline different colors, plot knots way plot.cpr_bs .  missing, default TRUE one cpr_cp object passed , FALSE one cpr_cp object passed. show_cp logical (default TRUE), show control polygon(s)? show_spline logical (default FALSE) plot spline function? show_xi logical (default TRUE) use geom_rug show location knots respective control polygons. color Boolean (default FALSE) one cpr_cp object plotted, set value TRUE graphic color (line types used regardless color setting). n number data points use plotting spline show_x boolean, x-values digits number digits right decimal place report value knot. used plotting control polygon comparative = FALSE.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cp.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plotting Control Polygons — plot.cpr_cp","text":"ggplot object","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cp.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Plotting Control Polygons — plot.cpr_cp","text":"","code":"x <- runif(n = 500, 0, 6) bmat <- bsplines(x, iknots = c(1, 1.5, 2.3, 4, 4.5), bknots = c(0, 6)) theta1 <- matrix(c(1, 0, 3.5, 4.2, 3.7, -0.5, -0.7, 2, 1.5), ncol = 1) theta2 <- theta1 + c(-0.15, -1.01, 0.37, 0.19, -0.53, -0.84, -0.19, 1.15, 0.17) cp1 <- cp(bmat, theta1) cp2 <- cp(bmat, theta2)  # compare two control polygons on one plot plot(cp1, cp2)  plot(cp1, cp2, color = TRUE)  plot(cp1, cp2, color = TRUE, show_spline = TRUE)  plot(cp1, cp2, color = TRUE, show_cp = FALSE, show_spline = TRUE)   # Show one control polygon with knots on the axis instead of the rug and # color/linetype for the control polygon and spline, instead of different # control polygons plot(cp1, comparative = FALSE)  plot(cp1, comparative = FALSE, show_spline = TRUE)  plot(cp1, comparative = FALSE, show_spline = TRUE, show_x = TRUE)  plot(cp2, comparative = FALSE, show_spline = TRUE, show_x = TRUE)"},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cpr.html","id":null,"dir":"Reference","previous_headings":"","what":"Control Polygon Reduction Plots — plot.cpr_cpr","title":"Control Polygon Reduction Plots — plot.cpr_cpr","text":"wrapper around several ggplot2 calls help evaluate results CPR run.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cpr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Control Polygon Reduction Plots — plot.cpr_cpr","text":"","code":"# S3 method for cpr_cpr plot(x, from = 1, to, ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cpr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Control Polygon Reduction Plots — plot.cpr_cpr","text":"x cpr_cpr object first index x plot last index x plot ... arguments passed plot.cpr_cp","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cpr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Control Polygon Reduction Plots — plot.cpr_cpr","text":"ggplot object","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_cpr.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Control Polygon Reduction Plots — plot.cpr_cpr","text":"","code":"set.seed(42) x <- seq(0 + 1/5000, 6 - 1/5000, length.out = 100) bmat <- bsplines(x, iknots = c(1, 1.5, 2.3, 4, 4.5), bknots = c(0, 6)) theta <- matrix(c(1, 0, 3.5, 4.2, 3.7, -0.5, -0.7, 2, 1.5), ncol = 1) DF <- data.frame(x = x, truth = as.numeric(bmat %*% theta)) DF$y <- as.numeric(bmat %*% theta + rnorm(nrow(bmat), sd = 0.3))  initial_cp0 <-   cp(y ~ bsplines(x, iknots = c(1, 1.5, 2.3, 3.0, 4, 4.5), bknots = c(0, 6))      , data = DF      , keep_fit = TRUE # default is FALSE   ) cpr0 <- cpr(initial_cp0) #>    |                                                                               |                                                                      |   0%   |                                                                               |==========                                                            |  14%   |                                                                               |====================                                                  |  29%   |                                                                               |==============================                                        |  43%   |                                                                               |========================================                              |  57%   |                                                                               |==================================================                    |  71%   |                                                                               |============================================================          |  86%   |                                                                               |======================================================================| 100%  plot(cpr0) #> Error in eval(expr): object 'cpr0' not found plot(cpr0, show_spline = TRUE, show_cp = FALSE, color = TRUE, from = 2, to = 4) #> Error in eval(expr): object 'cpr0' not found"},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_summary_cpr_cpr.html","id":null,"dir":"Reference","previous_headings":"","what":"Plotting Summaries of Control Polygon Reductions — plot.cpr_summary_cpr_cpr","title":"Plotting Summaries of Control Polygon Reductions — plot.cpr_summary_cpr_cpr","text":"Plotting Summaries Control Polygon Reductions","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_summary_cpr_cpr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plotting Summaries of Control Polygon Reductions — plot.cpr_summary_cpr_cpr","text":"","code":"# S3 method for cpr_summary_cpr_cpr plot(   x,   type = c(\"rse\", \"rss\", \"loglik\", \"wiggle\", \"fdsc\", \"Pr(>w_(1))\"),   from = 1,   to,   ... )"},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_summary_cpr_cpr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plotting Summaries of Control Polygon Reductions — plot.cpr_summary_cpr_cpr","text":"x cpr_summary_cpr_cpr object type response plot index first index x plot last index x plot ... pass ","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_summary_cpr_cpr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plotting Summaries of Control Polygon Reductions — plot.cpr_summary_cpr_cpr","text":"ggplot object","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/plot.cpr_summary_cpr_cpr.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Plotting Summaries of Control Polygon Reductions — plot.cpr_summary_cpr_cpr","text":"","code":"set.seed(42) x <- seq(0 + 1/5000, 6 - 1/5000, length.out = 100) bmat <- bsplines(x, iknots = c(1, 1.5, 2.3, 4, 4.5), bknots = c(0, 6)) theta <- matrix(c(1, 0, 3.5, 4.2, 3.7, -0.5, -0.7, 2, 1.5), ncol = 1) DF <- data.frame(x = x, truth = as.numeric(bmat %*% theta)) DF$y <- as.numeric(bmat %*% theta + rnorm(nrow(bmat), sd = 0.3))  initial_cp0 <-   cp(y ~ bsplines(x, iknots = c(1, 1.5, 2.3, 3.0, 4, 4.5), bknots = c(0, 6))      , data = DF      , keep_fit = TRUE # default is FALSE   ) cpr0 <- cpr(initial_cp0) #>    |                                                                               |                                                                      |   0%   |                                                                               |==========                                                            |  14%   |                                                                               |====================                                                  |  29%   |                                                                               |==============================                                        |  43%   |                                                                               |========================================                              |  57%   |                                                                               |==================================================                    |  71%   |                                                                               |============================================================          |  86%   |                                                                               |======================================================================| 100% s0   <- summary(cpr0)  plot(s0, type = \"rse\")  plot(s0, type = \"rss\")  plot(s0, type = \"loglik\")  plot(s0, type = \"wiggle\")  plot(s0, type = \"fdsc\")  plot(s0, type = \"Pr(>w_(1))\") #> Warning: Removed 1 rows containing missing values (`geom_point()`). #> Warning: Removed 1 row containing missing values (`geom_line()`)."},{"path":"http://www.peteredewitt.com/cpr/reference/predict.cpr_cp.html","id":null,"dir":"Reference","previous_headings":"","what":"Model Prediction — predict.cpr_cp","title":"Model Prediction — predict.cpr_cp","text":"Model prediction cpr_cp cpr_cn objects.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/predict.cpr_cp.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Model Prediction — predict.cpr_cp","text":"","code":"# S3 method for cpr_cp predict(object, ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/predict.cpr_cp.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Model Prediction — predict.cpr_cp","text":"object cpr_cp cpr_cn object ... passed predict","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/predict.cpr_cp.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Model Prediction — predict.cpr_cp","text":"get calling predict object$fit.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/predict.cpr_cp.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Model Prediction — predict.cpr_cp","text":"","code":"acp <- cp(log10(pdg) ~ bsplines(age, df = 12, bknots = c(45, 53))            , data = spdg           , keep_fit = TRUE) acp_pred0 <- predict(acp$fit, se.fit = TRUE) acp_pred <- predict(acp, se.fit = TRUE) all.equal(acp_pred0, acp_pred) #> [1] TRUE"},{"path":"http://www.peteredewitt.com/cpr/reference/print.cpr_bs.html","id":null,"dir":"Reference","previous_headings":"","what":"Print bsplines — print.cpr_bs","title":"Print bsplines — print.cpr_bs","text":"Print bsplines","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/print.cpr_bs.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Print bsplines — print.cpr_bs","text":"","code":"# S3 method for cpr_bs print(x, n = 6L, ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/print.cpr_bs.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Print bsplines — print.cpr_bs","text":"x cpr_bs object. n, number rows B-spline basis matrix display, defaults 6L. ... currently used.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/print.cpr_bs.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Print bsplines — print.cpr_bs","text":"object x returned invisibly","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/sign_changes.html","id":null,"dir":"Reference","previous_headings":"","what":"Sign Changes — sign_changes","title":"Sign Changes — sign_changes","text":"Count number times first, second, derivative spline changes sign.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/sign_changes.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Sign Changes — sign_changes","text":"","code":"sign_changes(   object,   lower = min(object$bknots),   upper = max(object$bknots),   n = 1000,   derivative = 1L,   ... )"},{"path":"http://www.peteredewitt.com/cpr/reference/sign_changes.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Sign Changes — sign_changes","text":"object cpr_cp object lower lower limit integral upper upper limit integral n number values assess derivative lower upper. derivative integer value denoted first second derivative ... pass ","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/sign_changes.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Sign Changes — sign_changes","text":"number times sign first second derivative changes within specified interval.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/sign_changes.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Sign Changes — sign_changes","text":"","code":"xvec <- seq(0, 6, length = 500)  # Define the basis matrix bmat1 <- bsplines(x = xvec, iknots = c(1, 1.5, 2.3, 4, 4.5)) #> Warning: At least one x value >= max(bknots) bmat2 <- bsplines(x = xvec) #> Warning: At least one x value >= max(bknots)  # Define the control vertices ordinates theta1 <- c(1, 0, 3.5, 4.2, 3.7, -0.5, -0.7, 2, 1.5) theta2 <- c(1, 3.4, -2, 1.7)  # build the two control polygons cp1 <- cp(bmat1, theta1) cp2 <- cp(bmat2, theta2) plot(cp1, cp2, show_cp = FALSE, show_spline = TRUE)   sign_changes(cp1) #> [1] 4 sign_changes(cp2) #> [1] 2"},{"path":"http://www.peteredewitt.com/cpr/reference/spdg.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulated Pregnanediol glucuronide (PDG) Data — spdg","title":"Simulated Pregnanediol glucuronide (PDG) Data — spdg","text":"Simulated data set based Study Women's Health Across Nation (SWAN) Daily Hormone Study (DHS).","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/spdg.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulated Pregnanediol glucuronide (PDG) Data — spdg","text":"","code":"spdg"},{"path":"http://www.peteredewitt.com/cpr/reference/spdg.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Simulated Pregnanediol glucuronide (PDG) Data — spdg","text":"data.frame. Variables data set: id Subject ID age Age, years subject ttm Time--menopause, years ethnicity Ethnicity, factor five levels: Caucasian, Black,  Chinese, Hispanic, Japanese bmi Body Mass Index day_from_dlt integer value number days Day  Luteal Transition (DLT).  DLT day_from_dlt == 0.  Negative  values indicate follicular phase, positive values luteal phase. day_of_cycle day cycle day scaled day--cycle [-1, 1] 0 DLT.  See  Details pdg simulated PDG value","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/spdg.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Simulated Pregnanediol glucuronide (PDG) Data — spdg","text":"simulated data.  see script generated data set please visit https://github.com/dewittpe/cpr look scripts data-raw directory.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/spdg.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Simulated Pregnanediol glucuronide (PDG) Data — spdg","text":"Pregnanediol glucuronide (PDG) urine metabolite progesterone.  data set simulated similar characteristics subset SWAN DHS data.  SWAN DHS data motivating data set method development lead cpr package.  DHS data made public, simulated data set provided use examples instructions use cpr package.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/spdg.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Simulated Pregnanediol glucuronide (PDG) Data — spdg","text":"Santoro, Nanette, et al. \"Body size ethnicity associated menstrual cycle alterations women early menopausal transition: Study Women's Health across Nation (SWAN) Daily Hormone Study.\" Journal Clinical Endocrinology & Metabolism 89.6 (2004): 2622-2631.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cn.html","id":null,"dir":"Reference","previous_headings":"","what":"Summary of Control Net — summary.cpr_cn","title":"Summary of Control Net — summary.cpr_cn","text":"Generate summary control net object","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cn.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summary of Control Net — summary.cpr_cn","text":"","code":"# S3 method for cpr_cn summary(object, ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cn.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summary of Control Net — summary.cpr_cn","text":"object cpr_cn object ... pass ","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cn.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Summary of Control Net — summary.cpr_cn","text":"data.frame","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cn.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Summary of Control Net — summary.cpr_cn","text":"","code":"acn <- cn(log10(pdg) ~ btensor(list(day, age)                                , df = list(10, 8)                                , bknots = list(c(-1, 1), c(44, 53)))          , data = spdg)  summary(acn) #>   dfs    loglik      rss       rse n_iknots1      iknots1 n_iknots2 #> 1  80 -7761.069 2708.164 0.3321463         6 -0.79187....         4 #>        iknots2 #> 1 47.33451...."},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cnr.html","id":null,"dir":"Reference","previous_headings":"","what":"Summarize Control Net Reduction Objects — summary.cpr_cnr","title":"Summarize Control Net Reduction Objects — summary.cpr_cnr","text":"Summarize Control Net Reduction Objects","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cnr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summarize Control Net Reduction Objects — summary.cpr_cnr","text":"","code":"# S3 method for cpr_cnr summary(object, ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cnr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summarize Control Net Reduction Objects — summary.cpr_cnr","text":"object cpr_cnr object ... pass ","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cnr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Summarize Control Net Reduction Objects — summary.cpr_cnr","text":"cpr_summary_cpr_cnr object, just data.frame","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cnr.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Summarize Control Net Reduction Objects — summary.cpr_cnr","text":"","code":"acn <- cn(log10(pdg) ~ btensor(list(day, age)                                , df = list(10, 8)                                , bknots = list(c(-1, 1), c(44, 53)))          , data = spdg) cnr0 <- cnr(acn) #>    |                                                                               |                                                                      |   0%   |                                                                               |======                                                                |   9%   |                                                                               |=============                                                         |  18%   |                                                                               |===================                                                   |  27%   |                                                                               |=========================                                             |  36%   |                                                                               |================================                                      |  45%   |                                                                               |======================================                                |  55%   |                                                                               |=============================================                         |  64%   |                                                                               |===================================================                   |  73%   |                                                                               |=========================================================             |  82%   |                                                                               |================================================================      |  91%   |                                                                               |======================================================================| 100% cnr0 #> A list of control nets #> List of 11 #>  - attr(*, \"class\")= chr [1:2] \"cpr_cnr\" \"list\" summary(cnr0) #>    dfs    loglik      rss       rse n_iknots1      iknots1 n_iknots2 #> 1   16 -8412.922 2855.385 0.3406112         0                      0 #> 2   20 -8406.155 2853.816 0.3405453         0                      1 #> 3   25 -7964.400 2753.253 0.3345253         1 0.057623....         1 #> 4   30 -7954.317 2750.999 0.3344224         1 0.057623....         2 #> 5   36 -7795.952 2715.846 0.3323194         2 0.057623....         2 #> 6   42 -7793.308 2715.263 0.3323242         2 0.057623....         3 #> 7   49 -7791.974 2714.969 0.3323536         3 -0.79187....         3 #> 8   56 -7791.165 2714.791 0.3323900         4 -0.79187....         3 #> 9   63 -7782.825 2712.953 0.3323248         5 -0.79187....         3 #> 10  70 -7763.444 2708.686 0.3321107         6 -0.79187....         3 #> 11  80 -7761.069 2708.164 0.3321463         6 -0.79187....         4 #>         iknots2 index #> 1                   1 #> 2  47.33451....     2 #> 3  47.33451....     3 #> 4  47.33451....     4 #> 5  47.33451....     5 #> 6  47.33451....     6 #> 7  47.33451....     7 #> 8  47.33451....     8 #> 9  47.33451....     9 #> 10 47.33451....    10 #> 11 47.33451....    11"},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cp.html","id":null,"dir":"Reference","previous_headings":"","what":"Summarize a Control Polygon Object — summary.cpr_cp","title":"Summarize a Control Polygon Object — summary.cpr_cp","text":"Summarize Control Polygon Object","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cp.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summarize a Control Polygon Object — summary.cpr_cp","text":"","code":"# S3 method for cpr_cp summary(object, wiggle = TRUE, integrate.args = list(), ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cp.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summarize a Control Polygon Object — summary.cpr_cp","text":"object cpr_cp object wiggle logical, TRUE integral squared second derivative spline function calculated via integrate. integrate.args list arguments passed wiggle ultimately integrate. ... pass ","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cp.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Summarize a Control Polygon Object — summary.cpr_cp","text":"cpr_summary_cpr_cp object, just data.frame","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cp.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Summarize a Control Polygon Object — summary.cpr_cp","text":"","code":"set.seed(42) x <- seq(0 + 1/5000, 6 - 1/5000, length.out = 100) bmat <- bsplines(x, iknots = c(1, 1.5, 2.3, 4, 4.5), bknots = c(0, 6)) theta <- matrix(c(1, 0, 3.5, 4.2, 3.7, -0.5, -0.7, 2, 1.5), ncol = 1) DF <- data.frame(x = x, truth = as.numeric(bmat %*% theta)) DF$y <- as.numeric(bmat %*% theta + rnorm(nrow(bmat), sd = 0.3))  initial_cp <-   cp(y ~ bsplines(x, iknots = c(1, 1.5, 2.3, 3.0, 4, 4.5), bknots = c(0, 6))      , data = DF      , keep_fit = TRUE # default is FALSE   )  summary(initial_cp) #>   dfs n_iknots       iknots    loglik      rss       rse   wiggle fdsc #> 1  10        6 1, 1.5, .... -19.67424 8.677886 0.3105172 87.35118    4"},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cpr.html","id":null,"dir":"Reference","previous_headings":"","what":"Summarize a Control Polygon Reduction Object — summary.cpr_cpr","title":"Summarize a Control Polygon Reduction Object — summary.cpr_cpr","text":"Summarize Control Polygon Reduction Object","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cpr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summarize a Control Polygon Reduction Object — summary.cpr_cpr","text":"","code":"# S3 method for cpr_cpr summary(object, ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cpr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summarize a Control Polygon Reduction Object — summary.cpr_cpr","text":"object cpr_cpr object ... pass ","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cpr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Summarize a Control Polygon Reduction Object — summary.cpr_cpr","text":"data.frame attribute elbow programmatic attempt identify useful trade-degrees freedom fit statistic.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/summary.cpr_cpr.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Summarize a Control Polygon Reduction Object — summary.cpr_cpr","text":"","code":"set.seed(42) x <- seq(0 + 1/5000, 6 - 1/5000, length.out = 100) bmat <- bsplines(x, iknots = c(1, 1.5, 2.3, 4, 4.5), bknots = c(0, 6)) theta <- matrix(c(1, 0, 3.5, 4.2, 3.7, -0.5, -0.7, 2, 1.5), ncol = 1) DF <- data.frame(x = x, truth = as.numeric(bmat %*% theta)) DF$y <- as.numeric(bmat %*% theta + rnorm(nrow(bmat), sd = 0.3))  initial_cp <-   cp(y ~ bsplines(x, iknots = c(1, 1.5, 2.3, 3.0, 4, 4.5), bknots = c(0, 6))      , data = DF      , keep_fit = TRUE # default is FALSE   )  cpr0 <- cpr(initial_cp) #>    |                                                                               |                                                                      |   0%   |                                                                               |==========                                                            |  14%   |                                                                               |====================                                                  |  29%   |                                                                               |==============================                                        |  43%   |                                                                               |========================================                              |  57%   |                                                                               |==================================================                    |  71%   |                                                                               |============================================================          |  86%   |                                                                               |======================================================================| 100% s <- summary(cpr0) s #>   dfs n_iknots       iknots    loglik       rss       rse    wiggle fdsc #> 1   4        0              -74.49596 25.977023 0.5201865  46.88727    2 #> 2   5        1          4.5 -60.10762 19.481116 0.4528403  46.14794    2 #> 3   6        2       1, 4.5 -22.06652  9.103178 0.3111950 113.07351    4 #> 4   7        3    1, 3, 4.5 -19.96710  8.728863 0.3063637  99.28601    4 #> 5   8        4 1, 1.5, .... -19.95694  8.727089 0.3079930  95.78576    4 #> 6   9        5 1, 1.5, .... -19.79792  8.699377 0.3091885  92.01369    4 #> 7  10        6 1, 1.5, .... -19.67424  8.677886 0.3105172  87.35118    4 #>   Pr(>w_(1)) #> 1         NA #> 2 1.8203e-08 #> 3 < 2.22e-16 #> 4 9.6222e-05 #> 5   0.630871 #> 6   0.072342 #> 7   0.066713 #>  #> ------- #> Elbows (index of selected model): #>           loglik rss rse #> quadratic      3   3   3 #> linear         3   3   3 plot(s, type = \"rse\")"},{"path":"http://www.peteredewitt.com/cpr/reference/trimmed_quantile.html","id":null,"dir":"Reference","previous_headings":"","what":"Trimmed Quantiles — trimmed_quantile","title":"Trimmed Quantiles — trimmed_quantile","text":"data \\(X = x_1, x_2, \\ldots, x_n\\), order statistics \\(x_{(1)}, x_{(2)}, \\ldots, x_{(r)}\\) return quantiles trimmed data set, e.g., \\(\\boldsymbol{X} \\backslash \\{x_{(1)}, x_{(r)}\\}\\) (trim = 1), \\(\\boldsymbol{X} \\backslash \\{x_{(1)}, x_{(2)}, x_{(r-1)}, x_{(r)}\\}\\) (trim = 2).","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/trimmed_quantile.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Trimmed Quantiles — trimmed_quantile","text":"","code":"trimmed_quantile(x, trim = 1L, use_unique = TRUE, ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/trimmed_quantile.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Trimmed Quantiles — trimmed_quantile","text":"x numeric vector trim defaults 1, omitting min max use_unique logical, true (defaults), base quantiles unique values, false, base quantiles data, trimming. ... arguments pass stats::quantile","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/trimmed_quantile.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Trimmed Quantiles — trimmed_quantile","text":"numeric vector, return quantile","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/trimmed_quantile.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Trimmed Quantiles — trimmed_quantile","text":"","code":"trimmed_quantile(1:100, prob = 1:23 / 24, name = FALSE) #>  [1]  6.041667 10.083333 14.125000 18.166667 22.208333 26.250000 30.291667 #>  [8] 34.333333 38.375000 42.416667 46.458333 50.500000 54.541667 58.583333 #> [15] 62.625000 66.666667 70.708333 74.750000 78.791667 82.833333 86.875000 #> [22] 90.916667 94.958333  # Warning # trimmed_quantile(1:100, trim = .3, prob = 1:23 / 24, name = FALSE)  # no warning trimmed_quantile(1:100, trim = 3, prob = 1:23 / 24, name = FALSE) #>  [1]  7.875 11.750 15.625 19.500 23.375 27.250 31.125 35.000 38.875 42.750 #> [11] 46.625 50.500 54.375 58.250 62.125 66.000 69.875 73.750 77.625 81.500 #> [21] 85.375 89.250 93.125"},{"path":"http://www.peteredewitt.com/cpr/reference/update_bsplines.html","id":null,"dir":"Reference","previous_headings":"","what":"Update bsplines or btensor calls — update_bsplines","title":"Update bsplines or btensor calls — update_bsplines","text":"Update cpr_bs cpr_bt objects alone within cpr_cp cpr_cn objects.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/update_bsplines.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Update bsplines or btensor calls — update_bsplines","text":"","code":"update_bsplines(object, ..., evaluate = TRUE)  update_btensor(object, ..., evaluate = TRUE)"},{"path":"http://www.peteredewitt.com/cpr/reference/update_bsplines.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Update bsplines or btensor calls — update_bsplines","text":"object object update. ... arguments update, expected iknots, df, bknots, order. evaluate whether evaluate updated call.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/update_bsplines.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Update bsplines or btensor calls — update_bsplines","text":"evaluate = TRUE cpr_bs cpr_bt object returned, else, unevaluated call returned.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/update_bsplines.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Update bsplines or btensor calls — update_bsplines","text":"","code":"################################################################################ ##                          Updating a cpr_bs object                          ## # construct a B-spline basis bmat <- bsplines(runif(10, 1, 10), df = 5, order = 3, bknots = c(1, 10))  # look at the structure of the basis str(bmat) #>  'cpr_bs' num [1:10, 1:5] 0 0 0 0 0.414 ... #>  - attr(*, \"order\")= num 3 #>  - attr(*, \"df\")= num 5 #>  - attr(*, \"iknots\")= num [1:2] 4.98 5.56 #>  - attr(*, \"bknots\")= num [1:2] 1 10 #>  - attr(*, \"xi\")= num [1:8] 1 1 1 4.98 5.56 ... #>  - attr(*, \"xi_star\")= num [1:5] 1 2.99 5.27 7.78 10 #>  - attr(*, \"call\")= language bsplines(x = runif(10, 1, 10), df = 5, bknots = c(1, 10), order = 3) #>  - attr(*, \"environment\")=<environment: 0x5567b291d9b0>   # change the order str(update_bsplines(bmat, order = 4)) #>  'cpr_bs' num [1:10, 1:5] 1.22e-07 0.00 5.59e-02 7.00e-01 5.04e-03 ... #>  - attr(*, \"order\")= num 4 #>  - attr(*, \"df\")= num 5 #>  - attr(*, \"iknots\")= num 5.9 #>  - attr(*, \"bknots\")= num [1:2] 1 10 #>  - attr(*, \"xi\")= num [1:9] 1 1 1 1 5.9 ... #>  - attr(*, \"xi_star\")= num [1:5] 1 2.63 5.63 8.63 10 #>  - attr(*, \"call\")= language bsplines(x = runif(10, 1, 10), df = 5, bknots = c(1, 10), order = 4) #>  - attr(*, \"environment\")=<environment: 0x5567b291d9b0>   # change the order and the degrees of freedom str(update_bsplines(bmat, df = 12, order = 4)) #>  'cpr_bs' num [1:10, 1:12] 0 0.000205 0 0 0 ... #>  - attr(*, \"order\")= num 4 #>  - attr(*, \"df\")= num 12 #>  - attr(*, \"iknots\")= num [1:8] 2.64 2.97 3.4 3.77 3.82 ... #>  - attr(*, \"bknots\")= num [1:2] 1 10 #>  - attr(*, \"xi\")= num [1:16] 1 1 1 1 2.64 ... #>  - attr(*, \"xi_star\")= num [1:12] 1 1.55 2.2 3 3.38 ... #>  - attr(*, \"call\")= language bsplines(x = runif(10, 1, 10), df = 12, bknots = c(1, 10), order = 4) #>  - attr(*, \"environment\")=<environment: 0x5567b291d9b0>   ################################################################################ ##                          Updating a cpr_bt object                          ## # construct a tensor product tpmat <- btensor(list(x1 = seq(0, 1, length = 10), x2 = seq(0, 1, length = 10)),                  df = list(4, 5)) #> Warning: At least one x value >= max(bknots) #> Warning: At least one x value >= max(bknots) tpmat #> Tensor Product Matrix dims: [10 x 20] #>   # update the degrees of freedom update_btensor(tpmat, df = list(6, 7)) #> Warning: At least one x value >= max(bknots) #> Warning: At least one x value >= max(bknots) #> Tensor Product Matrix dims: [10 x 42] #>   ################################################################################ ##      Updating bsplines or btensor on the right and side of a formula       ##  f1 <- y ~ bsplines(x, df = 14) + var1 + var2 f2 <- y ~ btensor(x = list(x1, x2), df = list(50, 31), order = list(3, 5))  + var1 + var2  update_bsplines(f1, df = 13, order = 5) #> y ~ bsplines(x, df = 13, order = 5) + var1 + var2 #> <environment: 0x5567b291d9b0> update_btensor(f2, df = list(13, 24), order = list(3, 8)) #> y ~ btensor(x = list(x1, x2), df = list(13, 24), order = list(3,  #>     8)) + var1 + var2 #> <environment: 0x5567b291d9b0>  ################################################################################ ##                          Updating a cpr_cp object                          ## data(spdg, package = \"cpr\") init_cp <- cp(pdg ~ bsplines(day, df = 30) + age + ttm, data = spdg) #> Warning: At least one x value >= max(bknots) #> Warning: At least one x value >= max(bknots) updt_cp <- update_bsplines(init_cp, df = 5) #> Warning: At least one x value >= max(bknots) #> Warning: At least one x value >= max(bknots)  ################################################################################ ##                          Updating a cpr_cn object                          ## init_cn <- cn(pdg ~ btensor(list(day, age), df = list(30, 4)) + ttm, data = spdg) #> Warning: At least one x value >= max(bknots) #> Warning: At least one x value >= max(bknots) #> Warning: At least one x value >= max(bknots) #> Warning: At least one x value >= max(bknots) updt_cn <- update_btensor(init_cn, df = list(30, 2), order = list(3, 2)) #> Warning: At least one x value >= max(bknots) #> Warning: At least one x value >= max(bknots) #> Warning: At least one x value >= max(bknots) #> Warning: At least one x value >= max(bknots)"},{"path":"http://www.peteredewitt.com/cpr/reference/us_covid_cases.html","id":null,"dir":"Reference","previous_headings":"","what":"United States Laboratory Confirmed COVID-19 Cases — us_covid_cases","title":"United States Laboratory Confirmed COVID-19 Cases — us_covid_cases","text":"Number laboratory-confirmed COVID-19 cases United States, reported Centers Disease Control, January 1 2020 May 11, 2023, end public health emergency declaration.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/us_covid_cases.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"United States Laboratory Confirmed COVID-19 Cases — us_covid_cases","text":"","code":"us_covid_cases"},{"path":"http://www.peteredewitt.com/cpr/reference/us_covid_cases.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"United States Laboratory Confirmed COVID-19 Cases — us_covid_cases","text":"data.frame two columns date year, month, day cases number reported laboratory-confirmed COVID-19 cases","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/us_covid_cases.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"United States Laboratory Confirmed COVID-19 Cases — us_covid_cases","text":"Download original data <https://data.cdc.gov/Case-Surveillance/COVID-19-Case-Surveillance-Public-Use-Data/vbim-akqf> December 5, 2023.  reported data set last updated November 3, 2023.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/wiggle.html","id":null,"dir":"Reference","previous_headings":"","what":"Wiggliness of a Spline function — wiggle","title":"Wiggliness of a Spline function — wiggle","text":"Calculate integral squared second derivative spline function.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/wiggle.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Wiggliness of a Spline function — wiggle","text":"","code":"wiggle(object, lower, upper, stop.on.error = FALSE, ...)"},{"path":"http://www.peteredewitt.com/cpr/reference/wiggle.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Wiggliness of a Spline function — wiggle","text":"object cpr_cp object lower lower limit integral upper upper limit integral stop..error default FALSE, see integrate. ... additional arguments passed integrate","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/wiggle.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Wiggliness of a Spline function — wiggle","text":"integrate.","code":""},{"path":"http://www.peteredewitt.com/cpr/reference/wiggle.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Wiggliness of a Spline function — wiggle","text":"wiggliness spline function defined $$\\int \\left( \\frac{\\mathrm{d}^2}{\\mathrm{d}x^2} f \\left(x \\right) \\right)^2 \\mathrm{d}x.$$","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/reference/wiggle.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Wiggliness of a Spline function — wiggle","text":"","code":"xvec <- seq(0, 6, length = 500)  # Define the basis matrix bmat1 <- bsplines(x = xvec, iknots = c(1, 1.5, 2.3, 4, 4.5)) #> Warning: At least one x value >= max(bknots) bmat2 <- bsplines(x = xvec) #> Warning: At least one x value >= max(bknots)  # Define the control vertices ordinates theta1 <- c(1, 0, 3.5, 4.2, 3.7, -0.5, -0.7, 2, 1.5) theta2 <- c(1, 3.4, -2, 1.7)  # build the two control polygons cp1 <- cp(bmat1, theta1) cp2 <- cp(bmat2, theta2) plot(cp1, cp2, show_cp = FALSE, show_spline = TRUE)   wiggle(cp1) #> 152.7839 with absolute error < 0.0049 wiggle(cp2) #> 4.037222 with absolute error < 4.5e-14"},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"new-features-0-3-0-9000","dir":"Changelog","previous_headings":"","what":"New Features","title":"Version 0.3.0.9000","text":"cpr’s progress argument extended control progress bar used just cpr steps, detailed progress influence weight calculations reported. influence_of_iknots gains parallel execution via pbapply (#17) plot.cpr_cp gains argument comparitive , set FALSE one cpr_cp passed plotting, graphic appear like plot.cpr_bs results. comparitive = TRUE one cpr_cp present, behavior v0.3.0 retained. cp.formula gains methods.args argument pass arguments regression method instead relying .... d_order_statistic p_order_statistic added. functions allow get density distribution function jth order statistic sample size n distribution defined density distribution functions within R. sign_changes count number sign changes first second derivative spline function. get_spline returns standard errors deriviatives (#60)","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"user-visible-changes-0-3-0-9000","dir":"Changelog","previous_headings":"","what":"User Visible Changes","title":"Version 0.3.0.9000","text":"loglikelihood exported namespace summary.cpr_cp now calculates “wiggle” function default, , changes default wiggle = FALSE wiggle = TRUE cp cn default keep_fit argument set TRUE. change made simplify prediction methods. print.cpr_bt returns object invisibly, used return str(x). print.cpr_cn returns object invisibly print.cpr_cnr returns object invisibly print.cpr_cpr returns object invisibly","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"non-user-visible-changes-0-3-0-9000","dir":"Changelog","previous_headings":"","what":"Non-User Visible Changes","title":"Version 0.3.0.9000","text":"Refactor c++ defining basis functions, derivatives basis functions, b-splines structures cp.formula checks formula requires bsplines used first term right hand side formula.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"defunct-functions-0-3-0-9000","dir":"Changelog","previous_headings":"","what":"Defunct Functions","title":"Version 0.3.0.9000","text":"major refactor internal code since v0.3.0 resulted several functions becoming defunct, see help(cpr-defunct) details.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"version-030","dir":"Changelog","previous_headings":"","what":"Version 0.3.0","title":"Version 0.3.0","text":"CRAN release: 2023-11-29","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"new-examples-0-3-0","dir":"Changelog","previous_headings":"","what":"New Examples","title":"Version 0.3.0","text":"cpr examples","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"other-changes-0-3-0","dir":"Changelog","previous_headings":"","what":"Other Changes","title":"Version 0.3.0","text":"Depends Rcpp >= 0.12.11 (actually moved >= 1.0.11) handle registering native routines. Moves rgl Imports Suggests (re #36) Refactoring base code eliminate use dplyr, tidyr, tibble, etc. Focus base R methods reduce install dependencies improve long term stability package. Require R > 3.5.0 Stop using testthat testing Remove use tidyr, dplyr Improve documentation Minor bug fixes Replace use now deprecated ggplot2::aes_string","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"version-023","dir":"Changelog","previous_headings":"","what":"Version 0.2.3","title":"Version 0.2.3","text":"CRAN release: 2017-03-07 First public release.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"new-features-0-2-3","dir":"Changelog","previous_headings":"","what":"New Features","title":"Version 0.2.3","text":"plot.cpr_cn supports rgl plot3D graphics start vignette.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"new-features-0-2-2","dir":"Changelog","previous_headings":"","what":"New Features","title":"Version 0.2.2","text":"get_spline S3 method getting data.frame interpolated values spline given cpr_cp object. Later development add methods cpr_cn objects. predict.cpr_cp predict.cpr_cn methods added matrix_rank added update_bsplines update_btensor methods added (#27)","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"version-021","dir":"Changelog","previous_headings":"","what":"Version 0.2.1","title":"Version 0.2.1","text":"Documentation improvements.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"new-features-0-2-1","dir":"Changelog","previous_headings":"","what":"New Features","title":"Version 0.2.1","text":"influence_of plot.cpr_influence_of provide clean interface users explore influence set knots spline function. (#19) color (TRUE/FALSE) option added plot.cpr_bs. plot.cpr_cn lets user plot 2D surfaces tensor product surfaces. plots whole surface input 2D tensor product, 2D slice evaluated given value margins 3+ dimensional tensor products. . collection .cpr_cp, .cpr_bs, … functions added. dataset spdg added package.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"other-changes-0-2-1","dir":"Changelog","previous_headings":"","what":"Other Changes","title":"Version 0.2.1","text":"removed redundant build_tensor definition","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"version-020","dir":"Changelog","previous_headings":"","what":"Version 0.2.0","title":"Version 0.2.0","text":"version fairly polished set tools b-splines, cpr, cnr. version seems good place use three major papers Methods 1: uni-variable functions, Methods 2: multi-variable functions, Software paper. Continued development focused bug fixes minor enhancements.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"new-features-0-2-0","dir":"Changelog","previous_headings":"","what":"New Features","title":"Version 0.2.0","text":"Option save fits cnr (#8) Option define number polynomial coefficients use cnr (#10) x-axis tick label options plotting b-splines (#12) added show_xi cpr:::plot.cp using ggplot2::geom_rug show location knots control polygons plotted. summary cpr_cn cpr_cnr objects added. plot method cpr_cnr objects. margin option cnr allows user specify marginals CNR applied . Using sec.axis option ggplot2_2.2.0 plotting knot sequence numeric values plot.cpr_bs (#18)","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"bug-fixes-0-2-0","dir":"Changelog","previous_headings":"","what":"Bug Fixes","title":"Version 0.2.0","text":"arguments plot.cpr_cpr fixed (#14) correct construction missing iknots argument btensor keep correctly handled cnr call. show_xi correctly handled plot.cpr_cp call.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"non-visible-changes-0-2-0","dir":"Changelog","previous_headings":"","what":"Non visible changes","title":"Version 0.2.0","text":"non-exported function knot_expr created help plotting knot locations cpr:::plot.cpr_bs.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"new-features-0-1-1","dir":"Changelog","previous_headings":"","what":"New Features","title":"Version 0.1.1","text":"plot.cpr_cp allows user suppress plotting control polygon. plotting multiple control polygons splines, option make easier view spline functions.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"non-visible-changes-0-1-1","dir":"Changelog","previous_headings":"","what":"Non visible changes","title":"Version 0.1.1","text":"Extended testing scripts.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"version-010","dir":"Changelog","previous_headings":"","what":"Version 0.1.0","title":"Version 0.1.0","text":"First version univariable cpr methods ready deployment","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"big-picture-0-1-0","dir":"Changelog","previous_headings":"","what":"Big picture","title":"Version 0.1.0","text":"cpr::cp cpr::cpr used simulations aimed part first manuscript. Modifications might needed, hopefully univariable methods stable. lot changes implementation API occurred 0.0.x series. aim version 0.2.0 similar API cpr::cn cpr::cnr provided cpr::cp cpr::cpr calls.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"new-features-0-0-5","dir":"Changelog","previous_headings":"","what":"New Features","title":"version 0.0.5","text":"First second derivatives B-splines via bsplineD","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"extended-documentation-0-0-5","dir":"Changelog","previous_headings":"","what":"Extended Documentation","title":"version 0.0.5","text":"Examples added bsplines","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"end-user-non-visible-changes-0-0-5","dir":"Changelog","previous_headings":"","what":"End User non-visible changes:","title":"version 0.0.5","text":"Added ---exported function generate_cp_data Redesign deboor.cpp file bsplines accessible. prior design allowed access basis, current design allows access generic B-splines.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"version-003","dir":"Changelog","previous_headings":"","what":"version 0.0.3","title":"version 0.0.3","text":"Version 0.0.3 version package used run analysis simulations presented paper submitted 28th International Biometrics Conference, Western North American Region (WNAR) Internal Biometric Society, Student paper competition. conference held 10 - 16 July 2016 Victoria, British Columbia, Canada.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"bug-fixes-0-0-3","dir":"Changelog","previous_headings":"","what":"Bug Fixes","title":"version 0.0.3","text":"Corrected attributes calls within cpr adjusting attributes set cpr_cp. plot.cpr_bs correctly displays indices knot sequence.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"end-user-visible-changes-0-0-3","dir":"Changelog","previous_headings":"","what":"End User Visible changes:","title":"version 0.0.3","text":"knot insertion matrix W accessible end user new way. Names functions boehem.cpp cleaner. plot.cpr_cpr allows user select either control polygons sums squared residuals plotted.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"vignettes-0-0-3","dir":"Changelog","previous_headings":"","what":"Vignettes","title":"version 0.0.3","text":"Removed background vignette… much detail right now, much time required build install package.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"end-user-non-visible-changes-0-0-3","dir":"Changelog","previous_headings":"","what":"End User non-visible changes:","title":"version 0.0.3","text":"Redundant definition greville_sites removed.","code":""},{"path":[]},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"new-features-0-0-2","dir":"Changelog","previous_headings":"","what":"new features","title":"version 0.0.2","text":"Added function tensor building tensor products cpr::bsplines. Added function influence_weights get influence weights internal knot marginal tensor product. .cpr_bs added. S3 methods cp","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"bug-fixes-0-0-2","dir":"Changelog","previous_headings":"","what":"Bug Fixes","title":"version 0.0.2","text":"trimmed quantile handles use_unique option correctly better handling … cp() cpr()","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"version-0019003","dir":"Changelog","previous_headings":"","what":"version 0.0.1.9003","title":"version 0.0.1.9003","text":"First usable version method based ‘importance weight’ internal knots based reversing methods presented Boehm (1980). Development metrics methods parsing preferable models. Version 0.0.1.9003 first stable version fitting exact data model.","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"vignettes-0-0-1-9003","dir":"Changelog","previous_headings":"","what":"Vignettes","title":"version 0.0.1.9003","text":"beginnings control-polygon vignette started (version 0.0.1.9001)","code":""},{"path":"http://www.peteredewitt.com/cpr/news/index.html","id":"version-001","dir":"Changelog","previous_headings":"","what":"version 0.0.1","title":"version 0.0.1","text":"version based idea using angle reduce control polygon good idea. literature review simulations showed otherwise. version marked posterity cpp functions going useful following versions well.","code":""}]
